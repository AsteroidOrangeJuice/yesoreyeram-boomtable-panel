{"version":3,"sources":["../src/module.js"],"names":["loadPluginCss","MetricsPanelCtrl","TimeSeries","config","list_of_stylesheets","GrafanaBoomTableCtrl","$scope","$injector","$sce","_","defaults","panel","panelDefaults","events","on","onDataReceived","bind","onInitEditMode","valueNameOptions","each","editorTabs","addEditorTab","editor","name","plugin_id","template","position","data","dataReceived","render","seriesData","series","datapoints","alias","target","flotpairs","getFlotPairs","nullPointMode","newPattern","pattern","delimiter","valueName","row_name","col_name","thresholds","enable_bgColor","bgColors","patterns","push","activePatternIndex","length","index","splice","value","c","i","first","prototype","console","log","dataComputed","map","seriesHandler","find","concat","defaultPattern","p","match","stats","split","reduce","r","it","replace","RegExp","d","bgColor","computeBgColor","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import {\r\n  loadPluginCss,\r\n  MetricsPanelCtrl,\r\n  TimeSeries,\r\n  config\r\n} from \"./app/app\"\r\n\r\nloadPluginCss(config.list_of_stylesheets);\r\n\r\nclass GrafanaBoomTableCtrl extends MetricsPanelCtrl {\r\n  constructor($scope, $injector, $sce) {\r\n    super($scope, $injector);\r\n    _.defaults(this.panel, config.panelDefaults);\r\n    this.events.on(\"data-received\", this.onDataReceived.bind(this));\r\n    this.events.on(\"init-edit-mode\", this.onInitEditMode.bind(this));\r\n  }\r\n  onInitEditMode() {\r\n    this.valueNameOptions = config.valueNameOptions;\r\n    _.each(config.editorTabs, editor => {\r\n      this.addEditorTab(editor.name, \"public/plugins/\" + config.plugin_id + editor.template, editor.position);\r\n    })\r\n  }\r\n  onDataReceived(data) {\r\n    this.dataReceived = data;\r\n    this.render();\r\n  }\r\n  seriesHandler(seriesData) {\r\n    var series = new TimeSeries({\r\n      datapoints: seriesData.datapoints || [],\r\n      alias: seriesData.target\r\n    });\r\n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\r\n    return series;\r\n  }\r\n  addPattern() {\r\n    var newPattern = {\r\n      pattern: \"^server.*cpu$\",\r\n      delimiter: \".\",\r\n      valueName: \"avg\",\r\n      row_name: \"_0_\",\r\n      col_name: \"_1_\",\r\n      thresholds: \"70,90\",\r\n      enable_bgColor: false,\r\n      bgColors: \"green|orange|red\"\r\n    };\r\n    this.panel.patterns.push(newPattern);\r\n    this.panel.activePatternIndex = this.panel.patterns.length - 1;\r\n    this.render();\r\n  }\r\n  removePattern(index) {\r\n    this.panel.patterns.splice(index, 1);\r\n    this.panel.activePatternIndex = -1;\r\n    this.render();\r\n  }\r\n  computeBgColor(thresholds, bgColors, value) {\r\n    var c = \"transparent\";\r\n    if (thresholds && bgColors && value && thresholds.length + 1 === bgColors.length) {\r\n      for (var i = thresholds.length; i > 0; i--) {\r\n        if (value >= thresholds[i - 1]) {\r\n          return bgColors[i];\r\n        }\r\n      }\r\n      return _.first(bgColors);\r\n    }\r\n    return c;\r\n  }\r\n}\r\n\r\nGrafanaBoomTableCtrl.prototype.render = function () {\r\n  if (this.dataReceived) {\r\n    console.log(\"Rendering\");\r\n    // Binding the grafana computations to the metrics received\r\n    this.dataComputed = this.dataReceived.map(this.seriesHandler.bind(this));\r\n    // Assign pattern\r\n    this.dataComputed = this.dataComputed.map(series => {\r\n      series.pattern = _.find(this.panel.patterns.concat(this.panel.defaultPattern), function (p) {\r\n        return series.alias.match(p.pattern || \"\");\r\n      });\r\n      return series;\r\n    });\r\n    // Assign value\r\n    this.dataComputed = this.dataComputed.map(series => {\r\n      series.value = series.stats[series.pattern.valueName || \"avg\"] || \"N/A\";\r\n      return series;\r\n    });\r\n    // Assign Row Name\r\n    this.dataComputed = this.dataComputed.map(series => {\r\n      series.row_name = series.alias.split(series.pattern.delimiter || \".\").reduce((r, it, i) => {\r\n        return r.replace(new RegExp(\"_\" + i + \"_\", \"g\"), it)\r\n      }, series.pattern.row_name || config.panelDefaults.defaultPattern.row_name);\r\n      if (series.alias.split(series.pattern.delimiter || \".\").length === 1) {\r\n        series.row_name = series.alias;\r\n      }\r\n      return series;\r\n    });\r\n    // Assign Col Name\r\n    this.dataComputed = this.dataComputed.map(series => {\r\n      series.col_name = series.alias.split(series.pattern.delimiter || \".\").reduce((r, it, i) => {\r\n        return r.replace(new RegExp(\"_\" + i + \"_\", \"g\"), it)\r\n      }, series.pattern.col_name || config.panelDefaults.defaultPattern.col_name);\r\n      if (series.alias.split(series.pattern.delimiter || \".\").length === 1) {\r\n        series.col_name = \"value\";\r\n      }\r\n      return series;\r\n    });\r\n    // Assign Thresholds\r\n    this.dataComputed = this.dataComputed.map(series => {\r\n      series.thresholds = (series.pattern.thresholds || config.panelDefaults.defaultPattern.thresholds).split(\",\").map(d => +d);\r\n      return series;\r\n    });\r\n    // Assign BG Colors\r\n    this.dataComputed = this.dataComputed.map(series => {\r\n      series.enable_bgColor = series.pattern.enable_bgColor;\r\n      series.bgColors = (series.pattern.bgColors || config.panelDefaults.defaultPattern.bgColors).split(\"|\");\r\n      series.bgColor = series.enable_bgColor === true ? this.computeBgColor(series.thresholds, series.bgColors, series.value) : \"transparent\";\r\n      return series;\r\n    });\r\n    // Assigning computed data to output panel\r\n    this.panel.data = this.dataComputed;\r\n  }\r\n};\r\n\r\nGrafanaBoomTableCtrl.templateUrl = \"partials/module.html\";\r\n\r\nexport {\r\n  GrafanaBoomTableCtrl as PanelCtrl\r\n};"]}