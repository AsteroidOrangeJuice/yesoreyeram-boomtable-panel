System.register(["lodash", "app/core/utils/kbn", "app/core/time_series2", "./utils"], function (exports_1, context_1) {
    "use strict";
    var lodash_1, kbn_1, time_series2_1, utils, ___transformValue, ___computeColorFromThresholds, ___getServerTimestamp, defaultHandler, getPattern, getRowName, getColName, getThresholds, assignValue, filterValues, getDisplayValueOverride, getBgColor, getOverridedBGColor, getTextColor, getOverridedTextColor, applyFontAwesomeIcons, applyImageTransform, assignClickableLinks, compute;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (lodash_1_1) {
                lodash_1 = lodash_1_1;
            },
            function (kbn_1_1) {
                kbn_1 = kbn_1_1;
            },
            function (time_series2_1_1) {
                time_series2_1 = time_series2_1_1;
            },
            function (utils_1) {
                utils = utils_1;
            }
        ],
        execute: function () {
            ___transformValue = function (thresholds, transform_values, value, displayValue, row_name, col_name) {
                var t = value;
                if (thresholds && transform_values && typeof value === "number" && thresholds.length + 1 <= transform_values.length) {
                    transform_values = lodash_1.default.dropRight(transform_values, transform_values.length - thresholds.length - 1);
                    if (transform_values[transform_values.length - 1] === "") {
                        transform_values[transform_values.length - 1] = "_value_";
                    }
                    for (var i = thresholds.length; i > 0; i--) {
                        if (value >= thresholds[i - 1]) {
                            var o_1 = transform_values[i];
                            o_1 = o_1.replace(new RegExp("_value_", "g"), String(displayValue));
                            o_1 = o_1.replace(new RegExp("_row_name_", "g"), String(row_name));
                            o_1 = o_1.replace(new RegExp("_col_name_", "g"), String(col_name));
                            return o_1;
                        }
                    }
                    var o = lodash_1.default.first(transform_values) || "";
                    o = o.replace(new RegExp("_value_", "g"), String(displayValue));
                    o = o.replace(new RegExp("_row_name_", "g"), String(row_name));
                    o = o.replace(new RegExp("_col_name_", "g"), String(col_name));
                    return o;
                }
                return String(t);
            };
            ___computeColorFromThresholds = function (thresholds, bgColors, value, defaultColor) {
                var c = defaultColor;
                if (thresholds && bgColors && typeof value === "number" && thresholds.length + 1 <= bgColors.length) {
                    bgColors = lodash_1.default.dropRight(bgColors, bgColors.length - thresholds.length - 1);
                    if (bgColors[bgColors.length - 1] === "") {
                        bgColors[bgColors.length - 1] = defaultColor;
                    }
                    for (var i = thresholds.length; i > 0; i--) {
                        if (value >= thresholds[i - 1]) {
                            return utils.normalizeColor(bgColors[i]);
                        }
                    }
                    return utils.normalizeColor(lodash_1.default.first(bgColors));
                }
                return c;
            };
            ___getServerTimestamp = function (series) {
                var current_servertimestamp = new Date();
                if (series && series.datapoints && series.datapoints.length > 0) {
                    if (lodash_1.default.last(series.datapoints).length === 2) {
                        current_servertimestamp = new Date(lodash_1.default.last(series.datapoints)[1]);
                    }
                }
                return current_servertimestamp;
            };
            defaultHandler = function (seriesData) {
                var series = new time_series2_1.default({
                    datapoints: seriesData.datapoints || [],
                    alias: seriesData.target
                });
                series.flotpairs = series.getFlotPairs("connected");
                return series;
            };
            exports_1("defaultHandler", defaultHandler);
            getPattern = function (patterns, defaultPattern, alias) {
                var activePatterns = patterns.filter(function (p) { return p.disabled !== true; });
                var matchingPattern = lodash_1.default.find(activePatterns, function (p) {
                    return alias.match(p.pattern);
                });
                return matchingPattern || defaultPattern;
            };
            getRowName = function (alias, pattern, defaultPattern, row_col_wrapper) {
                var row_name = alias.split(String(pattern.delimiter) || ".").reduce(function (r, it, i) {
                    return r.replace(new RegExp(String(row_col_wrapper) + i + String(row_col_wrapper), "g"), it);
                }, pattern.row_name.replace(new RegExp(row_col_wrapper + "series" + row_col_wrapper, "g"), String(alias)) || defaultPattern.row_name.replace(new RegExp(row_col_wrapper + "series" + row_col_wrapper, "g"), String(alias)));
                if (alias.split(String(pattern.delimiter) || ".").length === 1) {
                    row_name = String(alias);
                }
                return row_name;
            };
            getColName = function (alias, row_name, pattern, defaultPattern, row_col_wrapper) {
                var col_name = alias.split(String(pattern.delimiter) || ".").reduce(function (r, it, i) {
                    return r.replace(new RegExp(String(row_col_wrapper) + i + String(row_col_wrapper), "g"), it);
                }, pattern.col_name || defaultPattern.col_name);
                if (alias.split(String(pattern.delimiter) || ".").length === 1 || row_name === alias) {
                    col_name = pattern.col_name || "Value";
                }
                return col_name;
            };
            getThresholds = function (pattern, defaultPattern, current_servertimestamp) {
                var thresholds = (pattern.thresholds || defaultPattern.thresholds).split(",").map(function (d) { return +d; });
                if (pattern.enable_time_based_thresholds) {
                    var metricrecivedTimeStamp_1 = current_servertimestamp || new Date();
                    var metricrecivedTimeStamp_innumber_1 = metricrecivedTimeStamp_1.getHours() * 100 + metricrecivedTimeStamp_1.getMinutes();
                    var weekdays_1 = ["sun", "mon", "tue", "wed", "thu", "fri", "sat"];
                    lodash_1.default.each(pattern.time_based_thresholds, function (tbtx) {
                        if (tbtx && tbtx.from && tbtx.to && tbtx.enabledDays &&
                            (metricrecivedTimeStamp_innumber_1 >= +(tbtx.from)) &&
                            (metricrecivedTimeStamp_innumber_1 <= +(tbtx.to)) &&
                            (tbtx.enabledDays.toLowerCase().indexOf(weekdays_1[metricrecivedTimeStamp_1.getDay()]) > -1) &&
                            tbtx.threshold) {
                            thresholds = (tbtx.threshold + "").split(",").map(function (d) { return +d; });
                        }
                    });
                }
                return thresholds;
            };
            assignValue = function (series, defaultPattern) {
                if (series.stats) {
                    series.value = series.stats[String(series.pattern.valueName) || String(defaultPattern.valueName)];
                    var decimalInfo = utils.getDecimalsForValue(series.value, +(series.decimals));
                    var formatFunc = kbn_1.default.valueFormats[String(series.pattern.format) || String(defaultPattern.format)];
                    if (series.value === null) {
                        series.displayValue = series.pattern.null_value || defaultPattern.null_value || "Null";
                    }
                    else if (!isNaN(series.value)) {
                        series.valueFormatted = formatFunc(series.value, decimalInfo.decimals, decimalInfo.scaledDecimals);
                        series.valueRounded = kbn_1.default.roundValue(series.value, decimalInfo.decimals);
                        series.displayValue = series.valueFormatted;
                    }
                    else {
                        series.displayValue = series.pattern.null_value || defaultPattern.null_value || "Null";
                    }
                }
                return series;
            };
            filterValues = function (series) {
                if (!series.pattern.filter) {
                    series.pattern.filter = {
                        value_below: "",
                        value_above: ""
                    };
                }
                if (series.pattern && series.pattern.filter && (series.pattern.filter.value_below !== "" || series.pattern.filter.value_above !== "")) {
                    if (series.pattern.filter.value_below !== "" && series.value < +(series.pattern.filter.value_below)) {
                        return false;
                    }
                    if (series.pattern.filter.value_above !== "" && series.value > +(series.pattern.filter.value_above)) {
                        return false;
                    }
                    return true;
                }
                else {
                    return true;
                }
            };
            getDisplayValueOverride = function (transform_values_overrides, value, row_name, col_name, displayValue) {
                var _transform_values_overrides = transform_values_overrides.split("|").filter(function (con) { return con.indexOf("->") > -1; }).map(function (con) { return con.split("->"); }).filter(function (con) { return +(con[0]) === value; }).map(function (con) { return con[1]; });
                if (_transform_values_overrides.length > 0 && _transform_values_overrides[0] !== "") {
                    displayValue = ("" + _transform_values_overrides[0]).trim().replace(new RegExp("_value_", "g"), String(displayValue)).replace(new RegExp("_row_name_", "g"), String(row_name)).replace(new RegExp("_col_name_", "g"), String(col_name));
                }
                return displayValue;
            };
            getBgColor = function (pattern, defaultPattern, enable_bgColor, thresholds, bgColors, value, displayValue) {
                var bgColor = enable_bgColor === true ? ___computeColorFromThresholds(thresholds, bgColors, value, "transparent") : "transparent";
                if (displayValue === (pattern.null_value || defaultPattern.null_value || "Null")) {
                    bgColor = pattern.null_color || defaultPattern.null_color || "transparent";
                }
                return bgColor;
            };
            getOverridedBGColor = function (bgColors_overrides, value, defaultBGColor) {
                var bgColor = defaultBGColor;
                var _bgColors_overrides = bgColors_overrides.split("|").filter(function (con) { return con.indexOf("->") > -1; }).map(function (con) { return con.split("->"); }).filter(function (con) { return +(con[0]) === value; }).map(function (con) { return con[1]; });
                if (_bgColors_overrides.length > 0 && _bgColors_overrides[0] !== "") {
                    bgColor = utils.normalizeColor(("" + _bgColors_overrides[0]).trim());
                }
                return bgColor;
            };
            getTextColor = function (pattern, defaultPattern, enable_TextColors, thresholds, textColors, value, displayValue) {
                var textColor = enable_TextColors === true ? ___computeColorFromThresholds(thresholds, textColors, value, "white") : "white";
                if (displayValue === (pattern.null_value || defaultPattern.null_value || "Null")) {
                    textColor = pattern.null_text_color || defaultPattern.null_text_color || "white";
                }
                return textColor;
            };
            getOverridedTextColor = function (textColors_overrides, value, defaulttextColor) {
                var textColor = defaulttextColor;
                var _textColors_overrides = textColors_overrides.split("|").filter(function (con) { return con.indexOf("->") > -1; }).map(function (con) { return con.split("->"); }).filter(function (con) { return +(con[0]) === value; }).map(function (con) { return con[1]; });
                if (_textColors_overrides.length > 0 && _textColors_overrides[0] !== "") {
                    textColor = utils.normalizeColor(("" + _textColors_overrides[0]).trim());
                }
                return textColor;
            };
            applyFontAwesomeIcons = function (series) {
                series.actual_displayvalue = series.displayValue;
                series.actual_row_name = series.row_name;
                series.actual_col_name = series.col_name;
                if (series.displayValue && series.displayValue.indexOf("_fa-") > -1) {
                    series.displayValue = utils.replaceFontAwesomeIcons(series.displayValue);
                }
                if (series.row_name && series.row_name.indexOf("_fa-") > -1) {
                    series.row_name = utils.replaceFontAwesomeIcons(series.row_name);
                }
                if (series.col_name && series.col_name.indexOf("_fa-") > -1) {
                    series.col_name = utils.replaceFontAwesomeIcons(series.col_name);
                }
                return series;
            };
            applyImageTransform = function (series) {
                if (series.displayValue && series.displayValue.indexOf("_img-") > -1) {
                    series.displayValue = utils.replaceWithImages(series.displayValue);
                }
                if (series.row_name && series.row_name.indexOf("_img-") > -1) {
                    series.row_name = utils.replaceWithImages(series.row_name);
                }
                if (series.col_name && series.col_name.indexOf("_img-") > -1) {
                    series.col_name = utils.replaceWithImages(series.col_name);
                }
                return series;
            };
            assignClickableLinks = function (series) {
                if (series.pattern.enable_clickable_cells) {
                    var targetLink = series.pattern.clickable_cells_link || "#";
                    targetLink = targetLink.replace(new RegExp("_row_name_", "g"), utils.getActualNameWithoutTransformSign(series.actual_row_name).trim());
                    targetLink = targetLink.replace(new RegExp("_col_name_", "g"), utils.getActualNameWithoutTransformSign(series.actual_col_name).trim());
                    targetLink = targetLink.replace(new RegExp("_value_", "g"), utils.getActualNameWithoutTransformSign(series.value).trim());
                    series.displayValue = "<a href=\"" + targetLink + "\" target=\"_blank\">" + series.displayValue + "</a>";
                }
                return series;
            };
            compute = function (dataComputed, defaultPattern, patterns, row_col_wrapper) {
                dataComputed = dataComputed.map(function (series) {
                    series.pattern = getPattern(patterns, defaultPattern, series.alias);
                    series.decimals = series.pattern.decimals || defaultPattern.decimals;
                    return series;
                });
                dataComputed = dataComputed.map(function (series) { return assignValue(series, defaultPattern); });
                dataComputed = dataComputed.filter(function (series) { return filterValues(series); });
                dataComputed = dataComputed.map(function (series) {
                    series.row_name = getRowName(series.alias, series.pattern, defaultPattern, row_col_wrapper);
                    series.col_name = getColName(series.alias, series.row_name, series.pattern, defaultPattern, row_col_wrapper);
                    series.key_name = series.row_name + "#" + series.col_name;
                    series.thresholds = getThresholds(series.pattern, defaultPattern, ___getServerTimestamp(series));
                    series.enable_bgColor = series.pattern.enable_bgColor;
                    series.bgColors = (series.pattern.bgColors || defaultPattern.bgColors || "").split("|");
                    series.bgColor = getBgColor(series.pattern, defaultPattern, series.enable_bgColor, series.thresholds, series.bgColors, series.value, series.displayValue);
                    series.enable_bgColor_overrides = series.pattern.enable_bgColor_overrides;
                    series.bgColors_overrides = series.pattern.bgColors_overrides || "";
                    if (series.enable_bgColor_overrides && series.bgColors_overrides !== "") {
                        series.bgColor = getOverridedBGColor(series.bgColors_overrides, series.value, series.bgColor);
                    }
                    series.enable_TextColors = series.pattern.enable_TextColors;
                    series.textColors = (series.pattern.textColors || defaultPattern.textColors || "").split("|");
                    series.textColor = getTextColor(series.pattern, defaultPattern, series.enable_TextColors, series.thresholds, series.textColors, series.value, series.displayValue);
                    series.enable_TextColor_overrides = series.pattern.enable_TextColor_overrides;
                    series.textColors_overrides = series.pattern.textColors_overrides || "";
                    if (series.enable_TextColor_overrides && series.textColors_overrides !== "") {
                        series.textColor = getOverridedTextColor(series.textColors_overrides, series.value, series.textColor);
                    }
                    series.enable_transform = series.pattern.enable_transform;
                    series.transform_values = (series.pattern.transform_values || defaultPattern.transform_values).split("|");
                    series.displayValue = series.enable_transform === true ? ___transformValue(series.thresholds, series.transform_values, series.value, series.displayValue, series.row_name, series.col_name) : series.displayValue;
                    if (series.displayValue === (series.pattern.null_value || defaultPattern.null_value || "Null")) {
                        series.displayValue = series.pattern.null_value || defaultPattern.null_value;
                    }
                    else if (isNaN(series.value)) {
                        series.displayValue = series.pattern.null_value || defaultPattern.null_value;
                    }
                    series.enable_transform_overrides = series.pattern.enable_transform_overrides;
                    series.transform_values_overrides = series.pattern.transform_values_overrides || "";
                    if (series.enable_transform_overrides && series.transform_values_overrides !== "") {
                        series.displayValue = getDisplayValueOverride(series.transform_values_overrides, series.value, series.row_name, series.col_name, series.displayValue);
                    }
                    series.tooltipTemplate = series.pattern.tooltipTemplate || defaultPattern.tooltipTemplate || "Row Name : _row_name_ <br/>Col Name : _col_name_ <br/>Value : _value_";
                    return series;
                });
                dataComputed = dataComputed.map(function (series) { return applyFontAwesomeIcons(series); });
                dataComputed = dataComputed.map(function (series) { return applyImageTransform(series); });
                dataComputed = dataComputed.map(function (series) { return assignClickableLinks(series); });
                return dataComputed;
            };
            exports_1("compute", compute);
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VyaWVzSGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hcHAvc2VyaWVzSGFuZGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztZQVFJLGlCQUFpQixHQUFHLFVBQVUsVUFBb0IsRUFBRSxnQkFBMEIsRUFBRSxLQUFhLEVBQUUsWUFBb0IsRUFBRSxRQUFnQixFQUFFLFFBQWdCO2dCQUN2SixJQUFJLENBQUMsR0FBRyxLQUFLLENBQUM7Z0JBQ2QsSUFBSSxVQUFVLElBQUksZ0JBQWdCLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxJQUFJLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLGdCQUFnQixDQUFDLE1BQU0sRUFBRTtvQkFDakgsZ0JBQWdCLEdBQUcsZ0JBQUMsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLEVBQUUsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQ2xHLElBQUksZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTt3QkFDdEQsZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLFNBQVMsQ0FBQztxQkFDN0Q7b0JBQ0QsS0FBSyxJQUFJLENBQUMsR0FBRyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7d0JBQ3hDLElBQUksS0FBSyxJQUFJLFVBQVUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7NEJBQzVCLElBQUksR0FBQyxHQUFHLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUM1QixHQUFDLEdBQUcsR0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLEVBQUUsTUFBTSxDQUFDLFlBQVks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QUFNLENBQUMsT0FBTyxDQUFDLGVBQWUsSUFBSSxjQUFjLENBQUMsZUFBZSxJQUFJLHVFQUF1RSxDQUFDO29CQUNySyxPQUFPLE1BQU0sQ0FBQztnQkFDbEIsQ0FBQyxDQUFDLENBQUM7Z0JBQ0gsWUFBWSxHQUFHLFlBQVksQ0FBQyxHQUFHLENBQUMsVUFBQSxNQUFNLElBQUksT0FBQSxxQkFBcUIsQ0FBQyxNQUFNLENBQUMsRUFBN0IsQ0FBNkIsQ0FBQyxDQUFDO2dCQUN6RSxZQUFZLEdBQUcsWUFBWSxDQUFDLEdBQUcsQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxFQUEzQixDQUEyQixDQUFDLENBQUM7Z0JBQ3ZFLFlBQVksR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDLFVBQUEsTUFBTSxJQUFJLE9BQUEsb0JBQW9CLENBQUMsTUFBTSxDQUFDLEVBQTVCLENBQTRCLENBQUMsQ0FBQztnQkFDeEUsT0FBTyxZQUFZLENBQUM7WUFDeEIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vbm9kZV9tb2R1bGVzL2dyYWZhbmEtc2RrLW1vY2tzL2FwcC9oZWFkZXJzL2NvbW1vbi5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCBfIGZyb20gXCJsb2Rhc2hcIjtcclxuaW1wb3J0IGtibiBmcm9tIFwiYXBwL2NvcmUvdXRpbHMva2JuXCI7XHJcbmltcG9ydCBUaW1lU2VyaWVzIGZyb20gXCJhcHAvY29yZS90aW1lX3NlcmllczJcIjtcclxuaW1wb3J0ICogYXMgdXRpbHMgZnJvbSBcIi4vdXRpbHNcIjtcclxuaW1wb3J0IHsgU2VyaWVzLCBQYXR0ZXJuIH0gZnJvbSBcIi4vLi4vaW50ZXJmYWNlcy9pbnRlcmZhY2VzXCI7XHJcblxyXG5sZXQgX19fdHJhbnNmb3JtVmFsdWUgPSBmdW5jdGlvbiAodGhyZXNob2xkczogTnVtYmVyW10sIHRyYW5zZm9ybV92YWx1ZXM6IFN0cmluZ1tdLCB2YWx1ZTogTnVtYmVyLCBkaXNwbGF5VmFsdWU6IFN0cmluZywgcm93X25hbWU6IFN0cmluZywgY29sX25hbWU6IFN0cmluZyk6IFN0cmluZyB7XHJcbiAgICBsZXQgdCA9IHZhbHVlO1xyXG4gICAgaWYgKHRocmVzaG9sZHMgJiYgdHJhbnNmb3JtX3ZhbHVlcyAmJiB0eXBlb2YgdmFsdWUgPT09IFwibnVtYmVyXCIgJiYgdGhyZXNob2xkcy5sZW5ndGggKyAxIDw9IHRyYW5zZm9ybV92YWx1ZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgdHJhbnNmb3JtX3ZhbHVlcyA9IF8uZHJvcFJpZ2h0KHRyYW5zZm9ybV92YWx1ZXMsIHRyYW5zZm9ybV92YWx1ZXMubGVuZ3RoIC0gdGhyZXNob2xkcy5sZW5ndGggLSAxKTtcclxuICAgICAgICBpZiAodHJhbnNmb3JtX3ZhbHVlc1t0cmFuc2Zvcm1fdmFsdWVzLmxlbmd0aCAtIDFdID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIHRyYW5zZm9ybV92YWx1ZXNbdHJhbnNmb3JtX3ZhbHVlcy5sZW5ndGggLSAxXSA9IFwiX3ZhbHVlX1wiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpID0gdGhyZXNob2xkcy5sZW5ndGg7IGkgPiAwOyBpLS0pIHtcclxuICAgICAgICAgICAgaWYgKHZhbHVlID49IHRocmVzaG9sZHNbaSAtIDFdKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbyA9IHRyYW5zZm9ybV92YWx1ZXNbaV07XHJcbiAgICAgICAgICAgICAgICBvID0gby5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfdmFsdWVfXCIsIFwiZ1wiKSwgU3RyaW5nKGRpc3BsYXlWYWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgbyA9IG8ucmVwbGFjZShuZXcgUmVnRXhwKFwiX3Jvd19uYW1lX1wiLCBcImdcIiksIFN0cmluZyhyb3dfbmFtZSkpO1xyXG4gICAgICAgICAgICAgICAgbyA9IG8ucmVwbGFjZShuZXcgUmVnRXhwKFwiX2NvbF9uYW1lX1wiLCBcImdcIiksIFN0cmluZyhjb2xfbmFtZSkpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG87XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IG8gPSBfLmZpcnN0KHRyYW5zZm9ybV92YWx1ZXMpIHx8IFwiXCI7XHJcbiAgICAgICAgbyA9IG8ucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX1wiLCBcImdcIiksIFN0cmluZyhkaXNwbGF5VmFsdWUpKTtcclxuICAgICAgICBvID0gby5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfcm93X25hbWVfXCIsIFwiZ1wiKSwgU3RyaW5nKHJvd19uYW1lKSk7XHJcbiAgICAgICAgbyA9IG8ucmVwbGFjZShuZXcgUmVnRXhwKFwiX2NvbF9uYW1lX1wiLCBcImdcIiksIFN0cmluZyhjb2xfbmFtZSkpO1xyXG4gICAgICAgIHJldHVybiBvO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFN0cmluZyh0KTtcclxufTtcclxubGV0IF9fX2NvbXB1dGVDb2xvckZyb21UaHJlc2hvbGRzID0gZnVuY3Rpb24gKHRocmVzaG9sZHM6IE51bWJlcltdLCBiZ0NvbG9yczogU3RyaW5nW10sIHZhbHVlOiBOdW1iZXIsIGRlZmF1bHRDb2xvcjogU3RyaW5nKTogU3RyaW5nIHtcclxuICAgIGxldCBjID0gZGVmYXVsdENvbG9yO1xyXG4gICAgaWYgKHRocmVzaG9sZHMgJiYgYmdDb2xvcnMgJiYgdHlwZW9mIHZhbHVlID09PSBcIm51bWJlclwiICYmIHRocmVzaG9sZHMubGVuZ3RoICsgMSA8PSBiZ0NvbG9ycy5sZW5ndGgpIHtcclxuICAgICAgICBiZ0NvbG9ycyA9IF8uZHJvcFJpZ2h0KGJnQ29sb3JzLCBiZ0NvbG9ycy5sZW5ndGggLSB0aHJlc2hvbGRzLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIGlmIChiZ0NvbG9yc1tiZ0NvbG9ycy5sZW5ndGggLSAxXSA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICBiZ0NvbG9yc1tiZ0NvbG9ycy5sZW5ndGggLSAxXSA9IGRlZmF1bHRDb2xvcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IHRocmVzaG9sZHMubGVuZ3RoOyBpID4gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA+PSB0aHJlc2hvbGRzW2kgLSAxXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHV0aWxzLm5vcm1hbGl6ZUNvbG9yKGJnQ29sb3JzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdXRpbHMubm9ybWFsaXplQ29sb3IoXy5maXJzdChiZ0NvbG9ycykpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGM7XHJcbn07XHJcbmxldCBfX19nZXRTZXJ2ZXJUaW1lc3RhbXAgPSBmdW5jdGlvbiAoc2VyaWVzOiBTZXJpZXMpOiBEYXRlIHtcclxuICAgIGxldCBjdXJyZW50X3NlcnZlcnRpbWVzdGFtcCA9IG5ldyBEYXRlKCk7XHJcbiAgICBpZiAoc2VyaWVzICYmIHNlcmllcy5kYXRhcG9pbnRzICYmIHNlcmllcy5kYXRhcG9pbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBpZiAoXy5sYXN0KHNlcmllcy5kYXRhcG9pbnRzKS5sZW5ndGggPT09IDIpIHtcclxuICAgICAgICAgICAgY3VycmVudF9zZXJ2ZXJ0aW1lc3RhbXAgPSBuZXcgRGF0ZShfLmxhc3Qoc2VyaWVzLmRhdGFwb2ludHMpWzFdKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY3VycmVudF9zZXJ2ZXJ0aW1lc3RhbXA7XHJcbn07XHJcbmxldCBkZWZhdWx0SGFuZGxlciA9IGZ1bmN0aW9uIChzZXJpZXNEYXRhOiBTZXJpZXMpOiBTZXJpZXMge1xyXG4gICAgbGV0IHNlcmllczogU2VyaWVzID0gbmV3IFRpbWVTZXJpZXMoe1xyXG4gICAgICAgIGRhdGFwb2ludHM6IHNlcmllc0RhdGEuZGF0YXBvaW50cyB8fCBbXSxcclxuICAgICAgICBhbGlhczogc2VyaWVzRGF0YS50YXJnZXRcclxuICAgIH0pO1xyXG4gICAgc2VyaWVzLmZsb3RwYWlycyA9IHNlcmllcy5nZXRGbG90UGFpcnMoXCJjb25uZWN0ZWRcIik7XHJcbiAgICByZXR1cm4gc2VyaWVzO1xyXG59O1xyXG5sZXQgZ2V0UGF0dGVybiA9IGZ1bmN0aW9uIChwYXR0ZXJuczogUGF0dGVybltdLCBkZWZhdWx0UGF0dGVybjogUGF0dGVybiwgYWxpYXM6IFN0cmluZykge1xyXG4gICAgbGV0IGFjdGl2ZVBhdHRlcm5zID0gcGF0dGVybnMuZmlsdGVyKHAgPT4geyByZXR1cm4gcC5kaXNhYmxlZCAhPT0gdHJ1ZTsgfSk7XHJcbiAgICBsZXQgbWF0Y2hpbmdQYXR0ZXJuID0gXy5maW5kKGFjdGl2ZVBhdHRlcm5zLCBmdW5jdGlvbiAocCkge1xyXG4gICAgICAgIHJldHVybiBhbGlhcy5tYXRjaChwLnBhdHRlcm4pO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbWF0Y2hpbmdQYXR0ZXJuIHx8IGRlZmF1bHRQYXR0ZXJuO1xyXG59O1xyXG5sZXQgZ2V0Um93TmFtZSA9IGZ1bmN0aW9uIChhbGlhczogU3RyaW5nLCBwYXR0ZXJuOiBQYXR0ZXJuLCBkZWZhdWx0UGF0dGVybjogUGF0dGVybiwgcm93X2NvbF93cmFwcGVyOiBTdHJpbmcpOiBTdHJpbmcge1xyXG4gICAgbGV0IHJvd19uYW1lOiBTdHJpbmcgPSBhbGlhcy5zcGxpdChTdHJpbmcocGF0dGVybi5kZWxpbWl0ZXIpIHx8IFwiLlwiKS5yZWR1Y2UoKHIsIGl0LCBpKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHIucmVwbGFjZShuZXcgUmVnRXhwKFN0cmluZyhyb3dfY29sX3dyYXBwZXIpICsgaSArIFN0cmluZyhyb3dfY29sX3dyYXBwZXIpLCBcImdcIiksIGl0KTtcclxuICAgIH0sIHBhdHRlcm4ucm93X25hbWUucmVwbGFjZShuZXcgUmVnRXhwKHJvd19jb2xfd3JhcHBlciArIFwic2VyaWVzXCIgKyByb3dfY29sX3dyYXBwZXIsIFwiZ1wiKSwgU3RyaW5nKGFsaWFzKSkgfHwgZGVmYXVsdFBhdHRlcm4ucm93X25hbWUucmVwbGFjZShuZXcgUmVnRXhwKHJvd19jb2xfd3JhcHBlciArIFwic2VyaWVzXCIgKyByb3dfY29sX3dyYXBwZXIsIFwiZ1wiKSwgU3RyaW5nKGFsaWFzKSkpO1xyXG4gICAgaWYgKGFsaWFzLnNwbGl0KFN0cmluZyhwYXR0ZXJuLmRlbGltaXRlcikgfHwgXCIuXCIpLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgIHJvd19uYW1lID0gU3RyaW5nKGFsaWFzKTtcclxuICAgIH1cclxuICAgIHJldHVybiByb3dfbmFtZTtcclxufTtcclxubGV0IGdldENvbE5hbWUgPSBmdW5jdGlvbiAoYWxpYXM6IFN0cmluZywgcm93X25hbWU6IFN0cmluZywgcGF0dGVybjogUGF0dGVybiwgZGVmYXVsdFBhdHRlcm46IFBhdHRlcm4sIHJvd19jb2xfd3JhcHBlcjogU3RyaW5nKTogU3RyaW5nIHtcclxuICAgIGxldCBjb2xfbmFtZSA9IGFsaWFzLnNwbGl0KFN0cmluZyhwYXR0ZXJuLmRlbGltaXRlcikgfHwgXCIuXCIpLnJlZHVjZSgociwgaXQsIGkpID0+IHtcclxuICAgICAgICByZXR1cm4gci5yZXBsYWNlKG5ldyBSZWdFeHAoU3RyaW5nKHJvd19jb2xfd3JhcHBlcikgKyBpICsgU3RyaW5nKHJvd19jb2xfd3JhcHBlciksIFwiZ1wiKSwgaXQpO1xyXG4gICAgfSwgcGF0dGVybi5jb2xfbmFtZSB8fCBkZWZhdWx0UGF0dGVybi5jb2xfbmFtZSk7XHJcbiAgICBpZiAoYWxpYXMuc3BsaXQoU3RyaW5nKHBhdHRlcm4uZGVsaW1pdGVyKSB8fCBcIi5cIikubGVuZ3RoID09PSAxIHx8IHJvd19uYW1lID09PSBhbGlhcykge1xyXG4gICAgICAgIGNvbF9uYW1lID0gcGF0dGVybi5jb2xfbmFtZSB8fCBcIlZhbHVlXCI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY29sX25hbWU7XHJcbn07XHJcbmxldCBnZXRUaHJlc2hvbGRzID0gZnVuY3Rpb24gKHBhdHRlcm46IFBhdHRlcm4sIGRlZmF1bHRQYXR0ZXJuOiBQYXR0ZXJuLCBjdXJyZW50X3NlcnZlcnRpbWVzdGFtcDogRGF0ZSk6IE51bWJlcltdIHtcclxuICAgIGxldCB0aHJlc2hvbGRzOiBOdW1iZXJbXSA9IChwYXR0ZXJuLnRocmVzaG9sZHMgfHwgZGVmYXVsdFBhdHRlcm4udGhyZXNob2xkcykuc3BsaXQoXCIsXCIpLm1hcChkID0+ICtkKTtcclxuICAgIGlmIChwYXR0ZXJuLmVuYWJsZV90aW1lX2Jhc2VkX3RocmVzaG9sZHMpIHtcclxuICAgICAgICBsZXQgbWV0cmljcmVjaXZlZFRpbWVTdGFtcCA9IGN1cnJlbnRfc2VydmVydGltZXN0YW1wIHx8IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgbGV0IG1ldHJpY3JlY2l2ZWRUaW1lU3RhbXBfaW5udW1iZXIgPSBtZXRyaWNyZWNpdmVkVGltZVN0YW1wLmdldEhvdXJzKCkgKiAxMDAgKyBtZXRyaWNyZWNpdmVkVGltZVN0YW1wLmdldE1pbnV0ZXMoKTtcclxuICAgICAgICBsZXQgd2Vla2RheXMgPSBbXCJzdW5cIiwgXCJtb25cIiwgXCJ0dWVcIiwgXCJ3ZWRcIiwgXCJ0aHVcIiwgXCJmcmlcIiwgXCJzYXRcIl07XHJcbiAgICAgICAgXy5lYWNoKHBhdHRlcm4udGltZV9iYXNlZF90aHJlc2hvbGRzLCAodGJ0eCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGJ0eCAmJiB0YnR4LmZyb20gJiYgdGJ0eC50byAmJiB0YnR4LmVuYWJsZWREYXlzICYmXHJcbiAgICAgICAgICAgICAgICAobWV0cmljcmVjaXZlZFRpbWVTdGFtcF9pbm51bWJlciA+PSArKHRidHguZnJvbSkpICYmXHJcbiAgICAgICAgICAgICAgICAobWV0cmljcmVjaXZlZFRpbWVTdGFtcF9pbm51bWJlciA8PSArKHRidHgudG8pKSAmJlxyXG4gICAgICAgICAgICAgICAgKHRidHguZW5hYmxlZERheXMudG9Mb3dlckNhc2UoKS5pbmRleE9mKHdlZWtkYXlzW21ldHJpY3JlY2l2ZWRUaW1lU3RhbXAuZ2V0RGF5KCldKSA+IC0xKSAmJlxyXG4gICAgICAgICAgICAgICAgdGJ0eC50aHJlc2hvbGRcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJlc2hvbGRzID0gKHRidHgudGhyZXNob2xkICsgXCJcIikuc3BsaXQoXCIsXCIpLm1hcChkID0+ICtkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRocmVzaG9sZHM7XHJcbn07XHJcbmxldCBhc3NpZ25WYWx1ZSA9IGZ1bmN0aW9uIChzZXJpZXM6IFNlcmllcywgZGVmYXVsdFBhdHRlcm46IFBhdHRlcm4pOiBTZXJpZXMge1xyXG4gICAgaWYgKHNlcmllcy5zdGF0cykge1xyXG4gICAgICAgIHNlcmllcy52YWx1ZSA9IHNlcmllcy5zdGF0c1tTdHJpbmcoc2VyaWVzLnBhdHRlcm4udmFsdWVOYW1lKSB8fCBTdHJpbmcoZGVmYXVsdFBhdHRlcm4udmFsdWVOYW1lKV07XHJcbiAgICAgICAgbGV0IGRlY2ltYWxJbmZvOiBhbnkgPSB1dGlscy5nZXREZWNpbWFsc0ZvclZhbHVlKHNlcmllcy52YWx1ZSwgKyhzZXJpZXMuZGVjaW1hbHMpKTtcclxuICAgICAgICBsZXQgZm9ybWF0RnVuYyA9IGtibi52YWx1ZUZvcm1hdHNbU3RyaW5nKHNlcmllcy5wYXR0ZXJuLmZvcm1hdCkgfHwgU3RyaW5nKGRlZmF1bHRQYXR0ZXJuLmZvcm1hdCldO1xyXG4gICAgICAgIGlmIChzZXJpZXMudmFsdWUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgc2VyaWVzLmRpc3BsYXlWYWx1ZSA9IHNlcmllcy5wYXR0ZXJuLm51bGxfdmFsdWUgfHwgZGVmYXVsdFBhdHRlcm4ubnVsbF92YWx1ZSB8fCBcIk51bGxcIjtcclxuICAgICAgICB9IGVsc2UgaWYgKCFpc05hTihzZXJpZXMudmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHNlcmllcy52YWx1ZUZvcm1hdHRlZCA9IGZvcm1hdEZ1bmMoc2VyaWVzLnZhbHVlLCBkZWNpbWFsSW5mby5kZWNpbWFscywgZGVjaW1hbEluZm8uc2NhbGVkRGVjaW1hbHMpO1xyXG4gICAgICAgICAgICBzZXJpZXMudmFsdWVSb3VuZGVkID0ga2JuLnJvdW5kVmFsdWUoc2VyaWVzLnZhbHVlLCBkZWNpbWFsSW5mby5kZWNpbWFscyk7XHJcbiAgICAgICAgICAgIHNlcmllcy5kaXNwbGF5VmFsdWUgPSBzZXJpZXMudmFsdWVGb3JtYXR0ZWQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2VyaWVzLmRpc3BsYXlWYWx1ZSA9IHNlcmllcy5wYXR0ZXJuLm51bGxfdmFsdWUgfHwgZGVmYXVsdFBhdHRlcm4ubnVsbF92YWx1ZSB8fCBcIk51bGxcIjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc2VyaWVzO1xyXG59O1xyXG5sZXQgZmlsdGVyVmFsdWVzID0gZnVuY3Rpb24gKHNlcmllczogU2VyaWVzKTogQm9vbGVhbiB7XHJcbiAgICBpZiAoIXNlcmllcy5wYXR0ZXJuLmZpbHRlcikge1xyXG4gICAgICAgIHNlcmllcy5wYXR0ZXJuLmZpbHRlciA9IHtcclxuICAgICAgICAgICAgdmFsdWVfYmVsb3c6IFwiXCIsXHJcbiAgICAgICAgICAgIHZhbHVlX2Fib3ZlOiBcIlwiXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGlmIChzZXJpZXMucGF0dGVybiAmJiBzZXJpZXMucGF0dGVybi5maWx0ZXIgJiYgKHNlcmllcy5wYXR0ZXJuLmZpbHRlci52YWx1ZV9iZWxvdyAhPT0gXCJcIiB8fCBzZXJpZXMucGF0dGVybi5maWx0ZXIudmFsdWVfYWJvdmUgIT09IFwiXCIpKSB7XHJcbiAgICAgICAgaWYgKHNlcmllcy5wYXR0ZXJuLmZpbHRlci52YWx1ZV9iZWxvdyAhPT0gXCJcIiAmJiBzZXJpZXMudmFsdWUgPCArKHNlcmllcy5wYXR0ZXJuLmZpbHRlci52YWx1ZV9iZWxvdykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2VyaWVzLnBhdHRlcm4uZmlsdGVyLnZhbHVlX2Fib3ZlICE9PSBcIlwiICYmIHNlcmllcy52YWx1ZSA+ICsoc2VyaWVzLnBhdHRlcm4uZmlsdGVyLnZhbHVlX2Fib3ZlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxufTtcclxubGV0IGdldERpc3BsYXlWYWx1ZU92ZXJyaWRlID0gZnVuY3Rpb24gKHRyYW5zZm9ybV92YWx1ZXNfb3ZlcnJpZGVzOiBTdHJpbmcsIHZhbHVlOiBOdW1iZXIsIHJvd19uYW1lOiBTdHJpbmcsIGNvbF9uYW1lOiBTdHJpbmcsIGRpc3BsYXlWYWx1ZTogU3RyaW5nKTogU3RyaW5nIHtcclxuICAgIGxldCBfdHJhbnNmb3JtX3ZhbHVlc19vdmVycmlkZXMgPSB0cmFuc2Zvcm1fdmFsdWVzX292ZXJyaWRlcy5zcGxpdChcInxcIikuZmlsdGVyKGNvbiA9PiBjb24uaW5kZXhPZihcIi0+XCIpID4gLTEpLm1hcChjb24gPT4gY29uLnNwbGl0KFwiLT5cIikpLmZpbHRlcihjb24gPT4gKyhjb25bMF0pID09PSB2YWx1ZSkubWFwKGNvbiA9PiBjb25bMV0pO1xyXG4gICAgaWYgKF90cmFuc2Zvcm1fdmFsdWVzX292ZXJyaWRlcy5sZW5ndGggPiAwICYmIF90cmFuc2Zvcm1fdmFsdWVzX292ZXJyaWRlc1swXSAhPT0gXCJcIikge1xyXG4gICAgICAgIGRpc3BsYXlWYWx1ZSA9IChcIlwiICsgX3RyYW5zZm9ybV92YWx1ZXNfb3ZlcnJpZGVzWzBdKS50cmltKCkucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX1wiLCBcImdcIiksIFN0cmluZyhkaXNwbGF5VmFsdWUpKS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfcm93X25hbWVfXCIsIFwiZ1wiKSwgU3RyaW5nKHJvd19uYW1lKSkucmVwbGFjZShuZXcgUmVnRXhwKFwiX2NvbF9uYW1lX1wiLCBcImdcIiksIFN0cmluZyhjb2xfbmFtZSkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRpc3BsYXlWYWx1ZTtcclxufTtcclxubGV0IGdldEJnQ29sb3IgPSBmdW5jdGlvbiAocGF0dGVybjogUGF0dGVybiwgZGVmYXVsdFBhdHRlcm46IFBhdHRlcm4sIGVuYWJsZV9iZ0NvbG9yOiBCb29sZWFuLCB0aHJlc2hvbGRzOiBOdW1iZXJbXSwgYmdDb2xvcnM6IFN0cmluZ1tdLCB2YWx1ZTogTnVtYmVyLCBkaXNwbGF5VmFsdWU6IGFueSk6IFN0cmluZyB7XHJcbiAgICBsZXQgYmdDb2xvciA9IGVuYWJsZV9iZ0NvbG9yID09PSB0cnVlID8gX19fY29tcHV0ZUNvbG9yRnJvbVRocmVzaG9sZHModGhyZXNob2xkcywgYmdDb2xvcnMsIHZhbHVlLCBcInRyYW5zcGFyZW50XCIpIDogXCJ0cmFuc3BhcmVudFwiO1xyXG4gICAgaWYgKGRpc3BsYXlWYWx1ZSA9PT0gKHBhdHRlcm4ubnVsbF92YWx1ZSB8fCBkZWZhdWx0UGF0dGVybi5udWxsX3ZhbHVlIHx8IFwiTnVsbFwiKSkge1xyXG4gICAgICAgIGJnQ29sb3IgPSBwYXR0ZXJuLm51bGxfY29sb3IgfHwgZGVmYXVsdFBhdHRlcm4ubnVsbF9jb2xvciB8fCBcInRyYW5zcGFyZW50XCI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYmdDb2xvcjtcclxufTtcclxubGV0IGdldE92ZXJyaWRlZEJHQ29sb3IgPSBmdW5jdGlvbiAoYmdDb2xvcnNfb3ZlcnJpZGVzOiBTdHJpbmcsIHZhbHVlOiBOdW1iZXIsIGRlZmF1bHRCR0NvbG9yOiBTdHJpbmcpOiBTdHJpbmcge1xyXG4gICAgbGV0IGJnQ29sb3IgPSBkZWZhdWx0QkdDb2xvcjtcclxuICAgIGxldCBfYmdDb2xvcnNfb3ZlcnJpZGVzID0gYmdDb2xvcnNfb3ZlcnJpZGVzLnNwbGl0KFwifFwiKS5maWx0ZXIoY29uID0+IGNvbi5pbmRleE9mKFwiLT5cIikgPiAtMSkubWFwKGNvbiA9PiBjb24uc3BsaXQoXCItPlwiKSkuZmlsdGVyKGNvbiA9PiArKGNvblswXSkgPT09IHZhbHVlKS5tYXAoY29uID0+IGNvblsxXSk7XHJcbiAgICBpZiAoX2JnQ29sb3JzX292ZXJyaWRlcy5sZW5ndGggPiAwICYmIF9iZ0NvbG9yc19vdmVycmlkZXNbMF0gIT09IFwiXCIpIHtcclxuICAgICAgICBiZ0NvbG9yID0gdXRpbHMubm9ybWFsaXplQ29sb3IoKFwiXCIgKyBfYmdDb2xvcnNfb3ZlcnJpZGVzWzBdKS50cmltKCkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGJnQ29sb3I7XHJcbn07XHJcbmxldCBnZXRUZXh0Q29sb3IgPSBmdW5jdGlvbiAocGF0dGVybjogUGF0dGVybiwgZGVmYXVsdFBhdHRlcm46IFBhdHRlcm4sIGVuYWJsZV9UZXh0Q29sb3JzOiBCb29sZWFuLCB0aHJlc2hvbGRzOiBOdW1iZXJbXSwgdGV4dENvbG9yczogU3RyaW5nW10sIHZhbHVlOiBOdW1iZXIsIGRpc3BsYXlWYWx1ZTogYW55KTogU3RyaW5nIHtcclxuICAgIGxldCB0ZXh0Q29sb3IgPSBlbmFibGVfVGV4dENvbG9ycyA9PT0gdHJ1ZSA/IF9fX2NvbXB1dGVDb2xvckZyb21UaHJlc2hvbGRzKHRocmVzaG9sZHMsIHRleHRDb2xvcnMsIHZhbHVlLCBcIndoaXRlXCIpIDogXCJ3aGl0ZVwiO1xyXG4gICAgaWYgKGRpc3BsYXlWYWx1ZSA9PT0gKHBhdHRlcm4ubnVsbF92YWx1ZSB8fCBkZWZhdWx0UGF0dGVybi5udWxsX3ZhbHVlIHx8IFwiTnVsbFwiKSkge1xyXG4gICAgICAgIHRleHRDb2xvciA9IHBhdHRlcm4ubnVsbF90ZXh0X2NvbG9yIHx8IGRlZmF1bHRQYXR0ZXJuLm51bGxfdGV4dF9jb2xvciB8fCBcIndoaXRlXCI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGV4dENvbG9yO1xyXG59O1xyXG5sZXQgZ2V0T3ZlcnJpZGVkVGV4dENvbG9yID0gZnVuY3Rpb24gKHRleHRDb2xvcnNfb3ZlcnJpZGVzOiBTdHJpbmcsIHZhbHVlOiBOdW1iZXIsIGRlZmF1bHR0ZXh0Q29sb3I6IFN0cmluZyk6IFN0cmluZyB7XHJcbiAgICBsZXQgdGV4dENvbG9yID0gZGVmYXVsdHRleHRDb2xvcjtcclxuICAgIGxldCBfdGV4dENvbG9yc19vdmVycmlkZXMgPSB0ZXh0Q29sb3JzX292ZXJyaWRlcy5zcGxpdChcInxcIikuZmlsdGVyKGNvbiA9PiBjb24uaW5kZXhPZihcIi0+XCIpID4gLTEpLm1hcChjb24gPT4gY29uLnNwbGl0KFwiLT5cIikpLmZpbHRlcihjb24gPT4gKyhjb25bMF0pID09PSB2YWx1ZSkubWFwKGNvbiA9PiBjb25bMV0pO1xyXG4gICAgaWYgKF90ZXh0Q29sb3JzX292ZXJyaWRlcy5sZW5ndGggPiAwICYmIF90ZXh0Q29sb3JzX292ZXJyaWRlc1swXSAhPT0gXCJcIikge1xyXG4gICAgICAgIHRleHRDb2xvciA9IHV0aWxzLm5vcm1hbGl6ZUNvbG9yKChcIlwiICsgX3RleHRDb2xvcnNfb3ZlcnJpZGVzWzBdKS50cmltKCkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRleHRDb2xvcjtcclxufTtcclxubGV0IGFwcGx5Rm9udEF3ZXNvbWVJY29ucyA9IGZ1bmN0aW9uIChzZXJpZXM6IFNlcmllcyk6IFNlcmllcyB7XHJcbiAgICBzZXJpZXMuYWN0dWFsX2Rpc3BsYXl2YWx1ZSA9IHNlcmllcy5kaXNwbGF5VmFsdWU7XHJcbiAgICBzZXJpZXMuYWN0dWFsX3Jvd19uYW1lID0gc2VyaWVzLnJvd19uYW1lO1xyXG4gICAgc2VyaWVzLmFjdHVhbF9jb2xfbmFtZSA9IHNlcmllcy5jb2xfbmFtZTtcclxuICAgIGlmIChzZXJpZXMuZGlzcGxheVZhbHVlICYmIHNlcmllcy5kaXNwbGF5VmFsdWUuaW5kZXhPZihcIl9mYS1cIikgPiAtMSkge1xyXG4gICAgICAgIHNlcmllcy5kaXNwbGF5VmFsdWUgPSB1dGlscy5yZXBsYWNlRm9udEF3ZXNvbWVJY29ucyhzZXJpZXMuZGlzcGxheVZhbHVlKTtcclxuICAgIH1cclxuICAgIGlmIChzZXJpZXMucm93X25hbWUgJiYgc2VyaWVzLnJvd19uYW1lLmluZGV4T2YoXCJfZmEtXCIpID4gLTEpIHtcclxuICAgICAgICBzZXJpZXMucm93X25hbWUgPSB1dGlscy5yZXBsYWNlRm9udEF3ZXNvbWVJY29ucyhzZXJpZXMucm93X25hbWUpO1xyXG4gICAgfVxyXG4gICAgaWYgKHNlcmllcy5jb2xfbmFtZSAmJiBzZXJpZXMuY29sX25hbWUuaW5kZXhPZihcIl9mYS1cIikgPiAtMSkge1xyXG4gICAgICAgIHNlcmllcy5jb2xfbmFtZSA9IHV0aWxzLnJlcGxhY2VGb250QXdlc29tZUljb25zKHNlcmllcy5jb2xfbmFtZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc2VyaWVzO1xyXG59O1xyXG5sZXQgYXBwbHlJbWFnZVRyYW5zZm9ybSA9IGZ1bmN0aW9uIChzZXJpZXM6IFNlcmllcyk6IFNlcmllcyB7XHJcbiAgICBpZiAoc2VyaWVzLmRpc3BsYXlWYWx1ZSAmJiBzZXJpZXMuZGlzcGxheVZhbHVlLmluZGV4T2YoXCJfaW1nLVwiKSA+IC0xKSB7XHJcbiAgICAgICAgc2VyaWVzLmRpc3BsYXlWYWx1ZSA9IHV0aWxzLnJlcGxhY2VXaXRoSW1hZ2VzKHNlcmllcy5kaXNwbGF5VmFsdWUpO1xyXG4gICAgfVxyXG4gICAgaWYgKHNlcmllcy5yb3dfbmFtZSAmJiBzZXJpZXMucm93X25hbWUuaW5kZXhPZihcIl9pbWctXCIpID4gLTEpIHtcclxuICAgICAgICBzZXJpZXMucm93X25hbWUgPSB1dGlscy5yZXBsYWNlV2l0aEltYWdlcyhzZXJpZXMucm93X25hbWUpO1xyXG4gICAgfVxyXG4gICAgaWYgKHNlcmllcy5jb2xfbmFtZSAmJiBzZXJpZXMuY29sX25hbWUuaW5kZXhPZihcIl9pbWctXCIpID4gLTEpIHtcclxuICAgICAgICBzZXJpZXMuY29sX25hbWUgPSB1dGlscy5yZXBsYWNlV2l0aEltYWdlcyhzZXJpZXMuY29sX25hbWUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNlcmllcztcclxufTtcclxubGV0IGFzc2lnbkNsaWNrYWJsZUxpbmtzID0gZnVuY3Rpb24gKHNlcmllczogU2VyaWVzKTogU2VyaWVzIHtcclxuICAgIGlmIChzZXJpZXMucGF0dGVybi5lbmFibGVfY2xpY2thYmxlX2NlbGxzKSB7XHJcbiAgICAgICAgbGV0IHRhcmdldExpbmsgPSBzZXJpZXMucGF0dGVybi5jbGlja2FibGVfY2VsbHNfbGluayB8fCBcIiNcIjtcclxuICAgICAgICB0YXJnZXRMaW5rID0gdGFyZ2V0TGluay5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfcm93X25hbWVfXCIsIFwiZ1wiKSwgdXRpbHMuZ2V0QWN0dWFsTmFtZVdpdGhvdXRUcmFuc2Zvcm1TaWduKHNlcmllcy5hY3R1YWxfcm93X25hbWUpLnRyaW0oKSk7XHJcbiAgICAgICAgdGFyZ2V0TGluayA9IHRhcmdldExpbmsucmVwbGFjZShuZXcgUmVnRXhwKFwiX2NvbF9uYW1lX1wiLCBcImdcIiksIHV0aWxzLmdldEFjdHVhbE5hbWVXaXRob3V0VHJhbnNmb3JtU2lnbihzZXJpZXMuYWN0dWFsX2NvbF9uYW1lKS50cmltKCkpO1xyXG4gICAgICAgIHRhcmdldExpbmsgPSB0YXJnZXRMaW5rLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV9cIiwgXCJnXCIpLCB1dGlscy5nZXRBY3R1YWxOYW1lV2l0aG91dFRyYW5zZm9ybVNpZ24oc2VyaWVzLnZhbHVlKS50cmltKCkpO1xyXG4gICAgICAgIHNlcmllcy5kaXNwbGF5VmFsdWUgPSBgPGEgaHJlZj1cIiR7dGFyZ2V0TGlua31cIiB0YXJnZXQ9XCJfYmxhbmtcIj4ke3Nlcmllcy5kaXNwbGF5VmFsdWV9PC9hPmA7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc2VyaWVzO1xyXG59O1xyXG5sZXQgY29tcHV0ZSA9IGZ1bmN0aW9uIChkYXRhQ29tcHV0ZWQ6IFNlcmllc1tdLCBkZWZhdWx0UGF0dGVybjogUGF0dGVybiwgcGF0dGVybnM6IFBhdHRlcm5bXSwgcm93X2NvbF93cmFwcGVyOiBTdHJpbmcpOiBTZXJpZXNbXSB7XHJcbiAgICBkYXRhQ29tcHV0ZWQgPSBkYXRhQ29tcHV0ZWQubWFwKHNlcmllcyA9PiB7XHJcbiAgICAgICAgc2VyaWVzLnBhdHRlcm4gPSBnZXRQYXR0ZXJuKHBhdHRlcm5zLCBkZWZhdWx0UGF0dGVybiwgc2VyaWVzLmFsaWFzKTtcclxuICAgICAgICBzZXJpZXMuZGVjaW1hbHMgPSBzZXJpZXMucGF0dGVybi5kZWNpbWFscyB8fCBkZWZhdWx0UGF0dGVybi5kZWNpbWFscztcclxuICAgICAgICByZXR1cm4gc2VyaWVzO1xyXG4gICAgfSk7XHJcbiAgICBkYXRhQ29tcHV0ZWQgPSBkYXRhQ29tcHV0ZWQubWFwKHNlcmllcyA9PiBhc3NpZ25WYWx1ZShzZXJpZXMsIGRlZmF1bHRQYXR0ZXJuKSk7XHJcbiAgICBkYXRhQ29tcHV0ZWQgPSBkYXRhQ29tcHV0ZWQuZmlsdGVyKHNlcmllcyA9PiBmaWx0ZXJWYWx1ZXMoc2VyaWVzKSk7XHJcbiAgICBkYXRhQ29tcHV0ZWQgPSBkYXRhQ29tcHV0ZWQubWFwKHNlcmllcyA9PiB7XHJcbiAgICAgICAgc2VyaWVzLnJvd19uYW1lID0gZ2V0Um93TmFtZShzZXJpZXMuYWxpYXMsIHNlcmllcy5wYXR0ZXJuLCBkZWZhdWx0UGF0dGVybiwgcm93X2NvbF93cmFwcGVyKTtcclxuICAgICAgICBzZXJpZXMuY29sX25hbWUgPSBnZXRDb2xOYW1lKHNlcmllcy5hbGlhcywgc2VyaWVzLnJvd19uYW1lLCBzZXJpZXMucGF0dGVybiwgZGVmYXVsdFBhdHRlcm4sIHJvd19jb2xfd3JhcHBlcik7XHJcbiAgICAgICAgc2VyaWVzLmtleV9uYW1lID0gc2VyaWVzLnJvd19uYW1lICsgXCIjXCIgKyBzZXJpZXMuY29sX25hbWU7XHJcbiAgICAgICAgc2VyaWVzLnRocmVzaG9sZHMgPSBnZXRUaHJlc2hvbGRzKHNlcmllcy5wYXR0ZXJuLCBkZWZhdWx0UGF0dGVybiwgX19fZ2V0U2VydmVyVGltZXN0YW1wKHNlcmllcykpO1xyXG4gICAgICAgIHNlcmllcy5lbmFibGVfYmdDb2xvciA9IHNlcmllcy5wYXR0ZXJuLmVuYWJsZV9iZ0NvbG9yO1xyXG4gICAgICAgIHNlcmllcy5iZ0NvbG9ycyA9IChzZXJpZXMucGF0dGVybi5iZ0NvbG9ycyB8fCBkZWZhdWx0UGF0dGVybi5iZ0NvbG9ycyB8fCBcIlwiKS5zcGxpdChcInxcIik7XHJcbiAgICAgICAgc2VyaWVzLmJnQ29sb3IgPSBnZXRCZ0NvbG9yKHNlcmllcy5wYXR0ZXJuLCBkZWZhdWx0UGF0dGVybiwgc2VyaWVzLmVuYWJsZV9iZ0NvbG9yLCBzZXJpZXMudGhyZXNob2xkcywgc2VyaWVzLmJnQ29sb3JzLCBzZXJpZXMudmFsdWUsIHNlcmllcy5kaXNwbGF5VmFsdWUpO1xyXG4gICAgICAgIHNlcmllcy5lbmFibGVfYmdDb2xvcl9vdmVycmlkZXMgPSBzZXJpZXMucGF0dGVybi5lbmFibGVfYmdDb2xvcl9vdmVycmlkZXM7XHJcbiAgICAgICAgc2VyaWVzLmJnQ29sb3JzX292ZXJyaWRlcyA9IHNlcmllcy5wYXR0ZXJuLmJnQ29sb3JzX292ZXJyaWRlcyB8fCBcIlwiO1xyXG4gICAgICAgIGlmIChzZXJpZXMuZW5hYmxlX2JnQ29sb3Jfb3ZlcnJpZGVzICYmIHNlcmllcy5iZ0NvbG9yc19vdmVycmlkZXMgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgc2VyaWVzLmJnQ29sb3IgPSBnZXRPdmVycmlkZWRCR0NvbG9yKHNlcmllcy5iZ0NvbG9yc19vdmVycmlkZXMsIHNlcmllcy52YWx1ZSwgc2VyaWVzLmJnQ29sb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZXJpZXMuZW5hYmxlX1RleHRDb2xvcnMgPSBzZXJpZXMucGF0dGVybi5lbmFibGVfVGV4dENvbG9ycztcclxuICAgICAgICBzZXJpZXMudGV4dENvbG9ycyA9IChzZXJpZXMucGF0dGVybi50ZXh0Q29sb3JzIHx8IGRlZmF1bHRQYXR0ZXJuLnRleHRDb2xvcnMgfHwgXCJcIikuc3BsaXQoXCJ8XCIpO1xyXG4gICAgICAgIHNlcmllcy50ZXh0Q29sb3IgPSBnZXRUZXh0Q29sb3Ioc2VyaWVzLnBhdHRlcm4sIGRlZmF1bHRQYXR0ZXJuLCBzZXJpZXMuZW5hYmxlX1RleHRDb2xvcnMsIHNlcmllcy50aHJlc2hvbGRzLCBzZXJpZXMudGV4dENvbG9ycywgc2VyaWVzLnZhbHVlLCBzZXJpZXMuZGlzcGxheVZhbHVlKTtcclxuICAgICAgICBzZXJpZXMuZW5hYmxlX1RleHRDb2xvcl9vdmVycmlkZXMgPSBzZXJpZXMucGF0dGVybi5lbmFibGVfVGV4dENvbG9yX292ZXJyaWRlcztcclxuICAgICAgICBzZXJpZXMudGV4dENvbG9yc19vdmVycmlkZXMgPSBzZXJpZXMucGF0dGVybi50ZXh0Q29sb3JzX292ZXJyaWRlcyB8fCBcIlwiO1xyXG4gICAgICAgIGlmIChzZXJpZXMuZW5hYmxlX1RleHRDb2xvcl9vdmVycmlkZXMgJiYgc2VyaWVzLnRleHRDb2xvcnNfb3ZlcnJpZGVzICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIHNlcmllcy50ZXh0Q29sb3IgPSBnZXRPdmVycmlkZWRUZXh0Q29sb3Ioc2VyaWVzLnRleHRDb2xvcnNfb3ZlcnJpZGVzLCBzZXJpZXMudmFsdWUsIHNlcmllcy50ZXh0Q29sb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZXJpZXMuZW5hYmxlX3RyYW5zZm9ybSA9IHNlcmllcy5wYXR0ZXJuLmVuYWJsZV90cmFuc2Zvcm07XHJcbiAgICAgICAgc2VyaWVzLnRyYW5zZm9ybV92YWx1ZXMgPSAoc2VyaWVzLnBhdHRlcm4udHJhbnNmb3JtX3ZhbHVlcyB8fCBkZWZhdWx0UGF0dGVybi50cmFuc2Zvcm1fdmFsdWVzKS5zcGxpdChcInxcIik7XHJcbiAgICAgICAgc2VyaWVzLmRpc3BsYXlWYWx1ZSA9IHNlcmllcy5lbmFibGVfdHJhbnNmb3JtID09PSB0cnVlID8gX19fdHJhbnNmb3JtVmFsdWUoc2VyaWVzLnRocmVzaG9sZHMsIHNlcmllcy50cmFuc2Zvcm1fdmFsdWVzLCBzZXJpZXMudmFsdWUsIHNlcmllcy5kaXNwbGF5VmFsdWUsIHNlcmllcy5yb3dfbmFtZSwgc2VyaWVzLmNvbF9uYW1lKSA6IHNlcmllcy5kaXNwbGF5VmFsdWU7XHJcbiAgICAgICAgaWYgKHNlcmllcy5kaXNwbGF5VmFsdWUgPT09IChzZXJpZXMucGF0dGVybi5udWxsX3ZhbHVlIHx8IGRlZmF1bHRQYXR0ZXJuLm51bGxfdmFsdWUgfHwgXCJOdWxsXCIpKSB7XHJcbiAgICAgICAgICAgIHNlcmllcy5kaXNwbGF5VmFsdWUgPSBzZXJpZXMucGF0dGVybi5udWxsX3ZhbHVlIHx8IGRlZmF1bHRQYXR0ZXJuLm51bGxfdmFsdWU7XHJcbiAgICAgICAgfSBlbHNlIGlmIChpc05hTihzZXJpZXMudmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHNlcmllcy5kaXNwbGF5VmFsdWUgPSBzZXJpZXMucGF0dGVybi5udWxsX3ZhbHVlIHx8IGRlZmF1bHRQYXR0ZXJuLm51bGxfdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNlcmllcy5lbmFibGVfdHJhbnNmb3JtX292ZXJyaWRlcyA9IHNlcmllcy5wYXR0ZXJuLmVuYWJsZV90cmFuc2Zvcm1fb3ZlcnJpZGVzO1xyXG4gICAgICAgIHNlcmllcy50cmFuc2Zvcm1fdmFsdWVzX292ZXJyaWRlcyA9IHNlcmllcy5wYXR0ZXJuLnRyYW5zZm9ybV92YWx1ZXNfb3ZlcnJpZGVzIHx8IFwiXCI7XHJcbiAgICAgICAgaWYgKHNlcmllcy5lbmFibGVfdHJhbnNmb3JtX292ZXJyaWRlcyAmJiBzZXJpZXMudHJhbnNmb3JtX3ZhbHVlc19vdmVycmlkZXMgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgc2VyaWVzLmRpc3BsYXlWYWx1ZSA9IGdldERpc3BsYXlWYWx1ZU92ZXJyaWRlKHNlcmllcy50cmFuc2Zvcm1fdmFsdWVzX292ZXJyaWRlcywgc2VyaWVzLnZhbHVlLCBzZXJpZXMucm93X25hbWUsIHNlcmllcy5jb2xfbmFtZSwgc2VyaWVzLmRpc3BsYXlWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNlcmllcy50b29sdGlwVGVtcGxhdGUgPSBzZXJpZXMucGF0dGVybi50b29sdGlwVGVtcGxhdGUgfHwgZGVmYXVsdFBhdHRlcm4udG9vbHRpcFRlbXBsYXRlIHx8IFwiUm93IE5hbWUgOiBfcm93X25hbWVfIDxici8+Q29sIE5hbWUgOiBfY29sX25hbWVfIDxici8+VmFsdWUgOiBfdmFsdWVfXCI7XHJcbiAgICAgICAgcmV0dXJuIHNlcmllcztcclxuICAgIH0pO1xyXG4gICAgZGF0YUNvbXB1dGVkID0gZGF0YUNvbXB1dGVkLm1hcChzZXJpZXMgPT4gYXBwbHlGb250QXdlc29tZUljb25zKHNlcmllcykpO1xyXG4gICAgZGF0YUNvbXB1dGVkID0gZGF0YUNvbXB1dGVkLm1hcChzZXJpZXMgPT4gYXBwbHlJbWFnZVRyYW5zZm9ybShzZXJpZXMpKTtcclxuICAgIGRhdGFDb21wdXRlZCA9IGRhdGFDb21wdXRlZC5tYXAoc2VyaWVzID0+IGFzc2lnbkNsaWNrYWJsZUxpbmtzKHNlcmllcykpO1xyXG4gICAgcmV0dXJuIGRhdGFDb21wdXRlZDtcclxufTtcclxuZXhwb3J0IHtcclxuICAgIGNvbXB1dGUsXHJcbiAgICBkZWZhdWx0SGFuZGxlclxyXG59O1xyXG4iXX0=