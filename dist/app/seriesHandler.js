System.register(["lodash", "app/core/utils/kbn", "app/core/time_series2", "./utils"], function (exports_1, context_1) {
    "use strict";
    var lodash_1, kbn_1, time_series2_1, utils, ___computeDisplayValueFromThresholds, ___computeColorFromThresholds, ___getServerTimestamp, defaultHandler, findMatchingPattern, getRowName, getColName, getThresholds, assignValue, filterValues, getDisplayValueOverride, getOverridedBGColor, getOverridedTextColor, applyFontAwesomeIcons, applyImageTransform, compute;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (lodash_1_1) {
                lodash_1 = lodash_1_1;
            },
            function (kbn_1_1) {
                kbn_1 = kbn_1_1;
            },
            function (time_series2_1_1) {
                time_series2_1 = time_series2_1_1;
            },
            function (utils_1) {
                utils = utils_1;
            }
        ],
        execute: function () {
            ___computeDisplayValueFromThresholds = function (thresholds, transform_values, value, displayValue, row_name, col_name) {
                var t = value;
                if (thresholds && transform_values && typeof value === "number" && thresholds.length + 1 <= transform_values.length) {
                    transform_values = lodash_1.default.dropRight(transform_values, transform_values.length - thresholds.length - 1);
                    if (transform_values[transform_values.length - 1] === "") {
                        transform_values[transform_values.length - 1] = "_value_";
                    }
                    for (var i = thresholds.length; i > 0; i--) {
                        if (value >= thresholds[i - 1]) {
                            var o_1 = transform_values[i];
                            o_1 = o_1.replace(new RegExp("_value_", "g"), String(displayValue));
                            o_1 = o_1.replace(new RegExp("_row_name_", "g"), String(row_name));
                            o_1 = o_1.replace(new RegExp("_col_name_", "g"), String(col_name));
                            return o_1;
                        }
                    }
                    var o = lodash_1.default.first(transform_values) || "";
                    o = o.replace(new RegExp("_value_", "g"), String(displayValue));
                    o = o.replace(new RegExp("_row_name_", "g"), String(row_name));
                    o = o.replace(new RegExp("_col_name_", "g"), String(col_name));
                    return o;
                }
                return String(t);
            };
            ___computeColorFromThresholds = function (thresholds, bgColors, value, defaultColor) {
                var c = defaultColor;
                if (thresholds && bgColors && typeof value === "number" && thresholds.length + 1 <= bgColors.length) {
                    bgColors = lodash_1.default.dropRight(bgColors, bgColors.length - thresholds.length - 1);
                    if (bgColors[bgColors.length - 1] === "") {
                        bgColors[bgColors.length - 1] = defaultColor;
                    }
                    for (var i = thresholds.length; i > 0; i--) {
                        if (value >= thresholds[i - 1]) {
                            return utils.normalizeColor(bgColors[i]);
                        }
                    }
                    return utils.normalizeColor(lodash_1.default.first(bgColors));
                }
                return c;
            };
            ___getServerTimestamp = function (series) {
                var current_servertimestamp = new Date();
                if (series && series.datapoints && series.datapoints.length > 0) {
                    if (lodash_1.default.last(series.datapoints).length === 2) {
                        current_servertimestamp = new Date(lodash_1.default.last(series.datapoints)[1]);
                    }
                }
                return current_servertimestamp;
            };
            defaultHandler = function (seriesData) {
                var series = new time_series2_1.default({
                    datapoints: seriesData.datapoints || [],
                    alias: seriesData.target
                });
                series.flotpairs = series.getFlotPairs("connected");
                return series;
            };
            exports_1("defaultHandler", defaultHandler);
            findMatchingPattern = function (patterns, defaultPattern, alias) {
                var activePatterns = patterns.filter(function (p) { return p.disabled !== true; });
                var matchingPattern = lodash_1.default.find(activePatterns, function (p) { return alias.match(p.pattern); });
                return matchingPattern || defaultPattern;
            };
            getRowName = function (alias, pattern, defaultPattern, row_col_wrapper) {
                var row_name = alias.split(String(pattern.delimiter) || ".").reduce(function (r, it, i) {
                    return r.replace(new RegExp(String(row_col_wrapper) + i + String(row_col_wrapper), "g"), it);
                }, pattern.row_name.replace(new RegExp(row_col_wrapper + "series" + row_col_wrapper, "g"), String(alias)) || defaultPattern.row_name.replace(new RegExp(row_col_wrapper + "series" + row_col_wrapper, "g"), String(alias)));
                if (alias.split(String(pattern.delimiter) || ".").length === 1) {
                    row_name = String(alias);
                }
                return row_name;
            };
            getColName = function (alias, row_name, pattern, defaultPattern, row_col_wrapper) {
                var col_name = alias.split(String(pattern.delimiter) || ".").reduce(function (r, it, i) {
                    return r.replace(new RegExp(String(row_col_wrapper) + i + String(row_col_wrapper), "g"), it);
                }, pattern.col_name || defaultPattern.col_name);
                if (alias.split(String(pattern.delimiter) || ".").length === 1 || row_name === alias) {
                    col_name = pattern.col_name || "Value";
                }
                return col_name;
            };
            getThresholds = function (pattern, defaultPattern, current_servertimestamp) {
                var thresholds = (pattern.thresholds || defaultPattern.thresholds).split(",").map(function (d) { return +d; });
                if (pattern.enable_time_based_thresholds) {
                    var metricrecivedTimeStamp_1 = current_servertimestamp || new Date();
                    var metricrecivedTimeStamp_innumber_1 = metricrecivedTimeStamp_1.getHours() * 100 + metricrecivedTimeStamp_1.getMinutes();
                    var weekdays_1 = ["sun", "mon", "tue", "wed", "thu", "fri", "sat"];
                    lodash_1.default.each(pattern.time_based_thresholds, function (tbtx) {
                        if (tbtx && tbtx.from && tbtx.to && tbtx.enabledDays &&
                            (metricrecivedTimeStamp_innumber_1 >= +(tbtx.from)) &&
                            (metricrecivedTimeStamp_innumber_1 <= +(tbtx.to)) &&
                            (tbtx.enabledDays.toLowerCase().indexOf(weekdays_1[metricrecivedTimeStamp_1.getDay()]) > -1) &&
                            tbtx.threshold) {
                            thresholds = (tbtx.threshold + "").split(",").map(function (d) { return +d; });
                        }
                    });
                }
                return thresholds;
            };
            assignValue = function (series, defaultPattern) {
                if (!isNaN(series.value)) {
                    var decimalInfo = utils.getDecimalsForValue(series.value, +(series.decimals));
                    var formatFunc = kbn_1.default.valueFormats[String(series.pattern.format) || String(defaultPattern.format)];
                    series.valueFormatted = formatFunc(series.value, decimalInfo.decimals, decimalInfo.scaledDecimals);
                    series.displayValue = series.valueFormatted;
                }
                return series;
            };
            filterValues = function (series) {
                if (!series.pattern.filter) {
                    series.pattern.filter = {
                        value_below: "",
                        value_above: ""
                    };
                }
                if (series.pattern && series.pattern.filter && (series.pattern.filter.value_below !== "" || series.pattern.filter.value_above !== "")) {
                    if (series.pattern.filter.value_below !== "" && series.value < +(series.pattern.filter.value_below)) {
                        return false;
                    }
                    if (series.pattern.filter.value_above !== "" && series.value > +(series.pattern.filter.value_above)) {
                        return false;
                    }
                    return true;
                }
                else {
                    return true;
                }
            };
            getDisplayValueOverride = function (transform_values_overrides, value, row_name, col_name, displayValue) {
                var _transform_values_overrides = transform_values_overrides.split("|").filter(function (con) { return con.indexOf("->") > -1; }).map(function (con) { return con.split("->"); }).filter(function (con) { return +(con[0]) === value; }).map(function (con) { return con[1]; });
                if (_transform_values_overrides.length > 0 && _transform_values_overrides[0] !== "") {
                    displayValue = ("" + _transform_values_overrides[0]).trim().replace(new RegExp("_value_", "g"), String(displayValue)).replace(new RegExp("_row_name_", "g"), String(row_name)).replace(new RegExp("_col_name_", "g"), String(col_name));
                }
                return displayValue;
            };
            getOverridedBGColor = function (bgColors_overrides, value, defaultBGColor) {
                var bgColor = defaultBGColor;
                var _bgColors_overrides = bgColors_overrides.split("|").filter(function (con) { return con.indexOf("->") > -1; }).map(function (con) { return con.split("->"); }).filter(function (con) { return +(con[0]) === value; }).map(function (con) { return con[1]; });
                if (_bgColors_overrides.length > 0 && _bgColors_overrides[0] !== "") {
                    bgColor = utils.normalizeColor(("" + _bgColors_overrides[0]).trim());
                }
                return bgColor;
            };
            getOverridedTextColor = function (textColors_overrides, value, defaulttextColor) {
                var textColor = defaulttextColor;
                var _textColors_overrides = textColors_overrides.split("|").filter(function (con) { return con.indexOf("->") > -1; }).map(function (con) { return con.split("->"); }).filter(function (con) { return +(con[0]) === value; }).map(function (con) { return con[1]; });
                if (_textColors_overrides.length > 0 && _textColors_overrides[0] !== "") {
                    textColor = utils.normalizeColor(("" + _textColors_overrides[0]).trim());
                }
                return textColor;
            };
            applyFontAwesomeIcons = function (series) {
                series.actual_displayvalue = series.displayValue;
                series.actual_row_name = series.row_name;
                series.actual_col_name = series.col_name;
                if (series.displayValue && series.displayValue.indexOf("_fa-") > -1) {
                    series.displayValue = utils.replaceFontAwesomeIcons(series.displayValue);
                }
                if (series.row_name && series.row_name.indexOf("_fa-") > -1) {
                    series.row_name = utils.replaceFontAwesomeIcons(series.row_name);
                }
                if (series.col_name && series.col_name.indexOf("_fa-") > -1) {
                    series.col_name = utils.replaceFontAwesomeIcons(series.col_name);
                }
                return series;
            };
            applyImageTransform = function (series) {
                if (series.displayValue && series.displayValue.indexOf("_img-") > -1) {
                    series.displayValue = utils.replaceWithImages(series.displayValue);
                }
                if (series.row_name && series.row_name.indexOf("_img-") > -1) {
                    series.row_name = utils.replaceWithImages(series.row_name);
                }
                if (series.col_name && series.col_name.indexOf("_img-") > -1) {
                    series.col_name = utils.replaceWithImages(series.col_name);
                }
                return series;
            };
            compute = function (dataComputed, defaultPattern, patterns, row_col_wrapper) {
                dataComputed = dataComputed.map(function (series) {
                    series.pattern = findMatchingPattern(patterns, defaultPattern, series.alias);
                    series.decimals = series.pattern.decimals || defaultPattern.decimals;
                    series.value = series.stats ? series.stats[String(series.pattern.valueName) || String(defaultPattern.valueName)] : null;
                    return series;
                });
                dataComputed = dataComputed.map(function (series) { return assignValue(series, defaultPattern); });
                dataComputed = dataComputed.map(function (series) {
                    var thresholds = getThresholds(series.pattern, defaultPattern, ___getServerTimestamp(series));
                    series.row_name = getRowName(series.alias, series.pattern, defaultPattern, row_col_wrapper);
                    series.col_name = getColName(series.alias, series.row_name, series.pattern, defaultPattern, row_col_wrapper);
                    series.key_name = series.row_name + "#" + series.col_name;
                    series.tooltipTemplate = series.pattern.tooltipTemplate || defaultPattern.tooltipTemplate || "Series : _series_ | Value : _value_";
                    if (thresholds.length > 0) {
                        if (series.pattern.enable_bgColor) {
                            var bgColors = (series.pattern.bgColors || defaultPattern.bgColors || "").split("|");
                            series.bgColor = ___computeColorFromThresholds(thresholds, bgColors, series.value, "transparent");
                        }
                        if (series.pattern.enable_TextColors) {
                            var textColors = (series.pattern.textColors || defaultPattern.textColors || "").split("|");
                            series.textColor = ___computeColorFromThresholds(thresholds, textColors, series.value, "white");
                        }
                        if (series.pattern.enable_transform) {
                            var transform_values = (series.pattern.transform_values || defaultPattern.transform_values).split("|");
                            series.displayValue = ___computeDisplayValueFromThresholds(thresholds, transform_values, series.value, series.displayValue, series.row_name, series.col_name);
                        }
                    }
                    if (series.pattern.enable_bgColor_overrides && series.pattern.bgColors_overrides) {
                        series.bgColor = getOverridedBGColor(series.pattern.bgColors_overrides, series.value, series.bgColor || "transparent");
                    }
                    if (series.pattern.enable_TextColor_overrides && series.pattern.textColors_overrides) {
                        series.textColor = getOverridedTextColor(series.pattern.textColors_overrides, series.value, series.textColor || "white");
                    }
                    if (series.pattern.enable_transform_overrides && series.pattern.transform_values_overrides) {
                        series.displayValue = getDisplayValueOverride(series.pattern.transform_values_overrides, series.value, series.row_name, series.col_name, series.displayValue);
                    }
                    if (lodash_1.default.isNaN(series.value) || series.value === null) {
                        series.bgColor = series.pattern.null_color || defaultPattern.null_color || "darkred";
                        series.textColor = series.pattern.null_text_color || defaultPattern.null_text_color || "white";
                        series.displayValue = series.pattern.null_value || defaultPattern.null_value || "No data";
                    }
                    if (series.pattern.enable_clickable_cells) {
                        var targetLink = series.pattern.clickable_cells_link || "#";
                        targetLink = targetLink.replace(new RegExp("_row_name_", "g"), utils.getActualNameWithoutTransformSign(series.actual_row_name).trim());
                        targetLink = targetLink.replace(new RegExp("_col_name_", "g"), utils.getActualNameWithoutTransformSign(series.actual_col_name).trim());
                        targetLink = targetLink.replace(new RegExp("_value_", "g"), utils.getActualNameWithoutTransformSign(series.value).trim());
                        series.displayValue = "<a href=\"" + targetLink + "\" target=\"_blank\">" + series.displayValue + "</a>";
                    }
                    return series;
                });
                dataComputed = dataComputed.map(function (series) { return applyFontAwesomeIcons(series); });
                dataComputed = dataComputed.map(function (series) { return applyImageTransform(series); });
                dataComputed = dataComputed.filter(function (series) { return filterValues(series); });
                return dataComputed;
            };
            exports_1("compute", compute);
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VyaWVzSGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hcHAvc2VyaWVzSGFuZGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztZQVFJLG9DQUFvQyxHQUFHLFVBQVUsVUFBb0IsRUFBRSxnQkFBMEIsRUFBRSxLQUFhLEVBQUUsWUFBb0IsRUFBRSxRQUFnQixFQUFFLFFBQWdCO2dCQUMxSyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUM7Z0JBQ2QsSUFBSSxVQUFVLElBQUksZ0JBQWdCLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxJQUFJLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLGdCQUFnQixDQUFDLE1BQU0sRUFBRTtvQkFDakgsZ0JBQWdCLEdBQUcsZ0JBQUMsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLEVBQUUsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQ2xHLElBQUksZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTt3QkFDdEQsZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLFNBQVMsQ0FBQztxQkFDN0Q7b0JBQ0QsS0FBSyxJQUFJLENBQUMsR0FBRyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7d0JBQ3hDLElBQUksS0FBSyxJQUFJLFVBQVUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7NEJBQzVCLElBQUksR0FBQyxHQUFHLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUM1QixHQUFDLEdBQUcsR0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLEVBQUUsTUFBTSxDQUFDLFlBQVks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LENBQUMsWUFBWSxTQUFNLENBQUM7cUJBQzlGO29CQUNELE9BQU8sTUFBTSxDQUFDO2dCQUNsQixDQUFDLENBQUMsQ0FBQztnQkFDSCxZQUFZLEdBQUcsWUFBWSxDQUFDLEdBQUcsQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxFQUE3QixDQUE2QixDQUFDLENBQUM7Z0JBQ3pFLFlBQVksR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDLFVBQUEsTUFBTSxJQUFJLE9BQUEsbUJBQW1CLENBQUMsTUFBTSxDQUFDLEVBQTNCLENBQTJCLENBQUMsQ0FBQztnQkFDdkUsWUFBWSxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUMsVUFBQSxNQUFNLElBQUksT0FBQSxZQUFZLENBQUMsTUFBTSxDQUFDLEVBQXBCLENBQW9CLENBQUMsQ0FBQztnQkFDbkUsT0FBTyxZQUFZLENBQUM7WUFDeEIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vbm9kZV9tb2R1bGVzL2dyYWZhbmEtc2RrLW1vY2tzL2FwcC9oZWFkZXJzL2NvbW1vbi5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCBfIGZyb20gXCJsb2Rhc2hcIjtcclxuaW1wb3J0IGtibiBmcm9tIFwiYXBwL2NvcmUvdXRpbHMva2JuXCI7XHJcbmltcG9ydCBUaW1lU2VyaWVzIGZyb20gXCJhcHAvY29yZS90aW1lX3NlcmllczJcIjtcclxuaW1wb3J0ICogYXMgdXRpbHMgZnJvbSBcIi4vdXRpbHNcIjtcclxuaW1wb3J0IHsgU2VyaWVzLCBQYXR0ZXJuIH0gZnJvbSBcIi4vLi4vaW50ZXJmYWNlcy9pbnRlcmZhY2VzXCI7XHJcblxyXG5sZXQgX19fY29tcHV0ZURpc3BsYXlWYWx1ZUZyb21UaHJlc2hvbGRzID0gZnVuY3Rpb24gKHRocmVzaG9sZHM6IE51bWJlcltdLCB0cmFuc2Zvcm1fdmFsdWVzOiBTdHJpbmdbXSwgdmFsdWU6IE51bWJlciwgZGlzcGxheVZhbHVlOiBTdHJpbmcsIHJvd19uYW1lOiBTdHJpbmcsIGNvbF9uYW1lOiBTdHJpbmcpOiBTdHJpbmcge1xyXG4gICAgbGV0IHQgPSB2YWx1ZTtcclxuICAgIGlmICh0aHJlc2hvbGRzICYmIHRyYW5zZm9ybV92YWx1ZXMgJiYgdHlwZW9mIHZhbHVlID09PSBcIm51bWJlclwiICYmIHRocmVzaG9sZHMubGVuZ3RoICsgMSA8PSB0cmFuc2Zvcm1fdmFsdWVzLmxlbmd0aCkge1xyXG4gICAgICAgIHRyYW5zZm9ybV92YWx1ZXMgPSBfLmRyb3BSaWdodCh0cmFuc2Zvcm1fdmFsdWVzLCB0cmFuc2Zvcm1fdmFsdWVzLmxlbmd0aCAtIHRocmVzaG9sZHMubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgaWYgKHRyYW5zZm9ybV92YWx1ZXNbdHJhbnNmb3JtX3ZhbHVlcy5sZW5ndGggLSAxXSA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICB0cmFuc2Zvcm1fdmFsdWVzW3RyYW5zZm9ybV92YWx1ZXMubGVuZ3RoIC0gMV0gPSBcIl92YWx1ZV9cIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IHRocmVzaG9sZHMubGVuZ3RoOyBpID4gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA+PSB0aHJlc2hvbGRzW2kgLSAxXSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IG8gPSB0cmFuc2Zvcm1fdmFsdWVzW2ldO1xyXG4gICAgICAgICAgICAgICAgbyA9IG8ucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX1wiLCBcImdcIiksIFN0cmluZyhkaXNwbGF5VmFsdWUpKTtcclxuICAgICAgICAgICAgICAgIG8gPSBvLnJlcGxhY2UobmV3IFJlZ0V4cChcIl9yb3dfbmFtZV9cIiwgXCJnXCIpLCBTdHJpbmcocm93X25hbWUpKTtcclxuICAgICAgICAgICAgICAgIG8gPSBvLnJlcGxhY2UobmV3IFJlZ0V4cChcIl9jb2xfbmFtZV9cIiwgXCJnXCIpLCBTdHJpbmcoY29sX25hbWUpKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBvID0gXy5maXJzdCh0cmFuc2Zvcm1fdmFsdWVzKSB8fCBcIlwiO1xyXG4gICAgICAgIG8gPSBvLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV9cIiwgXCJnXCIpLCBTdHJpbmcoZGlzcGxheVZhbHVlKSk7XHJcbiAgICAgICAgbyA9IG8ucmVwbGFjZShuZXcgUmVnRXhwKFwiX3Jvd19uYW1lX1wiLCBcImdcIiksIFN0cmluZyhyb3dfbmFtZSkpO1xyXG4gICAgICAgIG8gPSBvLnJlcGxhY2UobmV3IFJlZ0V4cChcIl9jb2xfbmFtZV9cIiwgXCJnXCIpLCBTdHJpbmcoY29sX25hbWUpKTtcclxuICAgICAgICByZXR1cm4gbztcclxuICAgIH1cclxuICAgIHJldHVybiBTdHJpbmcodCk7XHJcbn07XHJcbmxldCBfX19jb21wdXRlQ29sb3JGcm9tVGhyZXNob2xkcyA9IGZ1bmN0aW9uICh0aHJlc2hvbGRzOiBOdW1iZXJbXSwgYmdDb2xvcnM6IFN0cmluZ1tdLCB2YWx1ZTogTnVtYmVyLCBkZWZhdWx0Q29sb3I6IFN0cmluZyk6IFN0cmluZyB7XHJcbiAgICBsZXQgYyA9IGRlZmF1bHRDb2xvcjtcclxuICAgIGlmICh0aHJlc2hvbGRzICYmIGJnQ29sb3JzICYmIHR5cGVvZiB2YWx1ZSA9PT0gXCJudW1iZXJcIiAmJiB0aHJlc2hvbGRzLmxlbmd0aCArIDEgPD0gYmdDb2xvcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgYmdDb2xvcnMgPSBfLmRyb3BSaWdodChiZ0NvbG9ycywgYmdDb2xvcnMubGVuZ3RoIC0gdGhyZXNob2xkcy5sZW5ndGggLSAxKTtcclxuICAgICAgICBpZiAoYmdDb2xvcnNbYmdDb2xvcnMubGVuZ3RoIC0gMV0gPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgYmdDb2xvcnNbYmdDb2xvcnMubGVuZ3RoIC0gMV0gPSBkZWZhdWx0Q29sb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGkgPSB0aHJlc2hvbGRzLmxlbmd0aDsgaSA+IDA7IGktLSkge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgPj0gdGhyZXNob2xkc1tpIC0gMV0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB1dGlscy5ub3JtYWxpemVDb2xvcihiZ0NvbG9yc1tpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHV0aWxzLm5vcm1hbGl6ZUNvbG9yKF8uZmlyc3QoYmdDb2xvcnMpKTtcclxuICAgIH1cclxuICAgIHJldHVybiBjO1xyXG59O1xyXG5sZXQgX19fZ2V0U2VydmVyVGltZXN0YW1wID0gZnVuY3Rpb24gKHNlcmllczogU2VyaWVzKTogRGF0ZSB7XHJcbiAgICBsZXQgY3VycmVudF9zZXJ2ZXJ0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xyXG4gICAgaWYgKHNlcmllcyAmJiBzZXJpZXMuZGF0YXBvaW50cyAmJiBzZXJpZXMuZGF0YXBvaW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgaWYgKF8ubGFzdChzZXJpZXMuZGF0YXBvaW50cykubGVuZ3RoID09PSAyKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRfc2VydmVydGltZXN0YW1wID0gbmV3IERhdGUoXy5sYXN0KHNlcmllcy5kYXRhcG9pbnRzKVsxXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGN1cnJlbnRfc2VydmVydGltZXN0YW1wO1xyXG59O1xyXG5sZXQgZGVmYXVsdEhhbmRsZXIgPSBmdW5jdGlvbiAoc2VyaWVzRGF0YTogU2VyaWVzKTogU2VyaWVzIHtcclxuICAgIGxldCBzZXJpZXM6IFNlcmllcyA9IG5ldyBUaW1lU2VyaWVzKHtcclxuICAgICAgICBkYXRhcG9pbnRzOiBzZXJpZXNEYXRhLmRhdGFwb2ludHMgfHwgW10sXHJcbiAgICAgICAgYWxpYXM6IHNlcmllc0RhdGEudGFyZ2V0XHJcbiAgICB9KTtcclxuICAgIHNlcmllcy5mbG90cGFpcnMgPSBzZXJpZXMuZ2V0RmxvdFBhaXJzKFwiY29ubmVjdGVkXCIpO1xyXG4gICAgcmV0dXJuIHNlcmllcztcclxufTtcclxubGV0IGZpbmRNYXRjaGluZ1BhdHRlcm4gPSBmdW5jdGlvbiAocGF0dGVybnM6IFBhdHRlcm5bXSwgZGVmYXVsdFBhdHRlcm46IFBhdHRlcm4sIGFsaWFzOiBTdHJpbmcpIHtcclxuICAgIGxldCBhY3RpdmVQYXR0ZXJucyA9IHBhdHRlcm5zLmZpbHRlcihwID0+IHsgcmV0dXJuIHAuZGlzYWJsZWQgIT09IHRydWU7IH0pO1xyXG4gICAgbGV0IG1hdGNoaW5nUGF0dGVybiA9IF8uZmluZChhY3RpdmVQYXR0ZXJucywgcCA9PiB7IHJldHVybiBhbGlhcy5tYXRjaChwLnBhdHRlcm4pOyB9KTtcclxuICAgIHJldHVybiBtYXRjaGluZ1BhdHRlcm4gfHwgZGVmYXVsdFBhdHRlcm47XHJcbn07XHJcbmxldCBnZXRSb3dOYW1lID0gZnVuY3Rpb24gKGFsaWFzOiBTdHJpbmcsIHBhdHRlcm46IFBhdHRlcm4sIGRlZmF1bHRQYXR0ZXJuOiBQYXR0ZXJuLCByb3dfY29sX3dyYXBwZXI6IFN0cmluZyk6IFN0cmluZyB7XHJcbiAgICBsZXQgcm93X25hbWU6IFN0cmluZyA9IGFsaWFzLnNwbGl0KFN0cmluZyhwYXR0ZXJuLmRlbGltaXRlcikgfHwgXCIuXCIpLnJlZHVjZSgociwgaXQsIGkpID0+IHtcclxuICAgICAgICByZXR1cm4gci5yZXBsYWNlKG5ldyBSZWdFeHAoU3RyaW5nKHJvd19jb2xfd3JhcHBlcikgKyBpICsgU3RyaW5nKHJvd19jb2xfd3JhcHBlciksIFwiZ1wiKSwgaXQpO1xyXG4gICAgfSwgcGF0dGVybi5yb3dfbmFtZS5yZXBsYWNlKG5ldyBSZWdFeHAocm93X2NvbF93cmFwcGVyICsgXCJzZXJpZXNcIiArIHJvd19jb2xfd3JhcHBlciwgXCJnXCIpLCBTdHJpbmcoYWxpYXMpKSB8fCBkZWZhdWx0UGF0dGVybi5yb3dfbmFtZS5yZXBsYWNlKG5ldyBSZWdFeHAocm93X2NvbF93cmFwcGVyICsgXCJzZXJpZXNcIiArIHJvd19jb2xfd3JhcHBlciwgXCJnXCIpLCBTdHJpbmcoYWxpYXMpKSk7XHJcbiAgICBpZiAoYWxpYXMuc3BsaXQoU3RyaW5nKHBhdHRlcm4uZGVsaW1pdGVyKSB8fCBcIi5cIikubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgcm93X25hbWUgPSBTdHJpbmcoYWxpYXMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJvd19uYW1lO1xyXG59O1xyXG5sZXQgZ2V0Q29sTmFtZSA9IGZ1bmN0aW9uIChhbGlhczogU3RyaW5nLCByb3dfbmFtZTogU3RyaW5nLCBwYXR0ZXJuOiBQYXR0ZXJuLCBkZWZhdWx0UGF0dGVybjogUGF0dGVybiwgcm93X2NvbF93cmFwcGVyOiBTdHJpbmcpOiBTdHJpbmcge1xyXG4gICAgbGV0IGNvbF9uYW1lID0gYWxpYXMuc3BsaXQoU3RyaW5nKHBhdHRlcm4uZGVsaW1pdGVyKSB8fCBcIi5cIikucmVkdWNlKChyLCBpdCwgaSkgPT4ge1xyXG4gICAgICAgIHJldHVybiByLnJlcGxhY2UobmV3IFJlZ0V4cChTdHJpbmcocm93X2NvbF93cmFwcGVyKSArIGkgKyBTdHJpbmcocm93X2NvbF93cmFwcGVyKSwgXCJnXCIpLCBpdCk7XHJcbiAgICB9LCBwYXR0ZXJuLmNvbF9uYW1lIHx8IGRlZmF1bHRQYXR0ZXJuLmNvbF9uYW1lKTtcclxuICAgIGlmIChhbGlhcy5zcGxpdChTdHJpbmcocGF0dGVybi5kZWxpbWl0ZXIpIHx8IFwiLlwiKS5sZW5ndGggPT09IDEgfHwgcm93X25hbWUgPT09IGFsaWFzKSB7XHJcbiAgICAgICAgY29sX25hbWUgPSBwYXR0ZXJuLmNvbF9uYW1lIHx8IFwiVmFsdWVcIjtcclxuICAgIH1cclxuICAgIHJldHVybiBjb2xfbmFtZTtcclxufTtcclxubGV0IGdldFRocmVzaG9sZHMgPSBmdW5jdGlvbiAocGF0dGVybjogUGF0dGVybiwgZGVmYXVsdFBhdHRlcm46IFBhdHRlcm4sIGN1cnJlbnRfc2VydmVydGltZXN0YW1wOiBEYXRlKTogTnVtYmVyW10ge1xyXG4gICAgbGV0IHRocmVzaG9sZHM6IE51bWJlcltdID0gKHBhdHRlcm4udGhyZXNob2xkcyB8fCBkZWZhdWx0UGF0dGVybi50aHJlc2hvbGRzKS5zcGxpdChcIixcIikubWFwKGQgPT4gK2QpO1xyXG4gICAgaWYgKHBhdHRlcm4uZW5hYmxlX3RpbWVfYmFzZWRfdGhyZXNob2xkcykge1xyXG4gICAgICAgIGxldCBtZXRyaWNyZWNpdmVkVGltZVN0YW1wID0gY3VycmVudF9zZXJ2ZXJ0aW1lc3RhbXAgfHwgbmV3IERhdGUoKTtcclxuICAgICAgICBsZXQgbWV0cmljcmVjaXZlZFRpbWVTdGFtcF9pbm51bWJlciA9IG1ldHJpY3JlY2l2ZWRUaW1lU3RhbXAuZ2V0SG91cnMoKSAqIDEwMCArIG1ldHJpY3JlY2l2ZWRUaW1lU3RhbXAuZ2V0TWludXRlcygpO1xyXG4gICAgICAgIGxldCB3ZWVrZGF5cyA9IFtcInN1blwiLCBcIm1vblwiLCBcInR1ZVwiLCBcIndlZFwiLCBcInRodVwiLCBcImZyaVwiLCBcInNhdFwiXTtcclxuICAgICAgICBfLmVhY2gocGF0dGVybi50aW1lX2Jhc2VkX3RocmVzaG9sZHMsICh0YnR4KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0YnR4ICYmIHRidHguZnJvbSAmJiB0YnR4LnRvICYmIHRidHguZW5hYmxlZERheXMgJiZcclxuICAgICAgICAgICAgICAgIChtZXRyaWNyZWNpdmVkVGltZVN0YW1wX2lubnVtYmVyID49ICsodGJ0eC5mcm9tKSkgJiZcclxuICAgICAgICAgICAgICAgIChtZXRyaWNyZWNpdmVkVGltZVN0YW1wX2lubnVtYmVyIDw9ICsodGJ0eC50bykpICYmXHJcbiAgICAgICAgICAgICAgICAodGJ0eC5lbmFibGVkRGF5cy50b0xvd2VyQ2FzZSgpLmluZGV4T2Yod2Vla2RheXNbbWV0cmljcmVjaXZlZFRpbWVTdGFtcC5nZXREYXkoKV0pID4gLTEpICYmXHJcbiAgICAgICAgICAgICAgICB0YnR4LnRocmVzaG9sZFxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIHRocmVzaG9sZHMgPSAodGJ0eC50aHJlc2hvbGQgKyBcIlwiKS5zcGxpdChcIixcIikubWFwKGQgPT4gK2QpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhyZXNob2xkcztcclxufTtcclxubGV0IGFzc2lnblZhbHVlID0gZnVuY3Rpb24gKHNlcmllczogU2VyaWVzLCBkZWZhdWx0UGF0dGVybjogUGF0dGVybik6IFNlcmllcyB7XHJcbiAgICBpZiAoIWlzTmFOKHNlcmllcy52YWx1ZSkpIHtcclxuICAgICAgICBsZXQgZGVjaW1hbEluZm86IGFueSA9IHV0aWxzLmdldERlY2ltYWxzRm9yVmFsdWUoc2VyaWVzLnZhbHVlLCArKHNlcmllcy5kZWNpbWFscykpO1xyXG4gICAgICAgIGxldCBmb3JtYXRGdW5jID0ga2JuLnZhbHVlRm9ybWF0c1tTdHJpbmcoc2VyaWVzLnBhdHRlcm4uZm9ybWF0KSB8fCBTdHJpbmcoZGVmYXVsdFBhdHRlcm4uZm9ybWF0KV07XHJcbiAgICAgICAgc2VyaWVzLnZhbHVlRm9ybWF0dGVkID0gZm9ybWF0RnVuYyhzZXJpZXMudmFsdWUsIGRlY2ltYWxJbmZvLmRlY2ltYWxzLCBkZWNpbWFsSW5mby5zY2FsZWREZWNpbWFscyk7XHJcbiAgICAgICAgc2VyaWVzLmRpc3BsYXlWYWx1ZSA9IHNlcmllcy52YWx1ZUZvcm1hdHRlZDtcclxuICAgIH1cclxuICAgIHJldHVybiBzZXJpZXM7XHJcbn07XHJcbmxldCBmaWx0ZXJWYWx1ZXMgPSBmdW5jdGlvbiAoc2VyaWVzOiBTZXJpZXMpOiBCb29sZWFuIHtcclxuICAgIGlmICghc2VyaWVzLnBhdHRlcm4uZmlsdGVyKSB7XHJcbiAgICAgICAgc2VyaWVzLnBhdHRlcm4uZmlsdGVyID0ge1xyXG4gICAgICAgICAgICB2YWx1ZV9iZWxvdzogXCJcIixcclxuICAgICAgICAgICAgdmFsdWVfYWJvdmU6IFwiXCJcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgaWYgKHNlcmllcy5wYXR0ZXJuICYmIHNlcmllcy5wYXR0ZXJuLmZpbHRlciAmJiAoc2VyaWVzLnBhdHRlcm4uZmlsdGVyLnZhbHVlX2JlbG93ICE9PSBcIlwiIHx8IHNlcmllcy5wYXR0ZXJuLmZpbHRlci52YWx1ZV9hYm92ZSAhPT0gXCJcIikpIHtcclxuICAgICAgICBpZiAoc2VyaWVzLnBhdHRlcm4uZmlsdGVyLnZhbHVlX2JlbG93ICE9PSBcIlwiICYmIHNlcmllcy52YWx1ZSA8ICsoc2VyaWVzLnBhdHRlcm4uZmlsdGVyLnZhbHVlX2JlbG93KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzZXJpZXMucGF0dGVybi5maWx0ZXIudmFsdWVfYWJvdmUgIT09IFwiXCIgJiYgc2VyaWVzLnZhbHVlID4gKyhzZXJpZXMucGF0dGVybi5maWx0ZXIudmFsdWVfYWJvdmUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG59O1xyXG5sZXQgZ2V0RGlzcGxheVZhbHVlT3ZlcnJpZGUgPSBmdW5jdGlvbiAodHJhbnNmb3JtX3ZhbHVlc19vdmVycmlkZXM6IFN0cmluZywgdmFsdWU6IE51bWJlciwgcm93X25hbWU6IFN0cmluZywgY29sX25hbWU6IFN0cmluZywgZGlzcGxheVZhbHVlOiBTdHJpbmcpOiBTdHJpbmcge1xyXG4gICAgbGV0IF90cmFuc2Zvcm1fdmFsdWVzX292ZXJyaWRlcyA9IHRyYW5zZm9ybV92YWx1ZXNfb3ZlcnJpZGVzLnNwbGl0KFwifFwiKS5maWx0ZXIoY29uID0+IGNvbi5pbmRleE9mKFwiLT5cIikgPiAtMSkubWFwKGNvbiA9PiBjb24uc3BsaXQoXCItPlwiKSkuZmlsdGVyKGNvbiA9PiArKGNvblswXSkgPT09IHZhbHVlKS5tYXAoY29uID0+IGNvblsxXSk7XHJcbiAgICBpZiAoX3RyYW5zZm9ybV92YWx1ZXNfb3ZlcnJpZGVzLmxlbmd0aCA+IDAgJiYgX3RyYW5zZm9ybV92YWx1ZXNfb3ZlcnJpZGVzWzBdICE9PSBcIlwiKSB7XHJcbiAgICAgICAgZGlzcGxheVZhbHVlID0gKFwiXCIgKyBfdHJhbnNmb3JtX3ZhbHVlc19vdmVycmlkZXNbMF0pLnRyaW0oKS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfdmFsdWVfXCIsIFwiZ1wiKSwgU3RyaW5nKGRpc3BsYXlWYWx1ZSkpLnJlcGxhY2UobmV3IFJlZ0V4cChcIl9yb3dfbmFtZV9cIiwgXCJnXCIpLCBTdHJpbmcocm93X25hbWUpKS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfY29sX25hbWVfXCIsIFwiZ1wiKSwgU3RyaW5nKGNvbF9uYW1lKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGlzcGxheVZhbHVlO1xyXG59O1xyXG5sZXQgZ2V0T3ZlcnJpZGVkQkdDb2xvciA9IGZ1bmN0aW9uIChiZ0NvbG9yc19vdmVycmlkZXM6IFN0cmluZywgdmFsdWU6IE51bWJlciwgZGVmYXVsdEJHQ29sb3I6IFN0cmluZyk6IFN0cmluZyB7XHJcbiAgICBsZXQgYmdDb2xvciA9IGRlZmF1bHRCR0NvbG9yO1xyXG4gICAgbGV0IF9iZ0NvbG9yc19vdmVycmlkZXMgPSBiZ0NvbG9yc19vdmVycmlkZXMuc3BsaXQoXCJ8XCIpLmZpbHRlcihjb24gPT4gY29uLmluZGV4T2YoXCItPlwiKSA+IC0xKS5tYXAoY29uID0+IGNvbi5zcGxpdChcIi0+XCIpKS5maWx0ZXIoY29uID0+ICsoY29uWzBdKSA9PT0gdmFsdWUpLm1hcChjb24gPT4gY29uWzFdKTtcclxuICAgIGlmIChfYmdDb2xvcnNfb3ZlcnJpZGVzLmxlbmd0aCA+IDAgJiYgX2JnQ29sb3JzX292ZXJyaWRlc1swXSAhPT0gXCJcIikge1xyXG4gICAgICAgIGJnQ29sb3IgPSB1dGlscy5ub3JtYWxpemVDb2xvcigoXCJcIiArIF9iZ0NvbG9yc19vdmVycmlkZXNbMF0pLnRyaW0oKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYmdDb2xvcjtcclxufTtcclxubGV0IGdldE92ZXJyaWRlZFRleHRDb2xvciA9IGZ1bmN0aW9uICh0ZXh0Q29sb3JzX292ZXJyaWRlczogU3RyaW5nLCB2YWx1ZTogTnVtYmVyLCBkZWZhdWx0dGV4dENvbG9yOiBTdHJpbmcpOiBTdHJpbmcge1xyXG4gICAgbGV0IHRleHRDb2xvciA9IGRlZmF1bHR0ZXh0Q29sb3I7XHJcbiAgICBsZXQgX3RleHRDb2xvcnNfb3ZlcnJpZGVzID0gdGV4dENvbG9yc19vdmVycmlkZXMuc3BsaXQoXCJ8XCIpLmZpbHRlcihjb24gPT4gY29uLmluZGV4T2YoXCItPlwiKSA+IC0xKS5tYXAoY29uID0+IGNvbi5zcGxpdChcIi0+XCIpKS5maWx0ZXIoY29uID0+ICsoY29uWzBdKSA9PT0gdmFsdWUpLm1hcChjb24gPT4gY29uWzFdKTtcclxuICAgIGlmIChfdGV4dENvbG9yc19vdmVycmlkZXMubGVuZ3RoID4gMCAmJiBfdGV4dENvbG9yc19vdmVycmlkZXNbMF0gIT09IFwiXCIpIHtcclxuICAgICAgICB0ZXh0Q29sb3IgPSB1dGlscy5ub3JtYWxpemVDb2xvcigoXCJcIiArIF90ZXh0Q29sb3JzX292ZXJyaWRlc1swXSkudHJpbSgpKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0ZXh0Q29sb3I7XHJcbn07XHJcbmxldCBhcHBseUZvbnRBd2Vzb21lSWNvbnMgPSBmdW5jdGlvbiAoc2VyaWVzOiBTZXJpZXMpOiBTZXJpZXMge1xyXG4gICAgc2VyaWVzLmFjdHVhbF9kaXNwbGF5dmFsdWUgPSBzZXJpZXMuZGlzcGxheVZhbHVlO1xyXG4gICAgc2VyaWVzLmFjdHVhbF9yb3dfbmFtZSA9IHNlcmllcy5yb3dfbmFtZTtcclxuICAgIHNlcmllcy5hY3R1YWxfY29sX25hbWUgPSBzZXJpZXMuY29sX25hbWU7XHJcbiAgICBpZiAoc2VyaWVzLmRpc3BsYXlWYWx1ZSAmJiBzZXJpZXMuZGlzcGxheVZhbHVlLmluZGV4T2YoXCJfZmEtXCIpID4gLTEpIHtcclxuICAgICAgICBzZXJpZXMuZGlzcGxheVZhbHVlID0gdXRpbHMucmVwbGFjZUZvbnRBd2Vzb21lSWNvbnMoc2VyaWVzLmRpc3BsYXlWYWx1ZSk7XHJcbiAgICB9XHJcbiAgICBpZiAoc2VyaWVzLnJvd19uYW1lICYmIHNlcmllcy5yb3dfbmFtZS5pbmRleE9mKFwiX2ZhLVwiKSA+IC0xKSB7XHJcbiAgICAgICAgc2VyaWVzLnJvd19uYW1lID0gdXRpbHMucmVwbGFjZUZvbnRBd2Vzb21lSWNvbnMoc2VyaWVzLnJvd19uYW1lKTtcclxuICAgIH1cclxuICAgIGlmIChzZXJpZXMuY29sX25hbWUgJiYgc2VyaWVzLmNvbF9uYW1lLmluZGV4T2YoXCJfZmEtXCIpID4gLTEpIHtcclxuICAgICAgICBzZXJpZXMuY29sX25hbWUgPSB1dGlscy5yZXBsYWNlRm9udEF3ZXNvbWVJY29ucyhzZXJpZXMuY29sX25hbWUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNlcmllcztcclxufTtcclxubGV0IGFwcGx5SW1hZ2VUcmFuc2Zvcm0gPSBmdW5jdGlvbiAoc2VyaWVzOiBTZXJpZXMpOiBTZXJpZXMge1xyXG4gICAgaWYgKHNlcmllcy5kaXNwbGF5VmFsdWUgJiYgc2VyaWVzLmRpc3BsYXlWYWx1ZS5pbmRleE9mKFwiX2ltZy1cIikgPiAtMSkge1xyXG4gICAgICAgIHNlcmllcy5kaXNwbGF5VmFsdWUgPSB1dGlscy5yZXBsYWNlV2l0aEltYWdlcyhzZXJpZXMuZGlzcGxheVZhbHVlKTtcclxuICAgIH1cclxuICAgIGlmIChzZXJpZXMucm93X25hbWUgJiYgc2VyaWVzLnJvd19uYW1lLmluZGV4T2YoXCJfaW1nLVwiKSA+IC0xKSB7XHJcbiAgICAgICAgc2VyaWVzLnJvd19uYW1lID0gdXRpbHMucmVwbGFjZVdpdGhJbWFnZXMoc2VyaWVzLnJvd19uYW1lKTtcclxuICAgIH1cclxuICAgIGlmIChzZXJpZXMuY29sX25hbWUgJiYgc2VyaWVzLmNvbF9uYW1lLmluZGV4T2YoXCJfaW1nLVwiKSA+IC0xKSB7XHJcbiAgICAgICAgc2VyaWVzLmNvbF9uYW1lID0gdXRpbHMucmVwbGFjZVdpdGhJbWFnZXMoc2VyaWVzLmNvbF9uYW1lKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzZXJpZXM7XHJcbn07XHJcbmxldCBjb21wdXRlID0gZnVuY3Rpb24gKGRhdGFDb21wdXRlZDogU2VyaWVzW10sIGRlZmF1bHRQYXR0ZXJuOiBQYXR0ZXJuLCBwYXR0ZXJuczogUGF0dGVybltdLCByb3dfY29sX3dyYXBwZXI6IFN0cmluZyk6IFNlcmllc1tdIHtcclxuICAgIGRhdGFDb21wdXRlZCA9IGRhdGFDb21wdXRlZC5tYXAoc2VyaWVzID0+IHtcclxuICAgICAgICBzZXJpZXMucGF0dGVybiA9IGZpbmRNYXRjaGluZ1BhdHRlcm4ocGF0dGVybnMsIGRlZmF1bHRQYXR0ZXJuLCBzZXJpZXMuYWxpYXMpO1xyXG4gICAgICAgIHNlcmllcy5kZWNpbWFscyA9IHNlcmllcy5wYXR0ZXJuLmRlY2ltYWxzIHx8IGRlZmF1bHRQYXR0ZXJuLmRlY2ltYWxzO1xyXG4gICAgICAgIHNlcmllcy52YWx1ZSA9IHNlcmllcy5zdGF0cyA/IHNlcmllcy5zdGF0c1tTdHJpbmcoc2VyaWVzLnBhdHRlcm4udmFsdWVOYW1lKSB8fCBTdHJpbmcoZGVmYXVsdFBhdHRlcm4udmFsdWVOYW1lKV0gOiBudWxsO1xyXG4gICAgICAgIHJldHVybiBzZXJpZXM7XHJcbiAgICB9KTtcclxuICAgIGRhdGFDb21wdXRlZCA9IGRhdGFDb21wdXRlZC5tYXAoc2VyaWVzID0+IGFzc2lnblZhbHVlKHNlcmllcywgZGVmYXVsdFBhdHRlcm4pKTtcclxuICAgIGRhdGFDb21wdXRlZCA9IGRhdGFDb21wdXRlZC5tYXAoc2VyaWVzID0+IHtcclxuICAgICAgICBsZXQgdGhyZXNob2xkcyA9IGdldFRocmVzaG9sZHMoc2VyaWVzLnBhdHRlcm4sIGRlZmF1bHRQYXR0ZXJuLCBfX19nZXRTZXJ2ZXJUaW1lc3RhbXAoc2VyaWVzKSk7XHJcbiAgICAgICAgc2VyaWVzLnJvd19uYW1lID0gZ2V0Um93TmFtZShzZXJpZXMuYWxpYXMsIHNlcmllcy5wYXR0ZXJuLCBkZWZhdWx0UGF0dGVybiwgcm93X2NvbF93cmFwcGVyKTtcclxuICAgICAgICBzZXJpZXMuY29sX25hbWUgPSBnZXRDb2xOYW1lKHNlcmllcy5hbGlhcywgc2VyaWVzLnJvd19uYW1lLCBzZXJpZXMucGF0dGVybiwgZGVmYXVsdFBhdHRlcm4sIHJvd19jb2xfd3JhcHBlcik7XHJcbiAgICAgICAgc2VyaWVzLmtleV9uYW1lID0gc2VyaWVzLnJvd19uYW1lICsgXCIjXCIgKyBzZXJpZXMuY29sX25hbWU7XHJcbiAgICAgICAgc2VyaWVzLnRvb2x0aXBUZW1wbGF0ZSA9IHNlcmllcy5wYXR0ZXJuLnRvb2x0aXBUZW1wbGF0ZSB8fCBkZWZhdWx0UGF0dGVybi50b29sdGlwVGVtcGxhdGUgfHwgXCJTZXJpZXMgOiBfc2VyaWVzXyB8IFZhbHVlIDogX3ZhbHVlX1wiO1xyXG4gICAgICAgIGlmICh0aHJlc2hvbGRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgaWYgKHNlcmllcy5wYXR0ZXJuLmVuYWJsZV9iZ0NvbG9yKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgYmdDb2xvcnMgPSAoc2VyaWVzLnBhdHRlcm4uYmdDb2xvcnMgfHwgZGVmYXVsdFBhdHRlcm4uYmdDb2xvcnMgfHwgXCJcIikuc3BsaXQoXCJ8XCIpO1xyXG4gICAgICAgICAgICAgICAgc2VyaWVzLmJnQ29sb3IgPSBfX19jb21wdXRlQ29sb3JGcm9tVGhyZXNob2xkcyh0aHJlc2hvbGRzLCBiZ0NvbG9ycywgc2VyaWVzLnZhbHVlLCBcInRyYW5zcGFyZW50XCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChzZXJpZXMucGF0dGVybi5lbmFibGVfVGV4dENvbG9ycykge1xyXG4gICAgICAgICAgICAgICAgbGV0IHRleHRDb2xvcnMgPSAoc2VyaWVzLnBhdHRlcm4udGV4dENvbG9ycyB8fCBkZWZhdWx0UGF0dGVybi50ZXh0Q29sb3JzIHx8IFwiXCIpLnNwbGl0KFwifFwiKTtcclxuICAgICAgICAgICAgICAgIHNlcmllcy50ZXh0Q29sb3IgPSBfX19jb21wdXRlQ29sb3JGcm9tVGhyZXNob2xkcyh0aHJlc2hvbGRzLCB0ZXh0Q29sb3JzLCBzZXJpZXMudmFsdWUsIFwid2hpdGVcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHNlcmllcy5wYXR0ZXJuLmVuYWJsZV90cmFuc2Zvcm0pIHtcclxuICAgICAgICAgICAgICAgIGxldCB0cmFuc2Zvcm1fdmFsdWVzID0gKHNlcmllcy5wYXR0ZXJuLnRyYW5zZm9ybV92YWx1ZXMgfHwgZGVmYXVsdFBhdHRlcm4udHJhbnNmb3JtX3ZhbHVlcykuc3BsaXQoXCJ8XCIpO1xyXG4gICAgICAgICAgICAgICAgc2VyaWVzLmRpc3BsYXlWYWx1ZSA9IF9fX2NvbXB1dGVEaXNwbGF5VmFsdWVGcm9tVGhyZXNob2xkcyh0aHJlc2hvbGRzLCB0cmFuc2Zvcm1fdmFsdWVzLCBzZXJpZXMudmFsdWUsIHNlcmllcy5kaXNwbGF5VmFsdWUsIHNlcmllcy5yb3dfbmFtZSwgc2VyaWVzLmNvbF9uYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2VyaWVzLnBhdHRlcm4uZW5hYmxlX2JnQ29sb3Jfb3ZlcnJpZGVzICYmIHNlcmllcy5wYXR0ZXJuLmJnQ29sb3JzX292ZXJyaWRlcykge1xyXG4gICAgICAgICAgICBzZXJpZXMuYmdDb2xvciA9IGdldE92ZXJyaWRlZEJHQ29sb3Ioc2VyaWVzLnBhdHRlcm4uYmdDb2xvcnNfb3ZlcnJpZGVzLCBzZXJpZXMudmFsdWUsIHNlcmllcy5iZ0NvbG9yIHx8IFwidHJhbnNwYXJlbnRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzZXJpZXMucGF0dGVybi5lbmFibGVfVGV4dENvbG9yX292ZXJyaWRlcyAmJiBzZXJpZXMucGF0dGVybi50ZXh0Q29sb3JzX292ZXJyaWRlcyApIHtcclxuICAgICAgICAgICAgc2VyaWVzLnRleHRDb2xvciA9IGdldE92ZXJyaWRlZFRleHRDb2xvcihzZXJpZXMucGF0dGVybi50ZXh0Q29sb3JzX292ZXJyaWRlcywgc2VyaWVzLnZhbHVlLCBzZXJpZXMudGV4dENvbG9yIHx8IFwid2hpdGVcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzZXJpZXMucGF0dGVybi5lbmFibGVfdHJhbnNmb3JtX292ZXJyaWRlcyAmJiBzZXJpZXMucGF0dGVybi50cmFuc2Zvcm1fdmFsdWVzX292ZXJyaWRlcykge1xyXG4gICAgICAgICAgICBzZXJpZXMuZGlzcGxheVZhbHVlID0gZ2V0RGlzcGxheVZhbHVlT3ZlcnJpZGUoc2VyaWVzLnBhdHRlcm4udHJhbnNmb3JtX3ZhbHVlc19vdmVycmlkZXMsIHNlcmllcy52YWx1ZSwgc2VyaWVzLnJvd19uYW1lLCBzZXJpZXMuY29sX25hbWUsIHNlcmllcy5kaXNwbGF5VmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoXy5pc05hTihzZXJpZXMudmFsdWUpIHx8IHNlcmllcy52YWx1ZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBzZXJpZXMuYmdDb2xvciA9IHNlcmllcy5wYXR0ZXJuLm51bGxfY29sb3IgfHwgZGVmYXVsdFBhdHRlcm4ubnVsbF9jb2xvciB8fCBcImRhcmtyZWRcIjtcclxuICAgICAgICAgICAgc2VyaWVzLnRleHRDb2xvciA9IHNlcmllcy5wYXR0ZXJuLm51bGxfdGV4dF9jb2xvciB8fCBkZWZhdWx0UGF0dGVybi5udWxsX3RleHRfY29sb3IgfHwgXCJ3aGl0ZVwiO1xyXG4gICAgICAgICAgICBzZXJpZXMuZGlzcGxheVZhbHVlID0gc2VyaWVzLnBhdHRlcm4ubnVsbF92YWx1ZSB8fCBkZWZhdWx0UGF0dGVybi5udWxsX3ZhbHVlIHx8IFwiTm8gZGF0YVwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2VyaWVzLnBhdHRlcm4uZW5hYmxlX2NsaWNrYWJsZV9jZWxscykge1xyXG4gICAgICAgICAgICBsZXQgdGFyZ2V0TGluayA9IHNlcmllcy5wYXR0ZXJuLmNsaWNrYWJsZV9jZWxsc19saW5rIHx8IFwiI1wiO1xyXG4gICAgICAgICAgICB0YXJnZXRMaW5rID0gdGFyZ2V0TGluay5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfcm93X25hbWVfXCIsIFwiZ1wiKSwgdXRpbHMuZ2V0QWN0dWFsTmFtZVdpdGhvdXRUcmFuc2Zvcm1TaWduKHNlcmllcy5hY3R1YWxfcm93X25hbWUpLnRyaW0oKSk7XHJcbiAgICAgICAgICAgIHRhcmdldExpbmsgPSB0YXJnZXRMaW5rLnJlcGxhY2UobmV3IFJlZ0V4cChcIl9jb2xfbmFtZV9cIiwgXCJnXCIpLCB1dGlscy5nZXRBY3R1YWxOYW1lV2l0aG91dFRyYW5zZm9ybVNpZ24oc2VyaWVzLmFjdHVhbF9jb2xfbmFtZSkudHJpbSgpKTtcclxuICAgICAgICAgICAgdGFyZ2V0TGluayA9IHRhcmdldExpbmsucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX1wiLCBcImdcIiksIHV0aWxzLmdldEFjdHVhbE5hbWVXaXRob3V0VHJhbnNmb3JtU2lnbihzZXJpZXMudmFsdWUpLnRyaW0oKSk7XHJcbiAgICAgICAgICAgIHNlcmllcy5kaXNwbGF5VmFsdWUgPSBgPGEgaHJlZj1cIiR7dGFyZ2V0TGlua31cIiB0YXJnZXQ9XCJfYmxhbmtcIj4ke3Nlcmllcy5kaXNwbGF5VmFsdWV9PC9hPmA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzZXJpZXM7XHJcbiAgICB9KTtcclxuICAgIGRhdGFDb21wdXRlZCA9IGRhdGFDb21wdXRlZC5tYXAoc2VyaWVzID0+IGFwcGx5Rm9udEF3ZXNvbWVJY29ucyhzZXJpZXMpKTtcclxuICAgIGRhdGFDb21wdXRlZCA9IGRhdGFDb21wdXRlZC5tYXAoc2VyaWVzID0+IGFwcGx5SW1hZ2VUcmFuc2Zvcm0oc2VyaWVzKSk7XHJcbiAgICBkYXRhQ29tcHV0ZWQgPSBkYXRhQ29tcHV0ZWQuZmlsdGVyKHNlcmllcyA9PiBmaWx0ZXJWYWx1ZXMoc2VyaWVzKSk7XHJcbiAgICByZXR1cm4gZGF0YUNvbXB1dGVkO1xyXG59O1xyXG5leHBvcnQge1xyXG4gICAgY29tcHV0ZSxcclxuICAgIGRlZmF1bHRIYW5kbGVyXHJcbn07XHJcbiJdfQ==