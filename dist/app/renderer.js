System.register(["lodash", "./utils"], function (exports_1, context_1) {
    "use strict";
    var lodash_1, utils_1, buildOutputData, output, output_debug, getTooltipMessage;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (lodash_1_1) {
                lodash_1 = lodash_1_1;
            },
            function (utils_1_1) {
                utils_1 = utils_1_1;
            }
        ],
        execute: function () {
            buildOutputData = function (dataComputed, rows_found, cols_found, defaultPattern, options) {
                var no_match_text = options && options.no_match_text ? options.no_match_text : "N/A";
                var output = [];
                lodash_1.default.each(lodash_1.default.uniq(rows_found), function (row_name) {
                    var o = {};
                    o.row = row_name;
                    o.cols = [];
                    lodash_1.default.each(lodash_1.default.uniq(cols_found), function (col_name) {
                        var matched_value = (lodash_1.default.find(dataComputed, function (e) {
                            return e.row_name === row_name && e.col_name === col_name;
                        }));
                        var mycol = {};
                        mycol.name = col_name;
                        mycol.value = matched_value ? matched_value.value || NaN : NaN;
                        mycol.displayValue = matched_value ? matched_value.displayValue || matched_value.value || "N/A" : no_match_text || "N/A";
                        mycol.bgColor = matched_value && matched_value.bgColor ? matched_value.bgColor : "transparent";
                        mycol.textColor = matched_value && matched_value.textColor ? matched_value.textColor : "white";
                        var tooltipTemplate = matched_value && matched_value.tooltipTemplate ? matched_value.tooltipTemplate : defaultPattern.tooltipTemplate || "No matching series found for _row_name_ & _col_name_";
                        if (matched_value) {
                            mycol.tooltip = getTooltipMessage(matched_value.alias || matched_value.aliasEscaped || matched_value.label || matched_value.id || "-", tooltipTemplate, utils_1.getActualNameWithoutTransformSign(matched_value.actual_row_name || row_name), utils_1.getActualNameWithoutTransformSign(matched_value.actual_col_name || col_name), matched_value.valueFormatted || no_match_text);
                        }
                        else {
                            mycol.tooltip = getTooltipMessage("-", tooltipTemplate, utils_1.getActualNameWithoutTransformSign(row_name), utils_1.getActualNameWithoutTransformSign(col_name), "NaN" || no_match_text);
                        }
                        mycol.tooltip = mycol.tooltip;
                        o.cols.push(mycol);
                    });
                    output.push(o);
                });
                return output;
            };
            exports_1("buildOutputData", buildOutputData);
            output = function (output, cols_found, options) {
                var hide_headers = options.hide_headers;
                var hide_first_column = options.hide_first_column;
                var text_align_table_header = options.text_align_table_header;
                var default_title_for_rows = options.default_title_for_rows;
                var text_align_first_column = options.text_align_first_column;
                var text_align_table_cells = options.text_align_table_cells;
                var show_footers = options.show_footers;
                var header_and_footer = "<tr>";
                if (hide_first_column !== true) {
                    header_and_footer += "<th style=\"padding:4px;text-align:" + text_align_table_header + "\">" + default_title_for_rows + "</th>";
                }
                lodash_1.default.each(lodash_1.default.uniq(cols_found), function (c) {
                    header_and_footer += "<th style=\"padding:4px;text-align:" + text_align_table_header + "\">" + c + "</th>";
                });
                header_and_footer += "</tr>";
                var header = "<br/>" + (hide_headers !== true ? header_and_footer : "");
                var footer = show_footers === true ? header_and_footer : "";
                var body = "";
                lodash_1.default.each(output, function (o) {
                    body += "<tr>";
                    if (hide_first_column !== true) {
                        body += "<td style=\"padding:4px;text-align:" + text_align_first_column + "\">" + o.row + "</td>";
                    }
                    lodash_1.default.each(o.cols, function (c) {
                        body += "<td\n            style=\"padding:4px;background-color:" + c.bgColor + ";text-align:" + text_align_table_cells + ";color:" + c.textColor + "\"\n          >\n            <div\n            data-toggle=\"tooltip\"\n            data-html=\"true\"\n            data-placement=\"auto\"\n            title=\"" + c.tooltip + "\"\n            style=\"padding-left:10px\">\n                " + c.displayValue + "\n            </div>\n          </td>";
                    });
                    body += "</tr>";
                });
                return { header: header, body: body, footer: footer };
            };
            exports_1("buildOutput", output);
            output_debug = function (dataComputed) {
                var debug_output = "\n        <table class=\"table-panel-table\">\n            <thead>\n                <tr>\n                    <th style=\"padding:4px;text-align:center\">Metric</th>\n                    <th style=\"padding:4px;text-align:center\">Pattern</th>\n                    <th style=\"padding:4px;text-align:center\">Value</th>\n                    <th style=\"padding:4px;text-align:center\">Row Name</th>\n                    <th style=\"padding:4px;text-align:center\">Col Name</th>\n                    <th style=\"padding:4px;text-align:center\">Thresholds</th>\n                </tr>\n            </thead>\n            <tbody id=\"boomtable_output_body_debug\">\n    ";
                lodash_1.default.each(dataComputed, function (d) {
                    debug_output += "\n          <tr>\n            <td style=\"padding:4px;\" width=\"40%\">" + d.alias + "</td>\n            <td style=\"padding:4px;\">" + (d.pattern.pattern || "Default") + "</td>\n            <td style=\"padding:4px;background-color:" + d.bgColor + "\">" + d.displayValue + "</td>\n            <td style=\"padding:4px;\">" + d.row_name + "</td>\n            <td style=\"padding:4px;\">" + d.col_name + "</td>\n            <td style=\"padding:4px;\">" + d.thresholds + "</td>\n          </tr>\n          ";
                });
                debug_output += "\n        </tbody>\n        </table>\n    ";
                return debug_output;
            };
            exports_1("buildDebugOutput", output_debug);
            getTooltipMessage = function (seriesIdentifier, template, row_name, col_name, value) {
                if (template === "_") {
                    return "";
                }
                var tooltip = template;
                tooltip = tooltip.replace(new RegExp("_series_", "g"), String(seriesIdentifier));
                tooltip = tooltip.replace(new RegExp("_row_name_", "g"), String(row_name));
                tooltip = tooltip.replace(new RegExp("_col_name_", "g"), String(col_name));
                tooltip = tooltip.replace(new RegExp("_value_", "g"), String(value));
                return tooltip;
            };
            exports_1("getTooltipMessage", getTooltipMessage);
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYXBwL3JlbmRlcmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O1lBSUksZUFBZSxHQUFHLFVBQVUsWUFBc0IsRUFBRSxVQUFvQixFQUFFLFVBQW9CLEVBQUUsY0FBdUIsRUFBRSxPQUFZO2dCQUNySSxJQUFJLGFBQWEsR0FBRyxPQUFPLElBQUksT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO2dCQUNyRixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7Z0JBQ2hCLGdCQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLFVBQUMsUUFBUTtvQkFDaEMsSUFBSSxDQUFDLEdBQVEsRUFBRSxDQUFDO29CQUNoQixDQUFDLENBQUMsR0FBRyxHQUFHLFFBQVEsQ0FBQztvQkFDakIsQ0FBQyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7b0JBQ1osZ0JBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsVUFBQyxRQUFRO3dCQUNoQyxJQUFJLGFBQWEsR0FBRyxDQUFDLGdCQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxVQUFDLENBQUM7NEJBQ3hDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsS0FBSyxRQUFRLElBQUksQ0FBQyxDQUFDLFFBQVEsS0FBSyxRQUFRLENBQUM7d0JBQzlELENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ0osSUFBSSxLQUFLLEdBQVEsRUFBRSxDQUFDO3dCQUNwQixLQUFLLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQzt3QkFDdEIsS0FBSyxDQUFDLEtBQUssR0FBRyxhQUFhLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxLQUFLLElBQUksR0FBRyxDQUFDLENBQUMs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ZnJvbSBcImxvZGFzaFwiO1xyXG5pbXBvcnQgeyBnZXRBY3R1YWxOYW1lV2l0aG91dFRyYW5zZm9ybVNpZ24gfSBmcm9tIFwiLi91dGlsc1wiO1xyXG5pbXBvcnQgeyBTZXJpZXMsIFBhdHRlcm4gfSBmcm9tIFwiLi8uLi9pbnRlcmZhY2VzL2ludGVyZmFjZXNcIjtcclxuXHJcbmxldCBidWlsZE91dHB1dERhdGEgPSBmdW5jdGlvbiAoZGF0YUNvbXB1dGVkOiBTZXJpZXNbXSwgcm93c19mb3VuZDogU3RyaW5nW10sIGNvbHNfZm91bmQ6IFN0cmluZ1tdLCBkZWZhdWx0UGF0dGVybjogUGF0dGVybiwgb3B0aW9uczogYW55KTogYW55W10ge1xyXG4gICAgbGV0IG5vX21hdGNoX3RleHQgPSBvcHRpb25zICYmIG9wdGlvbnMubm9fbWF0Y2hfdGV4dCA/IG9wdGlvbnMubm9fbWF0Y2hfdGV4dCA6IFwiTi9BXCI7XHJcbiAgICBsZXQgb3V0cHV0ID0gW107XHJcbiAgICBfLmVhY2goXy51bmlxKHJvd3NfZm91bmQpLCAocm93X25hbWUpID0+IHtcclxuICAgICAgICBsZXQgbzogYW55ID0ge307XHJcbiAgICAgICAgby5yb3cgPSByb3dfbmFtZTtcclxuICAgICAgICBvLmNvbHMgPSBbXTtcclxuICAgICAgICBfLmVhY2goXy51bmlxKGNvbHNfZm91bmQpLCAoY29sX25hbWUpID0+IHtcclxuICAgICAgICAgICAgbGV0IG1hdGNoZWRfdmFsdWUgPSAoXy5maW5kKGRhdGFDb21wdXRlZCwgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlLnJvd19uYW1lID09PSByb3dfbmFtZSAmJiBlLmNvbF9uYW1lID09PSBjb2xfbmFtZTtcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICBsZXQgbXljb2w6IGFueSA9IHt9O1xyXG4gICAgICAgICAgICBteWNvbC5uYW1lID0gY29sX25hbWU7XHJcbiAgICAgICAgICAgIG15Y29sLnZhbHVlID0gbWF0Y2hlZF92YWx1ZSA/IG1hdGNoZWRfdmFsdWUudmFsdWUgfHwgTmFOIDogTmFOO1xyXG4gICAgICAgICAgICBteWNvbC5kaXNwbGF5VmFsdWUgPSBtYXRjaGVkX3ZhbHVlID8gbWF0Y2hlZF92YWx1ZS5kaXNwbGF5VmFsdWUgfHwgbWF0Y2hlZF92YWx1ZS52YWx1ZSB8fCBcIk4vQVwiIDogbm9fbWF0Y2hfdGV4dCB8fCBcIk4vQVwiO1xyXG4gICAgICAgICAgICBteWNvbC5iZ0NvbG9yID0gbWF0Y2hlZF92YWx1ZSAmJiBtYXRjaGVkX3ZhbHVlLmJnQ29sb3IgPyBtYXRjaGVkX3ZhbHVlLmJnQ29sb3IgOiBcInRyYW5zcGFyZW50XCI7XHJcbiAgICAgICAgICAgIG15Y29sLnRleHRDb2xvciA9IG1hdGNoZWRfdmFsdWUgJiYgbWF0Y2hlZF92YWx1ZS50ZXh0Q29sb3IgPyBtYXRjaGVkX3ZhbHVlLnRleHRDb2xvciA6IFwid2hpdGVcIjtcclxuICAgICAgICAgICAgbGV0IHRvb2x0aXBUZW1wbGF0ZSA9IG1hdGNoZWRfdmFsdWUgJiYgbWF0Y2hlZF92YWx1ZS50b29sdGlwVGVtcGxhdGUgPyBtYXRjaGVkX3ZhbHVlLnRvb2x0aXBUZW1wbGF0ZSA6IGRlZmF1bHRQYXR0ZXJuLnRvb2x0aXBUZW1wbGF0ZSB8fCBcIk5vIG1hdGNoaW5nIHNlcmllcyBmb3VuZCBmb3IgX3Jvd19uYW1lXyAmIF9jb2xfbmFtZV9cIjtcclxuICAgICAgICAgICAgaWYgKG1hdGNoZWRfdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIG15Y29sLnRvb2x0aXAgPSBnZXRUb29sdGlwTWVzc2FnZShcclxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVkX3ZhbHVlLmFsaWFzIHx8IG1hdGNoZWRfdmFsdWUuYWxpYXNFc2NhcGVkIHx8IG1hdGNoZWRfdmFsdWUubGFiZWwgfHwgbWF0Y2hlZF92YWx1ZS5pZCB8fCBcIi1cIiAsXHJcbiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcFRlbXBsYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgIGdldEFjdHVhbE5hbWVXaXRob3V0VHJhbnNmb3JtU2lnbihtYXRjaGVkX3ZhbHVlLmFjdHVhbF9yb3dfbmFtZSB8fCByb3dfbmFtZSksXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0QWN0dWFsTmFtZVdpdGhvdXRUcmFuc2Zvcm1TaWduKG1hdGNoZWRfdmFsdWUuYWN0dWFsX2NvbF9uYW1lIHx8IGNvbF9uYW1lKSxcclxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVkX3ZhbHVlLnZhbHVlRm9ybWF0dGVkIHx8IG5vX21hdGNoX3RleHRcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBteWNvbC50b29sdGlwID0gZ2V0VG9vbHRpcE1lc3NhZ2UoXHJcbiAgICAgICAgICAgICAgICAgICAgXCItXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcFRlbXBsYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgIGdldEFjdHVhbE5hbWVXaXRob3V0VHJhbnNmb3JtU2lnbihyb3dfbmFtZSksXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0QWN0dWFsTmFtZVdpdGhvdXRUcmFuc2Zvcm1TaWduKGNvbF9uYW1lKSxcclxuICAgICAgICAgICAgICAgICAgICBcIk5hTlwiIHx8IG5vX21hdGNoX3RleHRcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbXljb2wudG9vbHRpcCA9IG15Y29sLnRvb2x0aXA7XHJcbiAgICAgICAgICAgIG8uY29scy5wdXNoKG15Y29sKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBvdXRwdXQucHVzaChvKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG91dHB1dDtcclxufTtcclxubGV0IG91dHB1dCA9IGZ1bmN0aW9uIChvdXRwdXQ6IGFueVtdLCBjb2xzX2ZvdW5kOiBhbnksIG9wdGlvbnM6IGFueSk6IHsgaGVhZGVyOiBTdHJpbmcsIGJvZHk6IFN0cmluZywgZm9vdGVyOiBTdHJpbmcgfSB7XHJcbiAgICBsZXQgaGlkZV9oZWFkZXJzID0gb3B0aW9ucy5oaWRlX2hlYWRlcnM7XHJcbiAgICBsZXQgaGlkZV9maXJzdF9jb2x1bW4gPSBvcHRpb25zLmhpZGVfZmlyc3RfY29sdW1uO1xyXG4gICAgbGV0IHRleHRfYWxpZ25fdGFibGVfaGVhZGVyID0gb3B0aW9ucy50ZXh0X2FsaWduX3RhYmxlX2hlYWRlcjtcclxuICAgIGxldCBkZWZhdWx0X3RpdGxlX2Zvcl9yb3dzID0gb3B0aW9ucy5kZWZhdWx0X3RpdGxlX2Zvcl9yb3dzO1xyXG4gICAgbGV0IHRleHRfYWxpZ25fZmlyc3RfY29sdW1uID0gb3B0aW9ucy50ZXh0X2FsaWduX2ZpcnN0X2NvbHVtbjtcclxuICAgIGxldCB0ZXh0X2FsaWduX3RhYmxlX2NlbGxzID0gb3B0aW9ucy50ZXh0X2FsaWduX3RhYmxlX2NlbGxzO1xyXG4gICAgbGV0IHNob3dfZm9vdGVycyA9IG9wdGlvbnMuc2hvd19mb290ZXJzO1xyXG4gICAgbGV0IGhlYWRlcl9hbmRfZm9vdGVyID0gXCI8dHI+XCI7XHJcbiAgICBpZiAoaGlkZV9maXJzdF9jb2x1bW4gIT09IHRydWUpIHtcclxuICAgICAgICBoZWFkZXJfYW5kX2Zvb3RlciArPSBgPHRoIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjoke3RleHRfYWxpZ25fdGFibGVfaGVhZGVyfVwiPiR7ZGVmYXVsdF90aXRsZV9mb3Jfcm93c308L3RoPmA7XHJcbiAgICB9IF8uZWFjaChfLnVuaXEoY29sc19mb3VuZCksIGMgPT4ge1xyXG4gICAgICAgIGhlYWRlcl9hbmRfZm9vdGVyICs9IGA8dGggc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOiR7dGV4dF9hbGlnbl90YWJsZV9oZWFkZXJ9XCI+JHtjfTwvdGg+YDtcclxuICAgIH0pO1xyXG4gICAgaGVhZGVyX2FuZF9mb290ZXIgKz0gXCI8L3RyPlwiO1xyXG4gICAgbGV0IGhlYWRlciA9IGA8YnIvPmAgKyAoaGlkZV9oZWFkZXJzICE9PSB0cnVlID8gaGVhZGVyX2FuZF9mb290ZXIgOiBcIlwiKTtcclxuICAgIGxldCBmb290ZXIgPSBzaG93X2Zvb3RlcnMgPT09IHRydWUgPyBoZWFkZXJfYW5kX2Zvb3RlciA6IFwiXCI7XHJcbiAgICBsZXQgYm9keSA9IGBgO1xyXG4gICAgXy5lYWNoKG91dHB1dCwgbyA9PiB7XHJcbiAgICAgICAgYm9keSArPSBcIjx0cj5cIjtcclxuICAgICAgICBpZiAoaGlkZV9maXJzdF9jb2x1bW4gIT09IHRydWUpIHtcclxuICAgICAgICAgICAgYm9keSArPSBgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjoke3RleHRfYWxpZ25fZmlyc3RfY29sdW1ufVwiPiR7by5yb3d9PC90ZD5gO1xyXG4gICAgICAgIH1cclxuICAgICAgICBfLmVhY2goby5jb2xzLCBjID0+IHtcclxuICAgICAgICAgICAgYm9keSArPSBgPHRkXHJcbiAgICAgICAgICAgIHN0eWxlPVwicGFkZGluZzo0cHg7YmFja2dyb3VuZC1jb2xvcjoke2MuYmdDb2xvcn07dGV4dC1hbGlnbjoke3RleHRfYWxpZ25fdGFibGVfY2VsbHN9O2NvbG9yOiR7Yy50ZXh0Q29sb3J9XCJcclxuICAgICAgICAgID5cclxuICAgICAgICAgICAgPGRpdlxyXG4gICAgICAgICAgICBkYXRhLXRvZ2dsZT1cInRvb2x0aXBcIlxyXG4gICAgICAgICAgICBkYXRhLWh0bWw9XCJ0cnVlXCJcclxuICAgICAgICAgICAgZGF0YS1wbGFjZW1lbnQ9XCJhdXRvXCJcclxuICAgICAgICAgICAgdGl0bGU9XCIke2MudG9vbHRpcH1cIlxyXG4gICAgICAgICAgICBzdHlsZT1cInBhZGRpbmctbGVmdDoxMHB4XCI+XHJcbiAgICAgICAgICAgICAgICAke2MuZGlzcGxheVZhbHVlfVxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgIDwvdGQ+YDtcclxuICAgICAgICB9KTtcclxuICAgICAgICBib2R5ICs9IFwiPC90cj5cIjtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHsgaGVhZGVyLCBib2R5LCBmb290ZXIgfTtcclxufTtcclxubGV0IG91dHB1dF9kZWJ1ZyA9IGZ1bmN0aW9uIChkYXRhQ29tcHV0ZWQ6IFNlcmllc1tdKTogU3RyaW5nIHtcclxuICAgIGxldCBkZWJ1Z19vdXRwdXQgPSBgXHJcbiAgICAgICAgPHRhYmxlIGNsYXNzPVwidGFibGUtcGFuZWwtdGFibGVcIj5cclxuICAgICAgICAgICAgPHRoZWFkPlxyXG4gICAgICAgICAgICAgICAgPHRyPlxyXG4gICAgICAgICAgICAgICAgICAgIDx0aCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246Y2VudGVyXCI+TWV0cmljPC90aD5cclxuICAgICAgICAgICAgICAgICAgICA8dGggc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOmNlbnRlclwiPlBhdHRlcm48L3RoPlxyXG4gICAgICAgICAgICAgICAgICAgIDx0aCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246Y2VudGVyXCI+VmFsdWU8L3RoPlxyXG4gICAgICAgICAgICAgICAgICAgIDx0aCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246Y2VudGVyXCI+Um93IE5hbWU8L3RoPlxyXG4gICAgICAgICAgICAgICAgICAgIDx0aCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246Y2VudGVyXCI+Q29sIE5hbWU8L3RoPlxyXG4gICAgICAgICAgICAgICAgICAgIDx0aCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246Y2VudGVyXCI+VGhyZXNob2xkczwvdGg+XHJcbiAgICAgICAgICAgICAgICA8L3RyPlxyXG4gICAgICAgICAgICA8L3RoZWFkPlxyXG4gICAgICAgICAgICA8dGJvZHkgaWQ9XCJib29tdGFibGVfb3V0cHV0X2JvZHlfZGVidWdcIj5cclxuICAgIGA7XHJcbiAgICBfLmVhY2goZGF0YUNvbXB1dGVkLCBkID0+IHtcclxuICAgICAgICBkZWJ1Z19vdXRwdXQgKz0gYFxyXG4gICAgICAgICAgPHRyPlxyXG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDtcIiB3aWR0aD1cIjQwJVwiPiR7ZC5hbGlhc308L3RkPlxyXG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDtcIj4ke2QucGF0dGVybi5wYXR0ZXJuIHx8IFwiRGVmYXVsdFwifTwvdGQ+XHJcbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O2JhY2tncm91bmQtY29sb3I6JHtkLmJnQ29sb3J9XCI+JHtkLmRpc3BsYXlWYWx1ZX08L3RkPlxyXG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDtcIj4ke2Qucm93X25hbWV9PC90ZD5cclxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7XCI+JHtkLmNvbF9uYW1lfTwvdGQ+XHJcbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O1wiPiR7ZC50aHJlc2hvbGRzfTwvdGQ+XHJcbiAgICAgICAgICA8L3RyPlxyXG4gICAgICAgICAgYDtcclxuICAgIH0pO1xyXG4gICAgZGVidWdfb3V0cHV0ICs9IGBcclxuICAgICAgICA8L3Rib2R5PlxyXG4gICAgICAgIDwvdGFibGU+XHJcbiAgICBgO1xyXG4gICAgcmV0dXJuIGRlYnVnX291dHB1dDtcclxufTtcclxubGV0IGdldFRvb2x0aXBNZXNzYWdlID0gZnVuY3Rpb24gKHNlcmllc0lkZW50aWZpZXI6IFN0cmluZywgdGVtcGxhdGU6IFN0cmluZywgcm93X25hbWU6IFN0cmluZywgY29sX25hbWU6IFN0cmluZywgdmFsdWU6IE51bWJlcik6IFN0cmluZyB7XHJcbiAgICBpZiAodGVtcGxhdGUgPT09IFwiX1wiKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICB9XHJcbiAgICBsZXQgdG9vbHRpcCA9IHRlbXBsYXRlO1xyXG4gICAgdG9vbHRpcCA9IHRvb2x0aXAucmVwbGFjZShuZXcgUmVnRXhwKFwiX3Nlcmllc19cIiwgXCJnXCIpLCBTdHJpbmcoc2VyaWVzSWRlbnRpZmllcikpO1xyXG4gICAgdG9vbHRpcCA9IHRvb2x0aXAucmVwbGFjZShuZXcgUmVnRXhwKFwiX3Jvd19uYW1lX1wiLCBcImdcIiksIFN0cmluZyhyb3dfbmFtZSkpO1xyXG4gICAgdG9vbHRpcCA9IHRvb2x0aXAucmVwbGFjZShuZXcgUmVnRXhwKFwiX2NvbF9uYW1lX1wiLCBcImdcIiksIFN0cmluZyhjb2xfbmFtZSkpO1xyXG4gICAgdG9vbHRpcCA9IHRvb2x0aXAucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX1wiLCBcImdcIiksIFN0cmluZyh2YWx1ZSkpO1xyXG4gICAgcmV0dXJuIHRvb2x0aXA7XHJcbn07XHJcbmV4cG9ydCB7XHJcbiAgICBnZXRUb29sdGlwTWVzc2FnZSxcclxuICAgIGJ1aWxkT3V0cHV0RGF0YSxcclxuICAgIG91dHB1dCBhcyBidWlsZE91dHB1dCxcclxuICAgIG91dHB1dF9kZWJ1ZyBhcyBidWlsZERlYnVnT3V0cHV0XHJcbn07XHJcbiJdfQ==