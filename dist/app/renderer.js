System.register(["lodash", "./utils"], function (exports_1, context_1) {
    "use strict";
    var lodash_1, utils_1, buildOutputData, output, output_debug, getTooltipMessage;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (lodash_1_1) {
                lodash_1 = lodash_1_1;
            },
            function (utils_1_1) {
                utils_1 = utils_1_1;
            }
        ],
        execute: function () {
            buildOutputData = function (dataComputed, rows_found, cols_found, defaultPattern, options) {
                var no_match_text = options && options.no_match_text ? options.no_match_text : "N/A";
                var output = [];
                lodash_1.default.each(lodash_1.default.uniq(rows_found), function (row_name) {
                    var o = {};
                    o.row = row_name;
                    o.cols = [];
                    lodash_1.default.each(lodash_1.default.uniq(cols_found), function (col_name) {
                        var matched_value = (lodash_1.default.find(dataComputed, function (e) {
                            return e.row_name === row_name && e.col_name === col_name;
                        }));
                        var mycol = {};
                        mycol.name = col_name;
                        mycol.value = matched_value ? matched_value.value || NaN : NaN;
                        mycol.displayValue = matched_value ? matched_value.displayValue || matched_value.value || "N/A" : no_match_text || "N/A";
                        mycol.bgColor = matched_value && matched_value.bgColor ? matched_value.bgColor : "transparent";
                        mycol.textColor = matched_value && matched_value.textColor ? matched_value.textColor : "white";
                        var tooltipTemplate = matched_value && matched_value.tooltipTemplate ? matched_value.tooltipTemplate : defaultPattern.tooltipTemplate || "No matching series found for _row_name_ & _col_name_";
                        if (matched_value) {
                            mycol.tooltip = getTooltipMessage(tooltipTemplate, utils_1.getActualNameWithoutTransformSign(matched_value.actual_row_name || row_name), utils_1.getActualNameWithoutTransformSign(matched_value.actual_col_name || col_name), matched_value.valueFormatted || no_match_text);
                        }
                        else {
                            mycol.tooltip = getTooltipMessage(tooltipTemplate, utils_1.getActualNameWithoutTransformSign(row_name), utils_1.getActualNameWithoutTransformSign(col_name), "NaN" || no_match_text);
                        }
                        mycol.tooltip = mycol.tooltip;
                        o.cols.push(mycol);
                    });
                    output.push(o);
                });
                return output;
            };
            exports_1("buildOutputData", buildOutputData);
            output = function (output, cols_found, options) {
                var hide_headers = options.hide_headers;
                var hide_first_column = options.hide_first_column;
                var text_align_table_header = options.text_align_table_header;
                var default_title_for_rows = options.default_title_for_rows;
                var text_align_first_column = options.text_align_first_column;
                var text_align_table_cells = options.text_align_table_cells;
                var show_footers = options.show_footers;
                var header_and_footer = "<tr>";
                if (hide_first_column !== true) {
                    header_and_footer += "<th style=\"padding:4px;text-align:" + text_align_table_header + "\">" + default_title_for_rows + "</th>";
                }
                lodash_1.default.each(lodash_1.default.uniq(cols_found), function (c) {
                    header_and_footer += "<th style=\"padding:4px;text-align:" + text_align_table_header + "\">" + c + "</th>";
                });
                header_and_footer += "</tr>";
                var header = "<br/>" + (hide_headers !== true ? header_and_footer : "");
                var footer = show_footers === true ? header_and_footer : "";
                var body = "";
                lodash_1.default.each(output, function (o) {
                    body += "<tr>";
                    if (hide_first_column !== true) {
                        body += "<td style=\"padding:4px;text-align:" + text_align_first_column + "\">" + o.row + "</td>";
                    }
                    lodash_1.default.each(o.cols, function (c) {
                        body += "<td\n            style=\"padding:4px;background-color:" + c.bgColor + ";text-align:" + text_align_table_cells + ";color:" + c.textColor + "\"\n          >\n            <div\n            data-toggle=\"tooltip\"\n            data-html=\"true\"\n            data-placement=\"left\"\n            title=\"" + c.tooltip + "\"\n            style=\"padding-left:10px\">\n                " + c.displayValue + "\n            </div>\n          </td>";
                    });
                    body += "</tr>";
                });
                return { header: header, body: body, footer: footer };
            };
            exports_1("buildOutput", output);
            output_debug = function (dataComputed) {
                var debug_output = "\n        <table class=\"table-panel-table\">\n            <thead>\n                <tr>\n                    <th style=\"padding:4px;text-align:center\">Metric</th>\n                    <th style=\"padding:4px;text-align:center\">Pattern</th>\n                    <th style=\"padding:4px;text-align:center\">Value</th>\n                    <th style=\"padding:4px;text-align:center\">Row Name</th>\n                    <th style=\"padding:4px;text-align:center\">Col Name</th>\n                    <th style=\"padding:4px;text-align:center\">Thresholds</th>\n                </tr>\n            </thead>\n            <tbody id=\"boomtable_output_body_debug\">\n    ";
                lodash_1.default.each(dataComputed, function (d) {
                    debug_output += "\n          <tr>\n            <td style=\"padding:4px;\" width=\"40%\">" + d.alias + "</td>\n            <td style=\"padding:4px;\">" + (d.pattern.pattern || "Default") + "</td>\n            <td style=\"padding:4px;background-color:" + d.bgColor + "\">" + d.displayValue + "</td>\n            <td style=\"padding:4px;\">" + d.row_name + "</td>\n            <td style=\"padding:4px;\">" + d.col_name + "</td>\n            <td style=\"padding:4px;\">" + d.thresholds + "</td>\n          </tr>\n          ";
                });
                debug_output += "\n        </tbody>\n        </table>\n    ";
                return debug_output;
            };
            exports_1("buildDebugOutput", output_debug);
            getTooltipMessage = function (template, row_name, col_name, value) {
                if (template === "_") {
                    return "";
                }
                var tooltip = template;
                tooltip = tooltip.replace(new RegExp("_row_name_", "g"), String(row_name));
                tooltip = tooltip.replace(new RegExp("_col_name_", "g"), String(col_name));
                tooltip = tooltip.replace(new RegExp("_value_", "g"), String(value));
                return tooltip;
            };
            exports_1("getTooltipMessage", getTooltipMessage);
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYXBwL3JlbmRlcmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O1lBSUksZUFBZSxHQUFHLFVBQVUsWUFBc0IsRUFBRSxVQUFvQixFQUFFLFVBQW9CLEVBQUUsY0FBdUIsRUFBRSxPQUFZO2dCQUNySSxJQUFJLGFBQWEsR0FBRyxPQUFPLElBQUksT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO2dCQUNyRixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7Z0JBQ2hCLGdCQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLFVBQUMsUUFBUTtvQkFDaEMsSUFBSSxDQUFDLEdBQVEsRUFBRSxDQUFDO29CQUNoQixDQUFDLENBQUMsR0FBRyxHQUFHLFFBQVEsQ0FBQztvQkFDakIsQ0FBQyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7b0JBQ1osZ0JBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsVUFBQyxRQUFRO3dCQUNoQyxJQUFJLGFBQWEsR0FBRyxDQUFDLGdCQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxVQUFDLENBQUM7NEJBQ3hDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsS0FBSyxRQUFRLElBQUksQ0FBQyxDQUFDLFFBQVEsS0FBSyxRQUFRLENBQUM7d0JBQzlELENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ0osSUFBSSxLQUFLLEdBQVEsRUFBRSxDQUFDO3dCQUNwQixLQUFLLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQzt3QkFDdEIsS0FBSyxDQUFDLEtBQUssR0FBRyxhQUFhLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxLQUFLLElBQUksR0FBRyxDQUFDLENBQUMs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REFDVixDQUFDLENBQUMsUUFBUSxzREFDVixDQUFDLENBQUMsVUFBVSx1Q0FFeEMsQ0FBQztnQkFDUixDQUFDLENBQUMsQ0FBQztnQkFDSCxZQUFZLElBQUksNENBR2YsQ0FBQztnQkFDRixPQUFPLFlBQVksQ0FBQztZQUN4QixDQUFDLENBQUM7O1lBQ0UsaUJBQWlCLEdBQUcsVUFBVSxRQUFnQixFQUFFLFFBQWdCLEVBQUUsUUFBZ0IsRUFBRSxLQUFhO2dCQUNqRyxJQUFJLFFBQVEsS0FBSyxHQUFHLEVBQUU7b0JBQ2xCLE9BQU8sRUFBRSxDQUFDO2lCQUNiO2dCQUNELElBQUksT0FBTyxHQUFHLFFBQVEsQ0FBQztnQkFDdkIsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxNQUFNLENBQUMsWUFBWSxFQUFFLEdBQUcsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUMzRSxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxZQUFZLEVBQUUsR0FBRyxDQUFDLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQzNFLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLFNBQVMsRUFBRSxHQUFHLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDckUsT0FBTyxPQUFPLENBQUM7WUFDbkIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSBcImxvZGFzaFwiO1xyXG5pbXBvcnQgeyBnZXRBY3R1YWxOYW1lV2l0aG91dFRyYW5zZm9ybVNpZ24gfSBmcm9tIFwiLi91dGlsc1wiO1xyXG5pbXBvcnQgeyBTZXJpZXMsIFBhdHRlcm4gfSBmcm9tIFwiLi8uLi9pbnRlcmZhY2VzL2ludGVyZmFjZXNcIjtcclxuXHJcbmxldCBidWlsZE91dHB1dERhdGEgPSBmdW5jdGlvbiAoZGF0YUNvbXB1dGVkOiBTZXJpZXNbXSwgcm93c19mb3VuZDogU3RyaW5nW10sIGNvbHNfZm91bmQ6IFN0cmluZ1tdLCBkZWZhdWx0UGF0dGVybjogUGF0dGVybiwgb3B0aW9uczogYW55KTogYW55W10ge1xyXG4gICAgbGV0IG5vX21hdGNoX3RleHQgPSBvcHRpb25zICYmIG9wdGlvbnMubm9fbWF0Y2hfdGV4dCA/IG9wdGlvbnMubm9fbWF0Y2hfdGV4dCA6IFwiTi9BXCI7XHJcbiAgICBsZXQgb3V0cHV0ID0gW107XHJcbiAgICBfLmVhY2goXy51bmlxKHJvd3NfZm91bmQpLCAocm93X25hbWUpID0+IHtcclxuICAgICAgICBsZXQgbzogYW55ID0ge307XHJcbiAgICAgICAgby5yb3cgPSByb3dfbmFtZTtcclxuICAgICAgICBvLmNvbHMgPSBbXTtcclxuICAgICAgICBfLmVhY2goXy51bmlxKGNvbHNfZm91bmQpLCAoY29sX25hbWUpID0+IHtcclxuICAgICAgICAgICAgbGV0IG1hdGNoZWRfdmFsdWUgPSAoXy5maW5kKGRhdGFDb21wdXRlZCwgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlLnJvd19uYW1lID09PSByb3dfbmFtZSAmJiBlLmNvbF9uYW1lID09PSBjb2xfbmFtZTtcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICBsZXQgbXljb2w6IGFueSA9IHt9O1xyXG4gICAgICAgICAgICBteWNvbC5uYW1lID0gY29sX25hbWU7XHJcbiAgICAgICAgICAgIG15Y29sLnZhbHVlID0gbWF0Y2hlZF92YWx1ZSA/IG1hdGNoZWRfdmFsdWUudmFsdWUgfHwgTmFOIDogTmFOO1xyXG4gICAgICAgICAgICBteWNvbC5kaXNwbGF5VmFsdWUgPSBtYXRjaGVkX3ZhbHVlID8gbWF0Y2hlZF92YWx1ZS5kaXNwbGF5VmFsdWUgfHwgbWF0Y2hlZF92YWx1ZS52YWx1ZSB8fCBcIk4vQVwiIDogbm9fbWF0Y2hfdGV4dCB8fCBcIk4vQVwiO1xyXG4gICAgICAgICAgICBteWNvbC5iZ0NvbG9yID0gbWF0Y2hlZF92YWx1ZSAmJiBtYXRjaGVkX3ZhbHVlLmJnQ29sb3IgPyBtYXRjaGVkX3ZhbHVlLmJnQ29sb3IgOiBcInRyYW5zcGFyZW50XCI7XHJcbiAgICAgICAgICAgIG15Y29sLnRleHRDb2xvciA9IG1hdGNoZWRfdmFsdWUgJiYgbWF0Y2hlZF92YWx1ZS50ZXh0Q29sb3IgPyBtYXRjaGVkX3ZhbHVlLnRleHRDb2xvciA6IFwid2hpdGVcIjtcclxuICAgICAgICAgICAgbGV0IHRvb2x0aXBUZW1wbGF0ZSA9IG1hdGNoZWRfdmFsdWUgJiYgbWF0Y2hlZF92YWx1ZS50b29sdGlwVGVtcGxhdGUgPyBtYXRjaGVkX3ZhbHVlLnRvb2x0aXBUZW1wbGF0ZSA6IGRlZmF1bHRQYXR0ZXJuLnRvb2x0aXBUZW1wbGF0ZSB8fCBcIk5vIG1hdGNoaW5nIHNlcmllcyBmb3VuZCBmb3IgX3Jvd19uYW1lXyAmIF9jb2xfbmFtZV9cIjtcclxuICAgICAgICAgICAgaWYgKG1hdGNoZWRfdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIG15Y29sLnRvb2x0aXAgPSBnZXRUb29sdGlwTWVzc2FnZShcclxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwVGVtcGxhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0QWN0dWFsTmFtZVdpdGhvdXRUcmFuc2Zvcm1TaWduKG1hdGNoZWRfdmFsdWUuYWN0dWFsX3Jvd19uYW1lIHx8IHJvd19uYW1lKSxcclxuICAgICAgICAgICAgICAgICAgICBnZXRBY3R1YWxOYW1lV2l0aG91dFRyYW5zZm9ybVNpZ24obWF0Y2hlZF92YWx1ZS5hY3R1YWxfY29sX25hbWUgfHwgY29sX25hbWUpLFxyXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZWRfdmFsdWUudmFsdWVGb3JtYXR0ZWQgfHwgbm9fbWF0Y2hfdGV4dFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG15Y29sLnRvb2x0aXAgPSBnZXRUb29sdGlwTWVzc2FnZShcclxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwVGVtcGxhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0QWN0dWFsTmFtZVdpdGhvdXRUcmFuc2Zvcm1TaWduKHJvd19uYW1lKSxcclxuICAgICAgICAgICAgICAgICAgICBnZXRBY3R1YWxOYW1lV2l0aG91dFRyYW5zZm9ybVNpZ24oY29sX25hbWUpLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiTmFOXCIgfHwgbm9fbWF0Y2hfdGV4dFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBteWNvbC50b29sdGlwID0gbXljb2wudG9vbHRpcDtcclxuICAgICAgICAgICAgby5jb2xzLnB1c2gobXljb2wpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIG91dHB1dC5wdXNoKG8pO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gb3V0cHV0O1xyXG59O1xyXG5sZXQgb3V0cHV0ID0gZnVuY3Rpb24gKG91dHB1dDogYW55W10sIGNvbHNfZm91bmQ6IGFueSwgb3B0aW9uczogYW55KTogeyBoZWFkZXI6IFN0cmluZywgYm9keTogU3RyaW5nLCBmb290ZXI6IFN0cmluZyB9IHtcclxuICAgIGxldCBoaWRlX2hlYWRlcnMgPSBvcHRpb25zLmhpZGVfaGVhZGVycztcclxuICAgIGxldCBoaWRlX2ZpcnN0X2NvbHVtbiA9IG9wdGlvbnMuaGlkZV9maXJzdF9jb2x1bW47XHJcbiAgICBsZXQgdGV4dF9hbGlnbl90YWJsZV9oZWFkZXIgPSBvcHRpb25zLnRleHRfYWxpZ25fdGFibGVfaGVhZGVyO1xyXG4gICAgbGV0IGRlZmF1bHRfdGl0bGVfZm9yX3Jvd3MgPSBvcHRpb25zLmRlZmF1bHRfdGl0bGVfZm9yX3Jvd3M7XHJcbiAgICBsZXQgdGV4dF9hbGlnbl9maXJzdF9jb2x1bW4gPSBvcHRpb25zLnRleHRfYWxpZ25fZmlyc3RfY29sdW1uO1xyXG4gICAgbGV0IHRleHRfYWxpZ25fdGFibGVfY2VsbHMgPSBvcHRpb25zLnRleHRfYWxpZ25fdGFibGVfY2VsbHM7XHJcbiAgICBsZXQgc2hvd19mb290ZXJzID0gb3B0aW9ucy5zaG93X2Zvb3RlcnM7XHJcbiAgICBsZXQgaGVhZGVyX2FuZF9mb290ZXIgPSBcIjx0cj5cIjtcclxuICAgIGlmIChoaWRlX2ZpcnN0X2NvbHVtbiAhPT0gdHJ1ZSkge1xyXG4gICAgICAgIGhlYWRlcl9hbmRfZm9vdGVyICs9IGA8dGggc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOiR7dGV4dF9hbGlnbl90YWJsZV9oZWFkZXJ9XCI+JHtkZWZhdWx0X3RpdGxlX2Zvcl9yb3dzfTwvdGg+YDtcclxuICAgIH0gXy5lYWNoKF8udW5pcShjb2xzX2ZvdW5kKSwgYyA9PiB7XHJcbiAgICAgICAgaGVhZGVyX2FuZF9mb290ZXIgKz0gYDx0aCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246JHt0ZXh0X2FsaWduX3RhYmxlX2hlYWRlcn1cIj4ke2N9PC90aD5gO1xyXG4gICAgfSk7XHJcbiAgICBoZWFkZXJfYW5kX2Zvb3RlciArPSBcIjwvdHI+XCI7XHJcbiAgICBsZXQgaGVhZGVyID0gYDxici8+YCArIChoaWRlX2hlYWRlcnMgIT09IHRydWUgPyBoZWFkZXJfYW5kX2Zvb3RlciA6IFwiXCIpO1xyXG4gICAgbGV0IGZvb3RlciA9IHNob3dfZm9vdGVycyA9PT0gdHJ1ZSA/IGhlYWRlcl9hbmRfZm9vdGVyIDogXCJcIjtcclxuICAgIGxldCBib2R5ID0gYGA7XHJcbiAgICBfLmVhY2gob3V0cHV0LCBvID0+IHtcclxuICAgICAgICBib2R5ICs9IFwiPHRyPlwiO1xyXG4gICAgICAgIGlmIChoaWRlX2ZpcnN0X2NvbHVtbiAhPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBib2R5ICs9IGA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOiR7dGV4dF9hbGlnbl9maXJzdF9jb2x1bW59XCI+JHtvLnJvd308L3RkPmA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIF8uZWFjaChvLmNvbHMsIGMgPT4ge1xyXG4gICAgICAgICAgICBib2R5ICs9IGA8dGRcclxuICAgICAgICAgICAgc3R5bGU9XCJwYWRkaW5nOjRweDtiYWNrZ3JvdW5kLWNvbG9yOiR7Yy5iZ0NvbG9yfTt0ZXh0LWFsaWduOiR7dGV4dF9hbGlnbl90YWJsZV9jZWxsc307Y29sb3I6JHtjLnRleHRDb2xvcn1cIlxyXG4gICAgICAgICAgPlxyXG4gICAgICAgICAgICA8ZGl2XHJcbiAgICAgICAgICAgIGRhdGEtdG9nZ2xlPVwidG9vbHRpcFwiXHJcbiAgICAgICAgICAgIGRhdGEtaHRtbD1cInRydWVcIlxyXG4gICAgICAgICAgICBkYXRhLXBsYWNlbWVudD1cImxlZnRcIlxyXG4gICAgICAgICAgICB0aXRsZT1cIiR7Yy50b29sdGlwfVwiXHJcbiAgICAgICAgICAgIHN0eWxlPVwicGFkZGluZy1sZWZ0OjEwcHhcIj5cclxuICAgICAgICAgICAgICAgICR7Yy5kaXNwbGF5VmFsdWV9XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgPC90ZD5gO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGJvZHkgKz0gXCI8L3RyPlwiO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4geyBoZWFkZXIsIGJvZHksIGZvb3RlciB9O1xyXG59O1xyXG5sZXQgb3V0cHV0X2RlYnVnID0gZnVuY3Rpb24gKGRhdGFDb21wdXRlZDogU2VyaWVzW10pOiBTdHJpbmcge1xyXG4gICAgbGV0IGRlYnVnX291dHB1dCA9IGBcclxuICAgICAgICA8dGFibGUgY2xhc3M9XCJ0YWJsZS1wYW5lbC10YWJsZVwiPlxyXG4gICAgICAgICAgICA8dGhlYWQ+XHJcbiAgICAgICAgICAgICAgICA8dHI+XHJcbiAgICAgICAgICAgICAgICAgICAgPHRoIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpjZW50ZXJcIj5NZXRyaWM8L3RoPlxyXG4gICAgICAgICAgICAgICAgICAgIDx0aCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246Y2VudGVyXCI+UGF0dGVybjwvdGg+XHJcbiAgICAgICAgICAgICAgICAgICAgPHRoIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpjZW50ZXJcIj5WYWx1ZTwvdGg+XHJcbiAgICAgICAgICAgICAgICAgICAgPHRoIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpjZW50ZXJcIj5Sb3cgTmFtZTwvdGg+XHJcbiAgICAgICAgICAgICAgICAgICAgPHRoIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpjZW50ZXJcIj5Db2wgTmFtZTwvdGg+XHJcbiAgICAgICAgICAgICAgICAgICAgPHRoIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpjZW50ZXJcIj5UaHJlc2hvbGRzPC90aD5cclxuICAgICAgICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICAgIDwvdGhlYWQ+XHJcbiAgICAgICAgICAgIDx0Ym9keSBpZD1cImJvb210YWJsZV9vdXRwdXRfYm9keV9kZWJ1Z1wiPlxyXG4gICAgYDtcclxuICAgIF8uZWFjaChkYXRhQ29tcHV0ZWQsIGQgPT4ge1xyXG4gICAgICAgIGRlYnVnX291dHB1dCArPSBgXHJcbiAgICAgICAgICA8dHI+XHJcbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O1wiIHdpZHRoPVwiNDAlXCI+JHtkLmFsaWFzfTwvdGQ+XHJcbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O1wiPiR7ZC5wYXR0ZXJuLnBhdHRlcm4gfHwgXCJEZWZhdWx0XCJ9PC90ZD5cclxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7YmFja2dyb3VuZC1jb2xvcjoke2QuYmdDb2xvcn1cIj4ke2QuZGlzcGxheVZhbHVlfTwvdGQ+XHJcbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O1wiPiR7ZC5yb3dfbmFtZX08L3RkPlxyXG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDtcIj4ke2QuY29sX25hbWV9PC90ZD5cclxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7XCI+JHtkLnRocmVzaG9sZHN9PC90ZD5cclxuICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICBgO1xyXG4gICAgfSk7XHJcbiAgICBkZWJ1Z19vdXRwdXQgKz0gYFxyXG4gICAgICAgIDwvdGJvZHk+XHJcbiAgICAgICAgPC90YWJsZT5cclxuICAgIGA7XHJcbiAgICByZXR1cm4gZGVidWdfb3V0cHV0O1xyXG59O1xyXG5sZXQgZ2V0VG9vbHRpcE1lc3NhZ2UgPSBmdW5jdGlvbiAodGVtcGxhdGU6IFN0cmluZywgcm93X25hbWU6IFN0cmluZywgY29sX25hbWU6IFN0cmluZywgdmFsdWU6IE51bWJlcik6IFN0cmluZyB7XHJcbiAgICBpZiAodGVtcGxhdGUgPT09IFwiX1wiKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICB9XHJcbiAgICBsZXQgdG9vbHRpcCA9IHRlbXBsYXRlO1xyXG4gICAgdG9vbHRpcCA9IHRvb2x0aXAucmVwbGFjZShuZXcgUmVnRXhwKFwiX3Jvd19uYW1lX1wiLCBcImdcIiksIFN0cmluZyhyb3dfbmFtZSkpO1xyXG4gICAgdG9vbHRpcCA9IHRvb2x0aXAucmVwbGFjZShuZXcgUmVnRXhwKFwiX2NvbF9uYW1lX1wiLCBcImdcIiksIFN0cmluZyhjb2xfbmFtZSkpO1xyXG4gICAgdG9vbHRpcCA9IHRvb2x0aXAucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX1wiLCBcImdcIiksIFN0cmluZyh2YWx1ZSkpO1xyXG4gICAgcmV0dXJuIHRvb2x0aXA7XHJcbn07XHJcbmV4cG9ydCB7XHJcbiAgICBnZXRUb29sdGlwTWVzc2FnZSxcclxuICAgIGJ1aWxkT3V0cHV0RGF0YSxcclxuICAgIG91dHB1dCBhcyBidWlsZE91dHB1dCxcclxuICAgIG91dHB1dF9kZWJ1ZyBhcyBidWlsZERlYnVnT3V0cHV0XHJcbn07XHJcbiJdfQ==