System.register(["app/core/time_series2", "lodash", "./index", "./BoomSeriesUtils", "./../GrafanaUtils"], function (exports_1, context_1) {
    "use strict";
    var time_series2_1, lodash_1, index_1, BoomSeriesUtils_1, GrafanaUtils_1, BoomSeries;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (time_series2_1_1) {
                time_series2_1 = time_series2_1_1;
            },
            function (lodash_1_1) {
                lodash_1 = lodash_1_1;
            },
            function (index_1_1) {
                index_1 = index_1_1;
            },
            function (BoomSeriesUtils_1_1) {
                BoomSeriesUtils_1 = BoomSeriesUtils_1_1;
            },
            function (GrafanaUtils_1_1) {
                GrafanaUtils_1 = GrafanaUtils_1_1;
            }
        ],
        execute: function () {
            BoomSeries = (function () {
                function BoomSeries(seriesData, panelDefaultPattern, panelPatterns, options, scopedVars, templateSrv, timeSrv) {
                    this.pattern = undefined;
                    this.template_value = "";
                    this.row_col_wrapper = "_";
                    this.display_value = "-";
                    this.tooltip = "-";
                    this.value = NaN;
                    this.value_formatted = "-";
                    this.link = "-";
                    this.hidden = false;
                    this._metricname = "";
                    this._tags = [];
                    var series = new time_series2_1.default({
                        alias: seriesData.target,
                        datapoints: seriesData.datapoints || []
                    });
                    series.flotpairs = series.getFlotPairs("connected");
                    this.debug_mode = options && options.debug_mode === true ? true : false;
                    this.row_col_wrapper = options && options.row_col_wrapper ? options.row_col_wrapper : this.row_col_wrapper;
                    this.currentTimeStamp = BoomSeriesUtils_1.getCurrentTimeStamp(series.dataPoints);
                    this.seriesName = series.alias || series.aliasEscaped || series.label || series.id || "";
                    var getMatchingAndEnabledPattern = function (patterns, seriesName) { return patterns.find(function (p) { return seriesName.match(p.pattern) && p.disabled !== true; }); };
                    this.pattern = getMatchingAndEnabledPattern(panelPatterns, this.seriesName) || panelDefaultPattern;
                    this.decimals = this.pattern.decimals || panelDefaultPattern.decimals || 2;
                    this.value = BoomSeriesUtils_1.getSeriesValue(series, this.pattern.valueName);
                    this.display_value = (lodash_1.default.isNaN(this.value) || this.value === null) ? this.pattern.null_value : String(this.value);
                    this.value_formatted = GrafanaUtils_1.get_formatted_value(this.value, this.decimals, this.pattern.format);
                    this.display_value = String(this.value_formatted);
                    this.hidden = BoomSeriesUtils_1.doesValueNeedsToHide(this.value, this.pattern);
                    this._metricname = this.pattern.delimiter.toLowerCase() === "tag" ? index_1.getMetricNameFromTaggedAlias(seriesData.target) : "";
                    this._tags = this.pattern.delimiter.toLowerCase() === "tag" ? index_1.getLablesFromTaggedAlias(seriesData.target, this._metricname) : [];
                    this.row_name = BoomSeriesUtils_1.getRowName(this.pattern, this.row_col_wrapper, this.seriesName, this._metricname, this._tags);
                    this.row_name_raw = BoomSeriesUtils_1.getRowName(this.pattern, this.row_col_wrapper, this.seriesName, this._metricname, this._tags);
                    this.col_name = BoomSeriesUtils_1.getColName(this.pattern, this.row_col_wrapper, this.seriesName, this.row_name, this._metricname, this._tags);
                    this.thresholds = BoomSeriesUtils_1.getThresholds(templateSrv.replace(this.pattern.thresholds, scopedVars).split(",").map(function (d) { return +d; }), this.pattern, this.currentTimeStamp);
                    this.color_bg = BoomSeriesUtils_1.getBGColor(this.value, this.pattern, this.thresholds, templateSrv.replace(this.pattern.bgColors, scopedVars).split("|"), templateSrv.replace(this.pattern.bgColors_overrides, scopedVars).split("|"));
                    this.color_text = BoomSeriesUtils_1.getTextColor(this.value, this.pattern, this.thresholds, templateSrv.replace(this.pattern.textColors, scopedVars).split("|"), templateSrv.replace(this.pattern.textColors_overrides, scopedVars).split("|"));
                    this.template_value = BoomSeriesUtils_1.getDisplayValueTemplate(this.value, this.pattern, this.seriesName, this.row_col_wrapper, this.thresholds);
                    this.tooltip = this.pattern.tooltipTemplate || "Series : _series_ <br/>Row Name : _row_name_ <br/>Col Name : _col_name_ <br/>Value : _value_";
                    this.link = BoomSeriesUtils_1.getLink(this.pattern.enable_clickable_cells, this.pattern.clickable_cells_link, timeSrv.timeRangeForUrl());
                    this.replaceTokens(templateSrv, scopedVars, series);
                    if (this.debug_mode !== true) {
                        delete this.seriesName;
                        delete this.pattern;
                        delete this.thresholds;
                        delete this.decimals;
                        delete this.template_value;
                        delete this.value_formatted;
                        delete this.currentTimeStamp;
                    }
                }
                BoomSeries.prototype.replaceTokens = function (templateSrv, scopedVars, series) {
                    this.link = BoomSeriesUtils_1.replaceDelimitedColumns(this.link, this.seriesName, this.pattern.delimiter, this.row_col_wrapper);
                    this.link = this.link.replace(new RegExp("_series_", "g"), this.seriesName.toString().trim());
                    this.tooltip = this.tooltip.replace(new RegExp("_series_", "g"), this.seriesName.toString().trim());
                    this.display_value = this.template_value.replace(new RegExp("_series_", "g"), this.seriesName.toString());
                    this.col_name = this.col_name.replace(new RegExp("_row_name_", "g"), this.row_name.toString());
                    this.link = this.link.replace(new RegExp("_row_name_", "g"), index_1.getActualNameWithoutTokens(this.row_name.toString()).trim());
                    this.tooltip = this.tooltip.replace(new RegExp("_row_name_", "g"), index_1.getActualNameWithoutTokens(this.row_name.toString()).trim());
                    this.display_value = this.display_value.replace(new RegExp("_row_name_", "g"), this.row_name.toString());
                    this.row_name = this.row_name.replace(new RegExp("_col_name_", "g"), this.col_name.toString());
                    this.link = this.link.replace(new RegExp("_col_name_", "g"), index_1.getActualNameWithoutTokens(this.col_name.toString()).trim());
                    this.tooltip = this.tooltip.replace(new RegExp("_col_name_", "g"), index_1.getActualNameWithoutTokens(this.col_name.toString()).trim());
                    this.display_value = this.display_value.replace(new RegExp("_col_name_", "g"), this.col_name.toString());
                    var value_raw = lodash_1.default.isNaN(this.value) || this.value === null ? "null" : this.value.toString().trim();
                    this.link = this.link.replace(new RegExp("_value_raw_", "g"), value_raw);
                    this.tooltip = this.tooltip.replace(new RegExp("_value_raw_", "g"), value_raw);
                    this.display_value = this.display_value.replace(new RegExp("_value_raw_", "g"), value_raw);
                    this.display_value = this.display_value.replace(new RegExp("_value_min_raw_", "g"), series.stats.min);
                    this.display_value = this.display_value.replace(new RegExp("_value_min_", "g"), GrafanaUtils_1.get_formatted_value(series.stats.min, this.decimals, this.pattern.format));
                    this.display_value = this.display_value.replace(new RegExp("_value_max_raw_", "g"), series.stats.max);
                    this.display_value = this.display_value.replace(new RegExp("_value_max_", "g"), GrafanaUtils_1.get_formatted_value(series.stats.max, this.decimals, this.pattern.format));
                    this.display_value = this.display_value.replace(new RegExp("_value_avg_raw_", "g"), series.stats.avg);
                    this.display_value = this.display_value.replace(new RegExp("_value_avg_", "g"), GrafanaUtils_1.get_formatted_value(series.stats.avg, this.decimals, this.pattern.format));
                    this.display_value = this.display_value.replace(new RegExp("_value_current_raw_", "g"), series.stats.current);
                    this.display_value = this.display_value.replace(new RegExp("_value_current_", "g"), GrafanaUtils_1.get_formatted_value(series.stats.current, this.decimals, this.pattern.format));
                    this.display_value = this.display_value.replace(new RegExp("_value_total_raw_", "g"), series.stats.total);
                    this.display_value = this.display_value.replace(new RegExp("_value_total_", "g"), GrafanaUtils_1.get_formatted_value(series.stats.total, this.decimals, this.pattern.format));
                    if ((this.pattern.delimiter || "").toLowerCase() === "tag") {
                        this.display_value = this.display_value.replace(new RegExp("{{metric_name}}", "g"), this._metricname);
                        this.link = this.link.replace(new RegExp("{{metric_name}}", "g"), this._metricname);
                        this.tooltip = this.tooltip.replace(new RegExp("{{metric_name}}", "g"), this._metricname);
                        this.display_value = index_1.replace_tags_from_field(this.display_value, this._tags);
                        this.link = index_1.replace_tags_from_field(this.link, this._tags);
                        this.tooltip = index_1.replace_tags_from_field(this.tooltip, this._tags);
                    }
                    var value_formatted = lodash_1.default.isNaN(this.value) || this.value === null ? "null" : this.value_formatted.toString().trim();
                    this.link = this.link.replace(new RegExp("_value_", "g"), value_formatted);
                    this.tooltip = this.tooltip.replace(new RegExp("_value_", "g"), value_formatted);
                    this.display_value = this.display_value.replace(new RegExp("_value_", "g"), value_formatted);
                    this.row_name = index_1.replaceTokens(this.row_name);
                    this.col_name = index_1.replaceTokens(this.col_name);
                    this.display_value = index_1.replaceTokens(this.display_value);
                    this.row_name = templateSrv.replace(this.row_name, scopedVars);
                    this.col_name = templateSrv.replace(this.col_name, scopedVars);
                    this.display_value = templateSrv.replace(this.display_value, scopedVars);
                    this.tooltip = templateSrv.replace(this.tooltip, scopedVars);
                    this.link = templateSrv.replace(this.link, scopedVars);
                };
                return BoomSeries;
            }());
            exports_1("BoomSeries", BoomSeries);
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQm9vbVNlcmllcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcHAvYm9vbS9Cb29tU2VyaWVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O1lBU0E7Z0JBc0JJLG9CQUFZLFVBQWUsRUFBRSxtQkFBd0IsRUFBRSxhQUFvQixFQUFFLE9BQVksRUFBRSxVQUFlLEVBQUUsV0FBZ0IsRUFBRSxPQUFZO29CQXBCbEksWUFBTyxHQUFRLFNBQVMsQ0FBQztvQkFHekIsbUJBQWMsR0FBRyxFQUFFLENBQUM7b0JBQ3BCLG9CQUFlLEdBQUcsR0FBRyxDQUFDO29CQU92QixrQkFBYSxHQUFHLEdBQUcsQ0FBQztvQkFDcEIsWUFBTyxHQUFHLEdBQUcsQ0FBQztvQkFDZCxVQUFLLEdBQUcsR0FBRyxDQUFDO29CQUNaLG9CQUFlLEdBQUcsR0FBRyxDQUFDO29CQUN0QixTQUFJLEdBQUcsR0FBRyxDQUFDO29CQUVYLFdBQU0sR0FBWSxLQUFLLENBQUM7b0JBQ3hCLGdCQUFXLEdBQUcsRUFBRSxDQUFDO29CQUNqQixVQUFLLEdBQVUsRUFBRSxDQUFDO29CQUVyQixJQUFJLE1BQU0sR0FBRyxJQUFJLHNCQUFVLENBQUM7d0JBQ3hCLEtBQUssRUFBRSxVQUFVLENBQUMsTUFBTTt3QkFDeEIsVUFBVSxFQUFFLFVBQVUsQ0FBQyxVQUFVLElBQUksRUFBRTtxQkFDMUMsQ0FBQyxDQUFDO29CQUNILE1BQU0sQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUMsQ0FBQztvQkFDcEQsSUFBSSxDQUFDLFVBQVUsR0FBRyxPQUFPLElBQUksT0FBTyxDQUFDLFVBQVUsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO29CQUN4RSxJQUFJLENBQUMsZUFBZSxHQUFHLE9BQU8sSUFBSSxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxP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UUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO29CQUMvRCxJQUFJLENBQUMsYUFBYSxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxVQUFVLENBQUMsQ0FBQztvQkFDekUsSUFBSSxDQUFDLE9BQU8sR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUM7b0JBQzdELElBQUksQ0FBQyxJQUFJLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO2dCQUMzRCxDQUFDO2dCQUNMLGlCQUFDO1lBQUQsQ0FBQyxBQS9HRCxJQStHQyIsInNvdXJjZXNDb250ZW50IjpbIi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uLy4uL25vZGVfbW9kdWxlcy9ncmFmYW5hLXNkay1tb2Nrcy9hcHAvaGVhZGVycy9jb21tb24uZC50c1wiIC8+XG5cbmltcG9ydCBUaW1lU2VyaWVzIGZyb20gXCJhcHAvY29yZS90aW1lX3NlcmllczJcIjtcbmltcG9ydCBfIGZyb20gXCJsb2Rhc2hcIjtcbmltcG9ydCB7IHJlcGxhY2VUb2tlbnMsIGdldEFjdHVhbE5hbWVXaXRob3V0VG9rZW5zLCBnZXRNZXRyaWNOYW1lRnJvbVRhZ2dlZEFsaWFzLCBnZXRMYWJsZXNGcm9tVGFnZ2VkQWxpYXMsIHJlcGxhY2VfdGFnc19mcm9tX2ZpZWxkIH0gZnJvbSBcIi4vaW5kZXhcIjtcbmltcG9ydCB7IGdldERpc3BsYXlWYWx1ZVRlbXBsYXRlLCBnZXRUaHJlc2hvbGRzLCBnZXRCR0NvbG9yLCBnZXRUZXh0Q29sb3IsIGdldFNlcmllc1ZhbHVlLCBnZXRMaW5rLCBnZXRDdXJyZW50VGltZVN0YW1wLCBkb2VzVmFsdWVOZWVkc1RvSGlkZSwgcmVwbGFjZURlbGltaXRlZENvbHVtbnMsIGdldFJvd05hbWUsIGdldENvbE5hbWUgfSBmcm9tIFwiLi9Cb29tU2VyaWVzVXRpbHNcIjtcbmltcG9ydCB7IGdldF9mb3JtYXR0ZWRfdmFsdWUgfSBmcm9tIFwiLi8uLi9HcmFmYW5hVXRpbHNcIjtcbmltcG9ydCB7IElCb29tU2VyaWVzIH0gZnJvbSBcIi4vQm9vbS5pbnRlcmZhY2VcIjtcblxuY2xhc3MgQm9vbVNlcmllcyBpbXBsZW1lbnRzIElCb29tU2VyaWVzIHtcbiAgICBwcml2YXRlIGRlYnVnX21vZGU6IEJvb2xlYW47XG4gICAgcHJpdmF0ZSBwYXR0ZXJuOiBhbnkgPSB1bmRlZmluZWQ7XG4gICAgcHJpdmF0ZSBzZXJpZXNOYW1lOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBjdXJyZW50VGltZVN0YW1wOiBEYXRlO1xuICAgIHByaXZhdGUgdGVtcGxhdGVfdmFsdWUgPSBcIlwiO1xuICAgIHByaXZhdGUgcm93X2NvbF93cmFwcGVyID0gXCJfXCI7XG4gICAgcHJpdmF0ZSBkZWNpbWFsczogTnVtYmVyO1xuICAgIHB1YmxpYyBjb2xfbmFtZTogc3RyaW5nO1xuICAgIHB1YmxpYyByb3dfbmFtZTogc3RyaW5nO1xuICAgIHB1YmxpYyByb3dfbmFtZV9yYXc6IHN0cmluZztcbiAgICBwdWJsaWMgY29sb3JfYmc6IHN0cmluZztcbiAgICBwdWJsaWMgY29sb3JfdGV4dDogc3RyaW5nO1xuICAgIHB1YmxpYyBkaXNwbGF5X3ZhbHVlID0gXCItXCI7XG4gICAgcHVibGljIHRvb2x0aXAgPSBcIi1cIjtcbiAgICBwdWJsaWMgdmFsdWUgPSBOYU47XG4gICAgcHVibGljIHZhbHVlX2Zvcm1hdHRlZCA9IFwiLVwiO1xuICAgIHB1YmxpYyBsaW5rID0gXCItXCI7XG4gICAgcHVibGljIHRocmVzaG9sZHM6IE51bWJlcltdO1xuICAgIHB1YmxpYyBoaWRkZW46IEJvb2xlYW4gPSBmYWxzZTtcbiAgICBwdWJsaWMgX21ldHJpY25hbWUgPSBcIlwiO1xuICAgIHB1YmxpYyBfdGFnczogYW55W10gPSBbXTtcbiAgICBjb25zdHJ1Y3RvcihzZXJpZXNEYXRhOiBhbnksIHBhbmVsRGVmYXVsdFBhdHRlcm46IGFueSwgcGFuZWxQYXR0ZXJuczogYW55W10sIG9wdGlvbnM6IGFueSwgc2NvcGVkVmFyczogYW55LCB0ZW1wbGF0ZVNydjogYW55LCB0aW1lU3J2OiBhbnkpIHtcbiAgICAgICAgbGV0IHNlcmllcyA9IG5ldyBUaW1lU2VyaWVzKHtcbiAgICAgICAgICAgIGFsaWFzOiBzZXJpZXNEYXRhLnRhcmdldCxcbiAgICAgICAgICAgIGRhdGFwb2ludHM6IHNlcmllc0RhdGEuZGF0YXBvaW50cyB8fCBbXVxuICAgICAgICB9KTtcbiAgICAgICAgc2VyaWVzLmZsb3RwYWlycyA9IHNlcmllcy5nZXRGbG90UGFpcnMoXCJjb25uZWN0ZWRcIik7XG4gICAgICAgIHRoaXMuZGVidWdfbW9kZSA9IG9wdGlvbnMgJiYgb3B0aW9ucy5kZWJ1Z19tb2RlID09PSB0cnVlID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICB0aGlzLnJvd19jb2xfd3JhcHBlciA9IG9wdGlvbnMgJiYgb3B0aW9ucy5yb3dfY29sX3dyYXBwZXIgPyBvcHRpb25zLnJvd19jb2xfd3JhcHBlciA6IHRoaXMucm93X2NvbF93cmFwcGVyO1xuICAgICAgICB0aGlzLmN1cnJlbnRUaW1lU3RhbXAgPSBnZXRDdXJyZW50VGltZVN0YW1wKHNlcmllcy5kYXRhUG9pbnRzKTtcbiAgICAgICAgdGhpcy5zZXJpZXNOYW1lID0gc2VyaWVzLmFsaWFzIHx8IHNlcmllcy5hbGlhc0VzY2FwZWQgfHwgc2VyaWVzLmxhYmVsIHx8IHNlcmllcy5pZCB8fCBcIlwiO1xuICAgICAgICBsZXQgZ2V0TWF0Y2hpbmdBbmRFbmFibGVkUGF0dGVybiA9IChwYXR0ZXJucywgc2VyaWVzTmFtZSkgPT4gcGF0dGVybnMuZmluZChwID0+IHNlcmllc05hbWUubWF0Y2gocC5wYXR0ZXJuKSAmJiBwLmRpc2FibGVkICE9PSB0cnVlKTtcbiAgICAgICAgdGhpcy5wYXR0ZXJuID0gZ2V0TWF0Y2hpbmdBbmRFbmFibGVkUGF0dGVybihwYW5lbFBhdHRlcm5zLCB0aGlzLnNlcmllc05hbWUpIHx8IHBhbmVsRGVmYXVsdFBhdHRlcm47XG5cbiAgICAgICAgdGhpcy5kZWNpbWFscyA9IHRoaXMucGF0dGVybi5kZWNpbWFscyB8fCBwYW5lbERlZmF1bHRQYXR0ZXJuLmRlY2ltYWxzIHx8IDI7XG4gICAgICAgIHRoaXMudmFsdWUgPSBnZXRTZXJpZXNWYWx1ZShzZXJpZXMsIHRoaXMucGF0dGVybi52YWx1ZU5hbWUpO1xuICAgICAgICB0aGlzLmRpc3BsYXlfdmFsdWUgPSAoXy5pc05hTih0aGlzLnZhbHVlKSB8fCB0aGlzLnZhbHVlID09PSBudWxsKSA/IHRoaXMucGF0dGVybi5udWxsX3ZhbHVlIDogU3RyaW5nKHRoaXMudmFsdWUpO1xuICAgICAgICB0aGlzLnZhbHVlX2Zvcm1hdHRlZCA9IGdldF9mb3JtYXR0ZWRfdmFsdWUodGhpcy52YWx1ZSwgdGhpcy5kZWNpbWFscywgdGhpcy5wYXR0ZXJuLmZvcm1hdCk7XG4gICAgICAgIHRoaXMuZGlzcGxheV92YWx1ZSA9IFN0cmluZyh0aGlzLnZhbHVlX2Zvcm1hdHRlZCk7XG4gICAgICAgIHRoaXMuaGlkZGVuID0gZG9lc1ZhbHVlTmVlZHNUb0hpZGUodGhpcy52YWx1ZSwgdGhpcy5wYXR0ZXJuKTtcbiAgICAgICAgdGhpcy5fbWV0cmljbmFtZSA9IHRoaXMucGF0dGVybi5kZWxpbWl0ZXIudG9Mb3dlckNhc2UoKSA9PT0gXCJ0YWdcIiA/IGdldE1ldHJpY05hbWVGcm9tVGFnZ2VkQWxpYXMoc2VyaWVzRGF0YS50YXJnZXQpIDogXCJcIjtcbiAgICAgICAgdGhpcy5fdGFncyA9IHRoaXMucGF0dGVybi5kZWxpbWl0ZXIudG9Mb3dlckNhc2UoKSA9PT0gXCJ0YWdcIiA/IGdldExhYmxlc0Zyb21UYWdnZWRBbGlhcyhzZXJpZXNEYXRhLnRhcmdldCwgdGhpcy5fbWV0cmljbmFtZSkgOiBbXTtcbiAgICAgICAgdGhpcy5yb3dfbmFtZSA9IGdldFJvd05hbWUodGhpcy5wYXR0ZXJuLCB0aGlzLnJvd19jb2xfd3JhcHBlciwgdGhpcy5zZXJpZXNOYW1lLCB0aGlzLl9tZXRyaWNuYW1lLCB0aGlzLl90YWdzKTtcbiAgICAgICAgdGhpcy5yb3dfbmFtZV9yYXcgPSBnZXRSb3dOYW1lKHRoaXMucGF0dGVybiwgdGhpcy5yb3dfY29sX3dyYXBwZXIsIHRoaXMuc2VyaWVzTmFtZSwgdGhpcy5fbWV0cmljbmFtZSwgdGhpcy5fdGFncyk7XG4gICAgICAgIHRoaXMuY29sX25hbWUgPSBnZXRDb2xOYW1lKHRoaXMucGF0dGVybiwgdGhpcy5yb3dfY29sX3dyYXBwZXIsIHRoaXMuc2VyaWVzTmFtZSwgdGhpcy5yb3dfbmFtZSwgdGhpcy5fbWV0cmljbmFtZSwgdGhpcy5fdGFncyk7XG4gICAgICAgIHRoaXMudGhyZXNob2xkcyA9IGdldFRocmVzaG9sZHModGVtcGxhdGVTcnYucmVwbGFjZSh0aGlzLnBhdHRlcm4udGhyZXNob2xkcywgc2NvcGVkVmFycykuc3BsaXQoXCIsXCIpLm1hcChkID0+ICtkKSwgdGhpcy5wYXR0ZXJuLCB0aGlzLmN1cnJlbnRUaW1lU3RhbXApO1xuICAgICAgICB0aGlzLmNvbG9yX2JnID0gZ2V0QkdDb2xvcih0aGlzLnZhbHVlLCB0aGlzLnBhdHRlcm4sIHRoaXMudGhyZXNob2xkcywgdGVtcGxhdGVTcnYucmVwbGFjZSh0aGlzLnBhdHRlcm4uYmdDb2xvcnMsIHNjb3BlZFZhcnMpLnNwbGl0KFwifFwiKSwgdGVtcGxhdGVTcnYucmVwbGFjZSh0aGlzLnBhdHRlcm4uYmdDb2xvcnNfb3ZlcnJpZGVzLCBzY29wZWRWYXJzKS5zcGxpdChcInxcIikpO1xuICAgICAgICB0aGlzLmNvbG9yX3RleHQgPSBnZXRUZXh0Q29sb3IodGhpcy52YWx1ZSwgdGhpcy5wYXR0ZXJuLCB0aGlzLnRocmVzaG9sZHMsIHRlbXBsYXRlU3J2LnJlcGxhY2UodGhpcy5wYXR0ZXJuLnRleHRDb2xvcnMsIHNjb3BlZFZhcnMpLnNwbGl0KFwifFwiKSwgdGVtcGxhdGVTcnYucmVwbGFjZSh0aGlzLnBhdHRlcm4udGV4dENvbG9yc19vdmVycmlkZXMsIHNjb3BlZFZhcnMpLnNwbGl0KFwifFwiKSk7XG4gICAgICAgIHRoaXMudGVtcGxhdGVfdmFsdWUgPSBnZXREaXNwbGF5VmFsdWVUZW1wbGF0ZSh0aGlzLnZhbHVlLCB0aGlzLnBhdHRlcm4sIHRoaXMuc2VyaWVzTmFtZSwgdGhpcy5yb3dfY29sX3dyYXBwZXIsIHRoaXMudGhyZXNob2xkcyk7XG4gICAgICAgIHRoaXMudG9vbHRpcCA9IHRoaXMucGF0dGVybi50b29sdGlwVGVtcGxhdGUgfHwgXCJTZXJpZXMgOiBfc2VyaWVzXyA8YnIvPlJvdyBOYW1lIDogX3Jvd19uYW1lXyA8YnIvPkNvbCBOYW1lIDogX2NvbF9uYW1lXyA8YnIvPlZhbHVlIDogX3ZhbHVlX1wiO1xuICAgICAgICB0aGlzLmxpbmsgPSBnZXRMaW5rKHRoaXMucGF0dGVybi5lbmFibGVfY2xpY2thYmxlX2NlbGxzLCB0aGlzLnBhdHRlcm4uY2xpY2thYmxlX2NlbGxzX2xpbmssIHRpbWVTcnYudGltZVJhbmdlRm9yVXJsKCkpO1xuICAgICAgICB0aGlzLnJlcGxhY2VUb2tlbnModGVtcGxhdGVTcnYsIHNjb3BlZFZhcnMsIHNlcmllcyk7XG4gICAgICAgIGlmICh0aGlzLmRlYnVnX21vZGUgIT09IHRydWUpIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnNlcmllc05hbWU7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5wYXR0ZXJuO1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMudGhyZXNob2xkcztcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmRlY2ltYWxzO1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMudGVtcGxhdGVfdmFsdWU7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy52YWx1ZV9mb3JtYXR0ZWQ7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5jdXJyZW50VGltZVN0YW1wO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgcmVwbGFjZVRva2Vucyh0ZW1wbGF0ZVNydjogYW55LCBzY29wZWRWYXJzOiBhbnksIHNlcmllczogYW55KSB7XG4gICAgICAgIHRoaXMubGluayA9IHJlcGxhY2VEZWxpbWl0ZWRDb2x1bW5zKHRoaXMubGluaywgdGhpcy5zZXJpZXNOYW1lLCB0aGlzLnBhdHRlcm4uZGVsaW1pdGVyLCB0aGlzLnJvd19jb2xfd3JhcHBlcik7XG4gICAgICAgIHRoaXMubGluayA9IHRoaXMubGluay5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfc2VyaWVzX1wiLCBcImdcIiksIHRoaXMuc2VyaWVzTmFtZS50b1N0cmluZygpLnRyaW0oKSk7XG4gICAgICAgIHRoaXMudG9vbHRpcCA9IHRoaXMudG9vbHRpcC5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfc2VyaWVzX1wiLCBcImdcIiksIHRoaXMuc2VyaWVzTmFtZS50b1N0cmluZygpLnRyaW0oKSk7XG4gICAgICAgIHRoaXMuZGlzcGxheV92YWx1ZSA9IHRoaXMudGVtcGxhdGVfdmFsdWUucmVwbGFjZShuZXcgUmVnRXhwKFwiX3Nlcmllc19cIiwgXCJnXCIpLCB0aGlzLnNlcmllc05hbWUudG9TdHJpbmcoKSk7XG4gICAgICAgIHRoaXMuY29sX25hbWUgPSB0aGlzLmNvbF9uYW1lLnJlcGxhY2UobmV3IFJlZ0V4cChcIl9yb3dfbmFtZV9cIiwgXCJnXCIpLCB0aGlzLnJvd19uYW1lLnRvU3RyaW5nKCkpO1xuICAgICAgICB0aGlzLmxpbmsgPSB0aGlzLmxpbmsucmVwbGFjZShuZXcgUmVnRXhwKFwiX3Jvd19uYW1lX1wiLCBcImdcIiksIGdldEFjdHVhbE5hbWVXaXRob3V0VG9rZW5zKHRoaXMucm93X25hbWUudG9TdHJpbmcoKSkudHJpbSgpKTtcbiAgICAgICAgdGhpcy50b29sdGlwID0gdGhpcy50b29sdGlwLnJlcGxhY2UobmV3IFJlZ0V4cChcIl9yb3dfbmFtZV9cIiwgXCJnXCIpLCBnZXRBY3R1YWxOYW1lV2l0aG91dFRva2Vucyh0aGlzLnJvd19uYW1lLnRvU3RyaW5nKCkpLnRyaW0oKSk7XG4gICAgICAgIHRoaXMuZGlzcGxheV92YWx1ZSA9IHRoaXMuZGlzcGxheV92YWx1ZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfcm93X25hbWVfXCIsIFwiZ1wiKSwgdGhpcy5yb3dfbmFtZS50b1N0cmluZygpKTtcbiAgICAgICAgdGhpcy5yb3dfbmFtZSA9IHRoaXMucm93X25hbWUucmVwbGFjZShuZXcgUmVnRXhwKFwiX2NvbF9uYW1lX1wiLCBcImdcIiksIHRoaXMuY29sX25hbWUudG9TdHJpbmcoKSk7XG4gICAgICAgIHRoaXMubGluayA9IHRoaXMubGluay5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfY29sX25hbWVfXCIsIFwiZ1wiKSwgZ2V0QWN0dWFsTmFtZVdpdGhvdXRUb2tlbnModGhpcy5jb2xfbmFtZS50b1N0cmluZygpKS50cmltKCkpO1xuICAgICAgICB0aGlzLnRvb2x0aXAgPSB0aGlzLnRvb2x0aXAucmVwbGFjZShuZXcgUmVnRXhwKFwiX2NvbF9uYW1lX1wiLCBcImdcIiksIGdldEFjdHVhbE5hbWVXaXRob3V0VG9rZW5zKHRoaXMuY29sX25hbWUudG9TdHJpbmcoKSkudHJpbSgpKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5X3ZhbHVlID0gdGhpcy5kaXNwbGF5X3ZhbHVlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl9jb2xfbmFtZV9cIiwgXCJnXCIpLCB0aGlzLmNvbF9uYW1lLnRvU3RyaW5nKCkpO1xuICAgICAgICBsZXQgdmFsdWVfcmF3ID0gXy5pc05hTih0aGlzLnZhbHVlKSB8fCB0aGlzLnZhbHVlID09PSBudWxsID8gXCJudWxsXCIgOiB0aGlzLnZhbHVlLnRvU3RyaW5nKCkudHJpbSgpO1xuICAgICAgICB0aGlzLmxpbmsgPSB0aGlzLmxpbmsucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX3Jhd19cIiwgXCJnXCIpLCB2YWx1ZV9yYXcpO1xuICAgICAgICB0aGlzLnRvb2x0aXAgPSB0aGlzLnRvb2x0aXAucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX3Jhd19cIiwgXCJnXCIpLCB2YWx1ZV9yYXcpO1xuICAgICAgICB0aGlzLmRpc3BsYXlfdmFsdWUgPSB0aGlzLmRpc3BsYXlfdmFsdWUucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX3Jhd19cIiwgXCJnXCIpLCB2YWx1ZV9yYXcpO1xuICAgICAgICB0aGlzLmRpc3BsYXlfdmFsdWUgPSB0aGlzLmRpc3BsYXlfdmFsdWUucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX21pbl9yYXdfXCIsIFwiZ1wiKSwgc2VyaWVzLnN0YXRzLm1pbik7XG4gICAgICAgIHRoaXMuZGlzcGxheV92YWx1ZSA9IHRoaXMuZGlzcGxheV92YWx1ZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfdmFsdWVfbWluX1wiLCBcImdcIiksIGdldF9mb3JtYXR0ZWRfdmFsdWUoc2VyaWVzLnN0YXRzLm1pbiwgdGhpcy5kZWNpbWFscywgdGhpcy5wYXR0ZXJuLmZvcm1hdCkpO1xuICAgICAgICB0aGlzLmRpc3BsYXlfdmFsdWUgPSB0aGlzLmRpc3BsYXlfdmFsdWUucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX21heF9yYXdfXCIsIFwiZ1wiKSwgc2VyaWVzLnN0YXRzLm1heCk7XG4gICAgICAgIHRoaXMuZGlzcGxheV92YWx1ZSA9IHRoaXMuZGlzcGxheV92YWx1ZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfdmFsdWVfbWF4X1wiLCBcImdcIiksIGdldF9mb3JtYXR0ZWRfdmFsdWUoc2VyaWVzLnN0YXRzLm1heCwgdGhpcy5kZWNpbWFscywgdGhpcy5wYXR0ZXJuLmZvcm1hdCkpO1xuICAgICAgICB0aGlzLmRpc3BsYXlfdmFsdWUgPSB0aGlzLmRpc3BsYXlfdmFsdWUucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX2F2Z19yYXdfXCIsIFwiZ1wiKSwgc2VyaWVzLnN0YXRzLmF2Zyk7XG4gICAgICAgIHRoaXMuZGlzcGxheV92YWx1ZSA9IHRoaXMuZGlzcGxheV92YWx1ZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfdmFsdWVfYXZnX1wiLCBcImdcIiksIGdldF9mb3JtYXR0ZWRfdmFsdWUoc2VyaWVzLnN0YXRzLmF2ZywgdGhpcy5kZWNpbWFscywgdGhpcy5wYXR0ZXJuLmZvcm1hdCkpO1xuICAgICAgICB0aGlzLmRpc3BsYXlfdmFsdWUgPSB0aGlzLmRpc3BsYXlfdmFsdWUucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX2N1cnJlbnRfcmF3X1wiLCBcImdcIiksIHNlcmllcy5zdGF0cy5jdXJyZW50KTtcbiAgICAgICAgdGhpcy5kaXNwbGF5X3ZhbHVlID0gdGhpcy5kaXNwbGF5X3ZhbHVlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV9jdXJyZW50X1wiLCBcImdcIiksIGdldF9mb3JtYXR0ZWRfdmFsdWUoc2VyaWVzLnN0YXRzLmN1cnJlbnQsIHRoaXMuZGVjaW1hbHMsIHRoaXMucGF0dGVybi5mb3JtYXQpKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5X3ZhbHVlID0gdGhpcy5kaXNwbGF5X3ZhbHVlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV90b3RhbF9yYXdfXCIsIFwiZ1wiKSwgc2VyaWVzLnN0YXRzLnRvdGFsKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5X3ZhbHVlID0gdGhpcy5kaXNwbGF5X3ZhbHVlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV90b3RhbF9cIiwgXCJnXCIpLCBnZXRfZm9ybWF0dGVkX3ZhbHVlKHNlcmllcy5zdGF0cy50b3RhbCwgdGhpcy5kZWNpbWFscywgdGhpcy5wYXR0ZXJuLmZvcm1hdCkpO1xuICAgICAgICBpZiAoKHRoaXMucGF0dGVybi5kZWxpbWl0ZXIgfHwgXCJcIikudG9Mb3dlckNhc2UoKSA9PT0gXCJ0YWdcIikge1xuICAgICAgICAgICAgdGhpcy5kaXNwbGF5X3ZhbHVlID0gdGhpcy5kaXNwbGF5X3ZhbHVlLnJlcGxhY2UobmV3IFJlZ0V4cChcInt7bWV0cmljX25hbWV9fVwiLCBcImdcIiksIHRoaXMuX21ldHJpY25hbWUpO1xuICAgICAgICAgICAgdGhpcy5saW5rID0gdGhpcy5saW5rLnJlcGxhY2UobmV3IFJlZ0V4cChcInt7bWV0cmljX25hbWV9fVwiLCBcImdcIiksIHRoaXMuX21ldHJpY25hbWUpO1xuICAgICAgICAgICAgdGhpcy50b29sdGlwID0gdGhpcy50b29sdGlwLnJlcGxhY2UobmV3IFJlZ0V4cChcInt7bWV0cmljX25hbWV9fVwiLCBcImdcIiksIHRoaXMuX21ldHJpY25hbWUpO1xuICAgICAgICAgICAgdGhpcy5kaXNwbGF5X3ZhbHVlID0gcmVwbGFjZV90YWdzX2Zyb21fZmllbGQodGhpcy5kaXNwbGF5X3ZhbHVlLCB0aGlzLl90YWdzKTtcbiAgICAgICAgICAgIHRoaXMubGluayA9IHJlcGxhY2VfdGFnc19mcm9tX2ZpZWxkKHRoaXMubGluaywgdGhpcy5fdGFncyk7XG4gICAgICAgICAgICB0aGlzLnRvb2x0aXAgPSByZXBsYWNlX3RhZ3NfZnJvbV9maWVsZCh0aGlzLnRvb2x0aXAsIHRoaXMuX3RhZ3MpO1xuICAgICAgICB9XG4gICAgICAgIGxldCB2YWx1ZV9mb3JtYXR0ZWQgPSBfLmlzTmFOKHRoaXMudmFsdWUpIHx8IHRoaXMudmFsdWUgPT09IG51bGwgPyBcIm51bGxcIiA6IHRoaXMudmFsdWVfZm9ybWF0dGVkLnRvU3RyaW5nKCkudHJpbSgpO1xuICAgICAgICB0aGlzLmxpbmsgPSB0aGlzLmxpbmsucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX1wiLCBcImdcIiksIHZhbHVlX2Zvcm1hdHRlZCk7XG4gICAgICAgIHRoaXMudG9vbHRpcCA9IHRoaXMudG9vbHRpcC5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfdmFsdWVfXCIsIFwiZ1wiKSwgdmFsdWVfZm9ybWF0dGVkKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5X3ZhbHVlID0gdGhpcy5kaXNwbGF5X3ZhbHVlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV9cIiwgXCJnXCIpLCB2YWx1ZV9mb3JtYXR0ZWQpO1xuICAgICAgICB0aGlzLnJvd19uYW1lID0gcmVwbGFjZVRva2Vucyh0aGlzLnJvd19uYW1lKTtcbiAgICAgICAgdGhpcy5jb2xfbmFtZSA9IHJlcGxhY2VUb2tlbnModGhpcy5jb2xfbmFtZSk7XG4gICAgICAgIHRoaXMuZGlzcGxheV92YWx1ZSA9IHJlcGxhY2VUb2tlbnModGhpcy5kaXNwbGF5X3ZhbHVlKTtcbiAgICAgICAgdGhpcy5yb3dfbmFtZSA9IHRlbXBsYXRlU3J2LnJlcGxhY2UodGhpcy5yb3dfbmFtZSwgc2NvcGVkVmFycyk7XG4gICAgICAgIHRoaXMuY29sX25hbWUgPSB0ZW1wbGF0ZVNydi5yZXBsYWNlKHRoaXMuY29sX25hbWUsIHNjb3BlZFZhcnMpO1xuICAgICAgICB0aGlzLmRpc3BsYXlfdmFsdWUgPSB0ZW1wbGF0ZVNydi5yZXBsYWNlKHRoaXMuZGlzcGxheV92YWx1ZSwgc2NvcGVkVmFycyk7XG4gICAgICAgIHRoaXMudG9vbHRpcCA9IHRlbXBsYXRlU3J2LnJlcGxhY2UodGhpcy50b29sdGlwLCBzY29wZWRWYXJzKTtcbiAgICAgICAgdGhpcy5saW5rID0gdGVtcGxhdGVTcnYucmVwbGFjZSh0aGlzLmxpbmssIHNjb3BlZFZhcnMpO1xuICAgIH1cbn1cblxuZXhwb3J0IHtcbiAgICBCb29tU2VyaWVzXG59O1xuIl19