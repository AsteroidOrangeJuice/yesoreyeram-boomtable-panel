System.register(["lodash", "./BoomUtils"], function (exports_1, context_1) {
    "use strict";
    var lodash_1, BoomUtils_1, BoomOutput;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (lodash_1_1) {
                lodash_1 = lodash_1_1;
            },
            function (BoomUtils_1_1) {
                BoomUtils_1 = BoomUtils_1_1;
            }
        ],
        execute: function () {
            BoomOutput = (function () {
                function BoomOutput(options) {
                    this.default_title_for_rows = options.default_title_for_rows || '';
                    this.hide_first_column = options.hide_first_column;
                    this.hide_headers = options.hide_headers;
                    this.text_alignment_firstcolumn = options.text_alignment_firstcolumn || '';
                    this.text_alignment_values = options.text_alignment_values || '';
                    this.first_column_link = options.first_column_link || '#';
                }
                return BoomOutput;
            }());
            exports_1("BoomOutput", BoomOutput);
            BoomOutput.prototype.getDataAsHTML = function (data, sorting_props) {
                var _this = this;
                var getColumnAsLink = function (rowName, first_column_link, raw_rowName) {
                    if (first_column_link !== '#') {
                        first_column_link = first_column_link.replace(new RegExp('_row_name_', 'g'), BoomUtils_1.getActualNameWithoutTokens(raw_rowName).trim());
                        rowName = "<a href=\"" + first_column_link + "\" target=\"_blank\">" + rowName + "</a>";
                    }
                    return rowName;
                };
                var output = {
                    body: '',
                };
                if (sorting_props &&
                    sorting_props.col_index !== undefined &&
                    sorting_props.col_index > -1 &&
                    data &&
                    data.output &&
                    data.output.length >= sorting_props.col_index) {
                    var sortFunction_1 = function (a, b, sortMethod) {
                        if (sortMethod === 'asc') {
                            return a[sorting_props.col_index].value - b[sorting_props.col_index].value;
                        }
                        else {
                            return b[sorting_props.col_index].value - a[sorting_props.col_index].value;
                        }
                    };
                    data.output = data.output
                        .filter(function (a) { return !isNaN(a[sorting_props.col_index].value); })
                        .concat(data.output.filter(function (a) { return isNaN(a[sorting_props.col_index].value); }))
                        .sort(function (a, b) { return sortFunction_1(a, b, sorting_props.direction); });
                }
                lodash_1.default.each(data.output, function (o) {
                    if (o.map(function (item) { return item.hidden.toString(); }).indexOf('false') > -1) {
                        output.body += '<tr>';
                        if (_this.hide_first_column !== true) {
                            var raw_rowName = lodash_1.default.first(o.map(function (item) { return item.row_name_raw; }));
                            output.body += "\n                    <td style=\"padding:4px;text-align:" + _this.text_alignment_firstcolumn + "\">\n                        " + getColumnAsLink(lodash_1.default.first(o.map(function (item) { return item.row_name; })), String(_this.first_column_link), raw_rowName) + "\n                    </td>";
                        }
                        lodash_1.default.each(o, function (item) {
                            var item_style = "padding:4px;background-color:" + item.color_bg + ";color:" + item.color_text + ";text-align:" + _this.text_alignment_values;
                            var item_display = item.link === '#'
                                ? item.display_value
                                : "<a href=\"" + item.link + "\" target=\"_blank\" style=\"color:" + item.color_text + "\">" + item.display_value + "</a>";
                            var tooltip = !item.tooltip || item.tooltip === '-'
                                ? undefined
                                : " data-toggle=\"tooltip\" data-html=\"true\" data-placement=\"auto\" title=\"" + item.tooltip + "\" ";
                            output.body += "\n                    <td style=\"" + item_style + "\">\n                        " + (tooltip ? "<span " + tooltip + ">" : '') + "\n                            " + item_display + "\n                        " + (tooltip ? "</span>" : '') + "\n                    </td>\n                ";
                        });
                        output.body += '</tr>';
                    }
                });
                return output;
            };
            BoomOutput.prototype.getDataAsDebugHTML = function (data) {
                var debugData = "";
                debugData = lodash_1.default.map(data, function (d) {
                    return "\n        <tr>\n            <td style=\"padding:4px;text-align:left;width:30%; title=\"Series Name\" >" + d.seriesName + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Matching Pattern Name\" >" + (d.pattern.name || d.pattern.pattern || 'Default') + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Value : " + String(d.value_formatted || 'null') + " / Raw : " + String(d.value || 'null') + " / Stat : " + d.pattern.valueName + "\">" + d.display_value + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Row name\" >" + d.row_name + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Col name\" >" + d.col_name + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Thresholds\" >" + d.thresholds.join(',') + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"BG Color\" >" + d.color_bg + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Text Color\" >" + d.color_text + "</td>\n        </tr>\n        ";
                }).join("");
                return debugData;
            };
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQm9vbU91dHB1dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcHAvYm9vbS9Cb29tT3V0cHV0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O1lBSUE7Z0JBU0Usb0JBQVksT0FBOEI7b0JBQ3hDLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxPQUFPLENBQUMsc0JBQXNCLElBQUksRUFBRSxDQUFDO29CQUNuRSxJQUFJLENBQUMsaUJBQWlCLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDO29CQUNuRCxJQUFJLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUM7b0JBQ3pDLElBQUksQ0FBQywwQkFBMEIsR0FBRyxPQUFPLENBQUMsMEJBQTBCLElBQUksRUFBRSxDQUFDO29CQUMzRSxJQUFJLENBQUMscUJBQXFCLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixJQUFJLEVBQUUsQ0FBQztvQkFDakUsSUFBSSxDQUFDLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsSUFBSSxHQUFHLENBQUM7Z0JBQzVELENBQUM7Z0JBQ0gsaUJBQUM7WUFBRCxDQUFDLEFBakJELElBaUJDOztZQUNELFVBQVUsQ0FBQyxTQUFTLENBQUMsYUFBYSxHQUFHLFVBQVMsSUFBZ0IsRUFBRSxhQUFhO2dCQUF4QyxpQkErRHBDO2dCQTlEQyxJQUFJLGVBQWUsR0FBRyxVQUFTLE9BQWUsRUFBRSxpQkFBeUIsRUFBRSxXQUFtQjtvQkFDNUYsSUFBSSxpQkFBaUIsS0FBSyxHQUFHLEVBQUU7d0JBQzdCLGlCQUFpQixHQUFHLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxZQUFZLEVBQUUsR0FBRyxDQUFDLEVBQUUsc0NBQTBCLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQzt3QkFDN0gsT0FBTyxHQUFHLGVBQVksaUJBQWlCLDZCQUFxQixPQUFPLFNBQU0sQ0FBQztxQkFDM0U7b0JB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QzlILENBQUMsQ0FBQyxLQUFLLElBQUksTUFBTSxDQUNsQixrQkFBYSxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsV0FBSyxDQUFDLENBQUMsYUFBYSxrR0FDeUIsQ0FBQyxDQUFDLFFBQVEsa0dBQ1YsQ0FBQyxDQUFDLFFBQVEsb0dBQ1IsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLGtHQUN4QixDQUFDLENBQUMsUUFBUSxvR0FDUixDQUFDLENBQUMsVUFBVSxtQ0FFdkYsQ0FBQztnQkFDUixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ1osT0FBTyxTQUFTLENBQUM7WUFDbkIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IElCb29tSFRNTCwgSUJvb21UYWJsZSwgSUJvb21SZW5kZXJpbmdPcHRpb25zLCBJQm9vbVNlcmllcyB9IGZyb20gJy4vaW5kZXgnO1xuaW1wb3J0IHsgZ2V0QWN0dWFsTmFtZVdpdGhvdXRUb2tlbnMgfSBmcm9tICcuL0Jvb21VdGlscyc7XG5cbmV4cG9ydCBjbGFzcyBCb29tT3V0cHV0IHtcbiAgcHVibGljIGRlZmF1bHRfdGl0bGVfZm9yX3Jvd3M6IFN0cmluZztcbiAgcHVibGljIGhpZGVfZmlyc3RfY29sdW1uOiBCb29sZWFuO1xuICBwdWJsaWMgaGlkZV9oZWFkZXJzOiBCb29sZWFuO1xuICBwdWJsaWMgdGV4dF9hbGlnbm1lbnRfZmlyc3Rjb2x1bW46IFN0cmluZztcbiAgcHVibGljIHRleHRfYWxpZ25tZW50X3ZhbHVlczogU3RyaW5nO1xuICBwdWJsaWMgZmlyc3RfY29sdW1uX2xpbms6IFN0cmluZztcbiAgcHVibGljIGdldERhdGFBc0hUTUw7XG4gIHB1YmxpYyBnZXREYXRhQXNEZWJ1Z0hUTUw7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IElCb29tUmVuZGVyaW5nT3B0aW9ucykge1xuICAgIHRoaXMuZGVmYXVsdF90aXRsZV9mb3Jfcm93cyA9IG9wdGlvbnMuZGVmYXVsdF90aXRsZV9mb3Jfcm93cyB8fCAnJztcbiAgICB0aGlzLmhpZGVfZmlyc3RfY29sdW1uID0gb3B0aW9ucy5oaWRlX2ZpcnN0X2NvbHVtbjtcbiAgICB0aGlzLmhpZGVfaGVhZGVycyA9IG9wdGlvbnMuaGlkZV9oZWFkZXJzO1xuICAgIHRoaXMudGV4dF9hbGlnbm1lbnRfZmlyc3Rjb2x1bW4gPSBvcHRpb25zLnRleHRfYWxpZ25tZW50X2ZpcnN0Y29sdW1uIHx8ICcnO1xuICAgIHRoaXMudGV4dF9hbGlnbm1lbnRfdmFsdWVzID0gb3B0aW9ucy50ZXh0X2FsaWdubWVudF92YWx1ZXMgfHwgJyc7XG4gICAgdGhpcy5maXJzdF9jb2x1bW5fbGluayA9IG9wdGlvbnMuZmlyc3RfY29sdW1uX2xpbmsgfHwgJyMnO1xuICB9XG59XG5Cb29tT3V0cHV0LnByb3RvdHlwZS5nZXREYXRhQXNIVE1MID0gZnVuY3Rpb24oZGF0YTogSUJvb21UYWJsZSwgc29ydGluZ19wcm9wcyk6IElCb29tSFRNTCB7XG4gIGxldCBnZXRDb2x1bW5Bc0xpbmsgPSBmdW5jdGlvbihyb3dOYW1lOiBzdHJpbmcsIGZpcnN0X2NvbHVtbl9saW5rOiBzdHJpbmcsIHJhd19yb3dOYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmIChmaXJzdF9jb2x1bW5fbGluayAhPT0gJyMnKSB7XG4gICAgICBmaXJzdF9jb2x1bW5fbGluayA9IGZpcnN0X2NvbHVtbl9saW5rLnJlcGxhY2UobmV3IFJlZ0V4cCgnX3Jvd19uYW1lXycsICdnJyksIGdldEFjdHVhbE5hbWVXaXRob3V0VG9rZW5zKHJhd19yb3dOYW1lKS50cmltKCkpO1xuICAgICAgcm93TmFtZSA9IGA8YSBocmVmPVwiJHtmaXJzdF9jb2x1bW5fbGlua31cIiB0YXJnZXQ9XCJfYmxhbmtcIj4ke3Jvd05hbWV9PC9hPmA7XG4gICAgfVxuICAgIHJldHVybiByb3dOYW1lO1xuICB9O1xuICBsZXQgb3V0cHV0OiBJQm9vbUhUTUwgPSB7XG4gICAgYm9keTogJycsXG4gIH07XG4gIGlmIChcbiAgICBzb3J0aW5nX3Byb3BzICYmXG4gICAgc29ydGluZ19wcm9wcy5jb2xfaW5kZXggIT09IHVuZGVmaW5lZCAmJlxuICAgIHNvcnRpbmdfcHJvcHMuY29sX2luZGV4ID4gLTEgJiZcbiAgICBkYXRhICYmXG4gICAgZGF0YS5vdXRwdXQgJiZcbiAgICBkYXRhLm91dHB1dC5sZW5ndGggPj0gc29ydGluZ19wcm9wcy5jb2xfaW5kZXhcbiAgKSB7XG4gICAgbGV0IHNvcnRGdW5jdGlvbiA9IChhLCBiLCBzb3J0TWV0aG9kKSA9PiB7XG4gICAgICBpZiAoc29ydE1ldGhvZCA9PT0gJ2FzYycpIHtcbiAgICAgICAgcmV0dXJuIGFbc29ydGluZ19wcm9wcy5jb2xfaW5kZXhdLnZhbHVlIC0gYltzb3J0aW5nX3Byb3BzLmNvbF9pbmRleF0udmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYltzb3J0aW5nX3Byb3BzLmNvbF9pbmRleF0udmFsdWUgLSBhW3NvcnRpbmdfcHJvcHMuY29sX2luZGV4XS52YWx1ZTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGRhdGEub3V0cHV0ID0gZGF0YS5vdXRwdXRcbiAgICAgIC5maWx0ZXIoYSA9PiAhaXNOYU4oYVtzb3J0aW5nX3Byb3BzLmNvbF9pbmRleF0udmFsdWUpKVxuICAgICAgLmNvbmNhdChkYXRhLm91dHB1dC5maWx0ZXIoYSA9PiBpc05hTihhW3NvcnRpbmdfcHJvcHMuY29sX2luZGV4XS52YWx1ZSkpKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IHNvcnRGdW5jdGlvbihhLCBiLCBzb3J0aW5nX3Byb3BzLmRpcmVjdGlvbikpO1xuICB9XG4gIF8uZWFjaChkYXRhLm91dHB1dCwgbyA9PiB7XG4gICAgaWYgKG8ubWFwKGl0ZW0gPT4gaXRlbS5oaWRkZW4udG9TdHJpbmcoKSkuaW5kZXhPZignZmFsc2UnKSA+IC0xKSB7XG4gICAgICBvdXRwdXQuYm9keSArPSAnPHRyPic7XG4gICAgICBpZiAodGhpcy5oaWRlX2ZpcnN0X2NvbHVtbiAhPT0gdHJ1ZSkge1xuICAgICAgICBsZXQgcmF3X3Jvd05hbWUgPSBfLmZpcnN0KG8ubWFwKGl0ZW0gPT4gaXRlbS5yb3dfbmFtZV9yYXcpKTtcbiAgICAgICAgb3V0cHV0LmJvZHkgKz0gYFxuICAgICAgICAgICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOiR7dGhpcy50ZXh0X2FsaWdubWVudF9maXJzdGNvbHVtbn1cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICR7Z2V0Q29sdW1uQXNMaW5rKF8uZmlyc3Qoby5tYXAoaXRlbSA9PiBpdGVtLnJvd19uYW1lKSksIFN0cmluZyh0aGlzLmZpcnN0X2NvbHVtbl9saW5rKSwgcmF3X3Jvd05hbWUpfVxuICAgICAgICAgICAgICAgICAgICA8L3RkPmA7XG4gICAgICB9XG4gICAgICBfLmVhY2gobywgaXRlbSA9PiB7XG4gICAgICAgIGxldCBpdGVtX3N0eWxlID0gYHBhZGRpbmc6NHB4O2JhY2tncm91bmQtY29sb3I6JHtpdGVtLmNvbG9yX2JnfTtjb2xvcjoke2l0ZW0uY29sb3JfdGV4dH07dGV4dC1hbGlnbjoke3RoaXMudGV4dF9hbGlnbm1lbnRfdmFsdWVzfWA7XG4gICAgICAgIGxldCBpdGVtX2Rpc3BsYXkgPVxuICAgICAgICAgIGl0ZW0ubGluayA9PT0gJyMnXG4gICAgICAgICAgICA/IGl0ZW0uZGlzcGxheV92YWx1ZVxuICAgICAgICAgICAgOiBgPGEgaHJlZj1cIiR7aXRlbS5saW5rfVwiIHRhcmdldD1cIl9ibGFua1wiIHN0eWxlPVwiY29sb3I6JHtpdGVtLmNvbG9yX3RleHR9XCI+JHtpdGVtLmRpc3BsYXlfdmFsdWV9PC9hPmA7XG4gICAgICAgIGxldCB0b29sdGlwID1cbiAgICAgICAgICAhaXRlbS50b29sdGlwIHx8IGl0ZW0udG9vbHRpcCA9PT0gJy0nXG4gICAgICAgICAgICA/IHVuZGVmaW5lZFxuICAgICAgICAgICAgOiBgIGRhdGEtdG9nZ2xlPVwidG9vbHRpcFwiIGRhdGEtaHRtbD1cInRydWVcIiBkYXRhLXBsYWNlbWVudD1cImF1dG9cIiB0aXRsZT1cIiR7aXRlbS50b29sdGlwfVwiIGA7XG4gICAgICAgIG91dHB1dC5ib2R5ICs9IGBcbiAgICAgICAgICAgICAgICAgICAgPHRkIHN0eWxlPVwiJHtpdGVtX3N0eWxlfVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgJHt0b29sdGlwID8gYDxzcGFuICR7dG9vbHRpcH0+YCA6ICcnfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7aXRlbV9kaXNwbGF5fVxuICAgICAgICAgICAgICAgICAgICAgICAgJHt0b29sdGlwID8gYDwvc3Bhbj5gIDogJyd9XG4gICAgICAgICAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgICAgICAgYDtcbiAgICAgIH0pO1xuICAgICAgb3V0cHV0LmJvZHkgKz0gJzwvdHI+JztcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gb3V0cHV0O1xufTtcbkJvb21PdXRwdXQucHJvdG90eXBlLmdldERhdGFBc0RlYnVnSFRNTCA9IGZ1bmN0aW9uKGRhdGE6IElCb29tU2VyaWVzW10pOiBzdHJpbmcge1xuICBsZXQgZGVidWdEYXRhID0gYGA7XG4gIGRlYnVnRGF0YSA9IF8ubWFwKGRhdGEsIGQgPT4ge1xuICAgIHJldHVybiBgXG4gICAgICAgIDx0cj5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246bGVmdDt3aWR0aDozMCU7IHRpdGxlPVwiU2VyaWVzIE5hbWVcIiA+JHtkLnNlcmllc05hbWV9PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246bGVmdDt3aWR0aDoxMCU7IHRpdGxlPVwiTWF0Y2hpbmcgUGF0dGVybiBOYW1lXCIgPiR7ZC5wYXR0ZXJuLm5hbWUgfHwgZC5wYXR0ZXJuLnBhdHRlcm4gfHwgJ0RlZmF1bHQnfTwvdGQ+XG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOmxlZnQ7d2lkdGg6MTAlOyB0aXRsZT1cIlZhbHVlIDogJHtTdHJpbmcoZC52YWx1ZV9mb3JtYXR0ZWQgfHwgJ251bGwnKX0gLyBSYXcgOiAke1N0cmluZyhcbiAgICAgIGQudmFsdWUgfHwgJ251bGwnXG4gICAgKX0gLyBTdGF0IDogJHtkLnBhdHRlcm4udmFsdWVOYW1lfVwiPiR7ZC5kaXNwbGF5X3ZhbHVlfTwvdGQ+XG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOmxlZnQ7d2lkdGg6MTAlOyB0aXRsZT1cIlJvdyBuYW1lXCIgPiR7ZC5yb3dfbmFtZX08L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjEwJTsgdGl0bGU9XCJDb2wgbmFtZVwiID4ke2QuY29sX25hbWV9PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246bGVmdDt3aWR0aDoxMCU7IHRpdGxlPVwiVGhyZXNob2xkc1wiID4ke2QudGhyZXNob2xkcy5qb2luKCcsJyl9PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246bGVmdDt3aWR0aDoxMCU7IHRpdGxlPVwiQkcgQ29sb3JcIiA+JHtkLmNvbG9yX2JnfTwvdGQ+XG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOmxlZnQ7d2lkdGg6MTAlOyB0aXRsZT1cIlRleHQgQ29sb3JcIiA+JHtkLmNvbG9yX3RleHR9PC90ZD5cbiAgICAgICAgPC90cj5cbiAgICAgICAgYDtcbiAgfSkuam9pbihgYCk7XG4gIHJldHVybiBkZWJ1Z0RhdGE7XG59O1xuIl19