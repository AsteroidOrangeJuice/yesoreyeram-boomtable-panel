System.register(["lodash", "./index", "./../GrafanaUtils"], function (exports_1, context_1) {
    "use strict";
    var lodash_1, index_1, GrafanaUtils_1, getDisplayValueTemplate, getBGColor, getTextColor, getThresholds, getSeriesValue, getLink, getCurrentTimeStamp, doesValueNeedsToHide, replaceDelimitedColumns, getRowName, getColName, GetValuesReplaced;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (lodash_1_1) {
                lodash_1 = lodash_1_1;
            },
            function (index_1_1) {
                index_1 = index_1_1;
            },
            function (GrafanaUtils_1_1) {
                GrafanaUtils_1 = GrafanaUtils_1_1;
            }
        ],
        execute: function () {
            exports_1("getDisplayValueTemplate", getDisplayValueTemplate = function (value, pattern, seriesName, row_col_wrapper, thresholds) {
                var template = "_value_";
                if (lodash_1.default.isNaN(value) || value === null) {
                    template = pattern.null_value || "No data";
                    if (pattern.null_value === "") {
                        template = "";
                    }
                }
                else {
                    template = pattern.displayTemplate || template;
                    if (pattern.enable_transform) {
                        var transform_values = pattern.transform_values.split("|");
                        template = index_1.getItemBasedOnThreshold(thresholds, transform_values, value, template);
                    }
                    if (pattern.enable_transform_overrides && pattern.transform_values_overrides !== "") {
                        var _transform_values_overrides = pattern.transform_values_overrides
                            .split("|")
                            .filter(function (con) { return con.indexOf("->"); })
                            .map(function (con) { return con.split("->"); })
                            .filter(function (con) { return +(con[0]) === value; })
                            .map(function (con) { return con[1]; });
                        if (_transform_values_overrides.length > 0 && _transform_values_overrides[0] !== "") {
                            template = ("" + _transform_values_overrides[0]).trim();
                        }
                    }
                    if (pattern.enable_transform || pattern.enable_transform_overrides) {
                        template = replaceDelimitedColumns(template, seriesName, pattern.delimiter, row_col_wrapper);
                    }
                }
                return template;
            });
            exports_1("getBGColor", getBGColor = function (value, pattern, thresholds, list_of_bgColors_based_on_thresholds, bgColorOverRides) {
                var bgColor = "transparent";
                if (lodash_1.default.isNaN(value) || value === null) {
                    bgColor = pattern.null_color || "darkred";
                    if (pattern.null_color === "") {
                        bgColor = "transparent";
                    }
                }
                else {
                    bgColor = pattern.defaultBGColor || bgColor;
                    if (pattern.enable_bgColor && pattern.bgColors) {
                        bgColor = index_1.getItemBasedOnThreshold(thresholds, list_of_bgColors_based_on_thresholds, value, bgColor);
                    }
                    if (pattern.enable_bgColor_overrides && pattern.bgColors_overrides !== "") {
                        var _bgColors_overrides = bgColorOverRides.filter(function (con) { return con.indexOf("->"); }).map(function (con) { return con.split("->"); }).filter(function (con) { return +(con[0]) === value; }).map(function (con) { return con[1]; });
                        if (_bgColors_overrides.length > 0 && _bgColors_overrides[0] !== "") {
                            bgColor = ("" + _bgColors_overrides[0]).trim();
                        }
                    }
                }
                return index_1.normalizeColor(bgColor);
            });
            exports_1("getTextColor", getTextColor = function (value, pattern, thresholds, list_of_textColors_based_on_thresholds, txtColorOverrides) {
                var textColor = document.body.classList.contains("theme-light") ? "black" : "white";
                if (lodash_1.default.isNaN(value) || value === null) {
                    textColor = pattern.null_textcolor || textColor;
                }
                else {
                    textColor = pattern.defaultTextColor || textColor;
                    if (pattern.enable_textColor && pattern.textColors) {
                        textColor = index_1.getItemBasedOnThreshold(thresholds, list_of_textColors_based_on_thresholds, value, textColor);
                    }
                    if (pattern.enable_textColor_overrides && pattern.textColors_overrides !== "") {
                        var _textColors_overrides = txtColorOverrides.filter(function (con) { return con.indexOf("->"); }).map(function (con) { return con.split("->"); }).filter(function (con) { return +(con[0]) === value; }).map(function (con) { return con[1]; });
                        if (_textColors_overrides.length > 0 && _textColors_overrides[0] !== "") {
                            textColor = ("" + _textColors_overrides[0]).trim();
                        }
                    }
                }
                return index_1.normalizeColor(textColor);
            });
            exports_1("getThresholds", getThresholds = function (thresholdsArray, enable_time_based_thresholds, time_based_thresholds, currentTimeStamp) {
                if (enable_time_based_thresholds) {
                    var metricrecivedTimeStamp_1 = currentTimeStamp || new Date();
                    var metricrecivedTimeStamp_innumber_1 = metricrecivedTimeStamp_1.getHours() * 100 + metricrecivedTimeStamp_1.getMinutes();
                    var weekdays_1 = ["sun", "mon", "tue", "wed", "thu", "fri", "sat"];
                    lodash_1.default.each(time_based_thresholds, function (tbtx) {
                        if (tbtx && tbtx.from && tbtx.to && tbtx.enabledDays &&
                            (metricrecivedTimeStamp_innumber_1 >= +(tbtx.from)) &&
                            (metricrecivedTimeStamp_innumber_1 <= +(tbtx.to)) &&
                            (tbtx.enabledDays.toLowerCase().indexOf(weekdays_1[metricrecivedTimeStamp_1.getDay()]) > -1) &&
                            tbtx.threshold) {
                            thresholdsArray = (tbtx.threshold + "").split(",").map(function (d) { return +d; });
                        }
                    });
                }
                return thresholdsArray || [];
            });
            exports_1("getSeriesValue", getSeriesValue = function (series, statType) {
                var value = NaN;
                if (statType === "last_time") {
                    if (lodash_1.default.last(series.datapoints)) {
                        value = lodash_1.default.last(series.datapoints)[1];
                    }
                }
                else if (statType === "last_time_nonnull") {
                    var non_null_data = series.datapoints.filter(function (s) { return s[0]; });
                    if (lodash_1.default.last(non_null_data) && lodash_1.default.last(non_null_data)[1]) {
                        value = lodash_1.default.last(non_null_data)[1];
                    }
                }
                else if (series.stats) {
                    value = series.stats[statType] || null;
                }
                return value;
            });
            exports_1("getLink", getLink = function (enable_clickable_cells, clickable_cells_link, range) {
                var link = enable_clickable_cells ? clickable_cells_link || "#" : "#";
                if (link && link !== "#") {
                    link += (link.indexOf("?") > -1 ? "&from=" + range.from : "?from=" + range.from);
                    link += "&to=" + range.to;
                }
                return link;
            });
            exports_1("getCurrentTimeStamp", getCurrentTimeStamp = function (dataPoints) {
                var currentTimeStamp = new Date();
                if (dataPoints && dataPoints.length > 0 && lodash_1.default.last(dataPoints).length === 2) {
                    currentTimeStamp = new Date(lodash_1.default.last(dataPoints)[1]);
                }
                return currentTimeStamp;
            });
            exports_1("doesValueNeedsToHide", doesValueNeedsToHide = function (value, filter) {
                var hidden = false;
                if (value && filter && (filter.value_below !== "" || filter.value_above !== "")) {
                    if (filter.value_below !== "" && value < +(filter.value_below)) {
                        hidden = true;
                    }
                    if (filter.value_above !== "" && value > +(filter.value_above)) {
                        hidden = true;
                    }
                }
                return hidden;
            });
            exports_1("replaceDelimitedColumns", replaceDelimitedColumns = function (inputstring, seriesName, delimiter, row_col_wrapper) {
                var outputString = seriesName
                    .split(delimiter || ".")
                    .reduce(function (r, it, i) {
                    return r.replace(new RegExp(row_col_wrapper + i + row_col_wrapper, "g"), it);
                }, inputstring);
                return outputString;
            });
            exports_1("getRowName", getRowName = function (row_name, delimiter, row_col_wrapper, seriesName, _metricname, _tags) {
                if (delimiter.toLowerCase() === "tag") {
                    row_name = row_name.replace(new RegExp("{{metric_name}}", "g"), _metricname);
                    row_name = index_1.replace_tags_from_field(row_name, _tags);
                }
                else {
                    row_name = replaceDelimitedColumns(row_name, seriesName, delimiter, row_col_wrapper);
                    if (seriesName.split(delimiter || ".").length === 1) {
                        row_name = seriesName;
                    }
                }
                return row_name.replace(new RegExp("_series_", "g"), seriesName.toString());
            });
            exports_1("getColName", getColName = function (col_name, delimiter, row_col_wrapper, seriesName, row_name, _metricname, _tags) {
                if (delimiter.toLowerCase() === "tag") {
                    col_name = col_name.replace(new RegExp("{{metric_name}}", "g"), _metricname);
                    row_name = index_1.replace_tags_from_field(col_name, _tags);
                }
                else {
                    col_name = replaceDelimitedColumns(col_name, seriesName, delimiter, row_col_wrapper);
                    if (seriesName.split(delimiter || ".").length === 1 || row_name === seriesName) {
                        col_name = col_name || "Value";
                    }
                }
                return col_name.replace(new RegExp("_series_", "g"), seriesName.toString());
            });
            exports_1("GetValuesReplaced", GetValuesReplaced = function (strToReplace, value, valueformatted, stats, decimals, format, _metricname, _tags, delimiter) {
                var value_raw = lodash_1.default.isNaN(value) || value === null ? "null" : value.toString().trim();
                var value_formatted = lodash_1.default.isNaN(value) || value === null ? "null" : valueformatted.toString().trim();
                strToReplace = strToReplace.replace(new RegExp("_value_min_raw_", "g"), stats.min);
                strToReplace = strToReplace.replace(new RegExp("_value_max_raw_", "g"), stats.max);
                strToReplace = strToReplace.replace(new RegExp("_value_avg_raw_", "g"), stats.avg);
                strToReplace = strToReplace.replace(new RegExp("_value_current_raw_", "g"), stats.current);
                strToReplace = strToReplace.replace(new RegExp("_value_total_raw_", "g"), stats.total);
                strToReplace = strToReplace.replace(new RegExp("_value_raw_", "g"), value_raw);
                strToReplace = strToReplace.replace(new RegExp("_value_min_", "g"), GrafanaUtils_1.get_formatted_value(stats.min, decimals, format));
                strToReplace = strToReplace.replace(new RegExp("_value_max_", "g"), GrafanaUtils_1.get_formatted_value(stats.max, decimals, format));
                strToReplace = strToReplace.replace(new RegExp("_value_avg_", "g"), GrafanaUtils_1.get_formatted_value(stats.avg, decimals, format));
                strToReplace = strToReplace.replace(new RegExp("_value_current_", "g"), GrafanaUtils_1.get_formatted_value(stats.current, decimals, format));
                strToReplace = strToReplace.replace(new RegExp("_value_total_", "g"), GrafanaUtils_1.get_formatted_value(stats.total, decimals, format));
                strToReplace = strToReplace.replace(new RegExp("_value_", "g"), value_formatted);
                if (delimiter.toLowerCase() === "tag") {
                    strToReplace = strToReplace.replace(new RegExp("{{metric_name}}", "g"), _metricname);
                    strToReplace = index_1.replace_tags_from_field(strToReplace, _tags);
                }
                return strToReplace;
            });
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQm9vbVNlcmllc1V0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2FwcC9ib29tL0Jvb21TZXJpZXNVdGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztZQU1BLHFDQUFXLHVCQUF1QixHQUFHLFVBQVUsS0FBYSxFQUFFLE9BQXFCLEVBQUUsVUFBa0IsRUFBRSxlQUF1QixFQUFFLFVBQWlCO2dCQUMvSSxJQUFJLFFBQVEsR0FBRyxTQUFTLENBQUM7Z0JBQ3pCLElBQUksZ0JBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxLQUFLLElBQUksRUFBRTtvQkFDbEMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxVQUFVLElBQUksU0FBUyxDQUFDO29CQUMzQyxJQUFJLE9BQU8sQ0FBQyxVQUFVLEtBQUssRUFBRSxFQUFFO3dCQUMzQixRQUFRLEdBQUcsRUFBRSxDQUFDO3FCQUNqQjtpQkFDSjtxQkFBTTtvQkFDSCxRQUFRLEdBQUcsT0FBTyxDQUFDLGVBQWUsSUFBSSxRQUFRLENBQUM7b0JBQy9DLElBQUksT0FBTyxDQUFDLGdCQUFnQixFQUFFO3dCQUMxQixJQUFJLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7d0JBQzNELFFBQVEsR0FBRywrQkFBdUIsQ0FBQyxVQUFVLEVBQUUsZ0JBQWdCLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO3FCQUNyRjtvQkFDRCxJQUFJLE9BQU8sQ0FBQywwQkFBMEIsSUFBSSxPQUFPLENBQUMsMEJBQTBCLEtBQUssRUFBRSxFQUFFO3dCQUNqRixJQUFJLDJCQUEyQixHQUFHLE9BQU8sQ0FBQywwQkFBMEI7NkJBQy9ELEtBQUssQ0FBQyxHQUFHLENBQUM7NkJBQ1YsTUFBTSxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFB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Q0FBQztnQkFDOUgsWUFBWSxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxNQUFNLENBQUMsZUFBZSxFQUFFLEdBQUcsQ0FBQyxFQUFFLGtDQUFtQixDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQzFILFlBQVksR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLFNBQVMsRUFBRSxHQUFHLENBQUMsRUFBRSxlQUFlLENBQUMsQ0FBQztnQkFFakYsSUFBSSxTQUFTLENBQUMsV0FBVyxFQUFFLEtBQUssS0FBSyxFQUFFO29CQUNuQyxZQUFZLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQztvQkFDckYsWUFBWSxHQUFHLCtCQUF1QixDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQztpQkFDL0Q7Z0JBRUQsT0FBTyxZQUFZLENBQUM7WUFDeEIsQ0FBQyxFQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSBcImxvZGFzaFwiO1xyXG5cclxuaW1wb3J0IHsgZ2V0SXRlbUJhc2VkT25UaHJlc2hvbGQsIG5vcm1hbGl6ZUNvbG9yLCByZXBsYWNlX3RhZ3NfZnJvbV9maWVsZCB9IGZyb20gXCIuL2luZGV4XCI7XHJcbmltcG9ydCB7IGdldF9mb3JtYXR0ZWRfdmFsdWUgfSBmcm9tIFwiLi8uLi9HcmFmYW5hVXRpbHNcIjtcclxuaW1wb3J0IHsgSUJvb21QYXR0ZXJuIH0gZnJvbSBcIi4vQm9vbS5pbnRlcmZhY2VcIjtcclxuXHJcbmV4cG9ydCBsZXQgZ2V0RGlzcGxheVZhbHVlVGVtcGxhdGUgPSBmdW5jdGlvbiAodmFsdWU6IG51bWJlciwgcGF0dGVybjogSUJvb21QYXR0ZXJuLCBzZXJpZXNOYW1lOiBzdHJpbmcsIHJvd19jb2xfd3JhcHBlcjogc3RyaW5nLCB0aHJlc2hvbGRzOiBhbnlbXSk6IHN0cmluZyB7XHJcbiAgICBsZXQgdGVtcGxhdGUgPSBcIl92YWx1ZV9cIjtcclxuICAgIGlmIChfLmlzTmFOKHZhbHVlKSB8fCB2YWx1ZSA9PT0gbnVsbCkge1xyXG4gICAgICAgIHRlbXBsYXRlID0gcGF0dGVybi5udWxsX3ZhbHVlIHx8IFwiTm8gZGF0YVwiO1xyXG4gICAgICAgIGlmIChwYXR0ZXJuLm51bGxfdmFsdWUgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgdGVtcGxhdGUgPSBcIlwiO1xyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGVtcGxhdGUgPSBwYXR0ZXJuLmRpc3BsYXlUZW1wbGF0ZSB8fCB0ZW1wbGF0ZTtcclxuICAgICAgICBpZiAocGF0dGVybi5lbmFibGVfdHJhbnNmb3JtKSB7XHJcbiAgICAgICAgICAgIGxldCB0cmFuc2Zvcm1fdmFsdWVzID0gcGF0dGVybi50cmFuc2Zvcm1fdmFsdWVzLnNwbGl0KFwifFwiKTtcclxuICAgICAgICAgICAgdGVtcGxhdGUgPSBnZXRJdGVtQmFzZWRPblRocmVzaG9sZCh0aHJlc2hvbGRzLCB0cmFuc2Zvcm1fdmFsdWVzLCB2YWx1ZSwgdGVtcGxhdGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocGF0dGVybi5lbmFibGVfdHJhbnNmb3JtX292ZXJyaWRlcyAmJiBwYXR0ZXJuLnRyYW5zZm9ybV92YWx1ZXNfb3ZlcnJpZGVzICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIGxldCBfdHJhbnNmb3JtX3ZhbHVlc19vdmVycmlkZXMgPSBwYXR0ZXJuLnRyYW5zZm9ybV92YWx1ZXNfb3ZlcnJpZGVzXHJcbiAgICAgICAgICAgICAgICAuc3BsaXQoXCJ8XCIpXHJcbiAgICAgICAgICAgICAgICAuZmlsdGVyKGNvbiA9PiBjb24uaW5kZXhPZihcIi0+XCIpKVxyXG4gICAgICAgICAgICAgICAgLm1hcChjb24gPT4gY29uLnNwbGl0KFwiLT5cIikpXHJcbiAgICAgICAgICAgICAgICAuZmlsdGVyKGNvbiA9PiArKGNvblswXSkgPT09IHZhbHVlKVxyXG4gICAgICAgICAgICAgICAgLm1hcChjb24gPT4gY29uWzFdKTtcclxuICAgICAgICAgICAgaWYgKF90cmFuc2Zvcm1fdmFsdWVzX292ZXJyaWRlcy5sZW5ndGggPiAwICYmIF90cmFuc2Zvcm1fdmFsdWVzX292ZXJyaWRlc1swXSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGUgPSAoXCJcIiArIF90cmFuc2Zvcm1fdmFsdWVzX292ZXJyaWRlc1swXSkudHJpbSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwYXR0ZXJuLmVuYWJsZV90cmFuc2Zvcm0gfHwgcGF0dGVybi5lbmFibGVfdHJhbnNmb3JtX292ZXJyaWRlcykge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZSA9IHJlcGxhY2VEZWxpbWl0ZWRDb2x1bW5zKHRlbXBsYXRlLCBzZXJpZXNOYW1lLCBwYXR0ZXJuLmRlbGltaXRlciwgcm93X2NvbF93cmFwcGVyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGVtcGxhdGU7XHJcbn07XHJcbmV4cG9ydCBsZXQgZ2V0QkdDb2xvciA9IGZ1bmN0aW9uICh2YWx1ZTogbnVtYmVyLCBwYXR0ZXJuOiBJQm9vbVBhdHRlcm4sIHRocmVzaG9sZHM6IGFueVtdLCBsaXN0X29mX2JnQ29sb3JzX2Jhc2VkX29uX3RocmVzaG9sZHM6IHN0cmluZ1tdLCBiZ0NvbG9yT3ZlclJpZGVzOiBzdHJpbmdbXSk6IHN0cmluZyB7XHJcbiAgICBsZXQgYmdDb2xvciA9IFwidHJhbnNwYXJlbnRcIjtcclxuICAgIGlmIChfLmlzTmFOKHZhbHVlKSB8fCB2YWx1ZSA9PT0gbnVsbCkge1xyXG4gICAgICAgIGJnQ29sb3IgPSBwYXR0ZXJuLm51bGxfY29sb3IgfHwgXCJkYXJrcmVkXCI7XHJcbiAgICAgICAgaWYgKHBhdHRlcm4ubnVsbF9jb2xvciA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICBiZ0NvbG9yID0gXCJ0cmFuc3BhcmVudFwiO1xyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYmdDb2xvciA9IHBhdHRlcm4uZGVmYXVsdEJHQ29sb3IgfHwgYmdDb2xvcjtcclxuICAgICAgICBpZiAocGF0dGVybi5lbmFibGVfYmdDb2xvciAmJiBwYXR0ZXJuLmJnQ29sb3JzKSB7XHJcbiAgICAgICAgICAgIGJnQ29sb3IgPSBnZXRJdGVtQmFzZWRPblRocmVzaG9sZCh0aHJlc2hvbGRzLCBsaXN0X29mX2JnQ29sb3JzX2Jhc2VkX29uX3RocmVzaG9sZHMsIHZhbHVlLCBiZ0NvbG9yKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwYXR0ZXJuLmVuYWJsZV9iZ0NvbG9yX292ZXJyaWRlcyAmJiBwYXR0ZXJuLmJnQ29sb3JzX292ZXJyaWRlcyAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICBsZXQgX2JnQ29sb3JzX292ZXJyaWRlcyA9IGJnQ29sb3JPdmVyUmlkZXMuZmlsdGVyKGNvbiA9PiBjb24uaW5kZXhPZihcIi0+XCIpKS5tYXAoY29uID0+IGNvbi5zcGxpdChcIi0+XCIpKS5maWx0ZXIoY29uID0+ICsoY29uWzBdKSA9PT0gdmFsdWUpLm1hcChjb24gPT4gY29uWzFdKTtcclxuICAgICAgICAgICAgaWYgKF9iZ0NvbG9yc19vdmVycmlkZXMubGVuZ3RoID4gMCAmJiBfYmdDb2xvcnNfb3ZlcnJpZGVzWzBdICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICBiZ0NvbG9yID0gKFwiXCIgKyBfYmdDb2xvcnNfb3ZlcnJpZGVzWzBdKS50cmltKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbm9ybWFsaXplQ29sb3IoYmdDb2xvcik7XHJcbn07XHJcbmV4cG9ydCBsZXQgZ2V0VGV4dENvbG9yID0gZnVuY3Rpb24gKHZhbHVlOiBudW1iZXIsIHBhdHRlcm46IElCb29tUGF0dGVybiwgdGhyZXNob2xkcywgbGlzdF9vZl90ZXh0Q29sb3JzX2Jhc2VkX29uX3RocmVzaG9sZHM6IHN0cmluZywgdHh0Q29sb3JPdmVycmlkZXM6IHN0cmluZ1tdKTogc3RyaW5nIHtcclxuICAgIGxldCB0ZXh0Q29sb3IgPSBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucyhcInRoZW1lLWxpZ2h0XCIpID8gXCJibGFja1wiIDogXCJ3aGl0ZVwiO1xyXG4gICAgaWYgKF8uaXNOYU4odmFsdWUpIHx8IHZhbHVlID09PSBudWxsKSB7XHJcbiAgICAgICAgdGV4dENvbG9yID0gcGF0dGVybi5udWxsX3RleHRjb2xvciB8fCB0ZXh0Q29sb3I7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRleHRDb2xvciA9IHBhdHRlcm4uZGVmYXVsdFRleHRDb2xvciB8fCB0ZXh0Q29sb3I7XHJcbiAgICAgICAgaWYgKHBhdHRlcm4uZW5hYmxlX3RleHRDb2xvciAmJiBwYXR0ZXJuLnRleHRDb2xvcnMpIHtcclxuICAgICAgICAgICAgdGV4dENvbG9yID0gZ2V0SXRlbUJhc2VkT25UaHJlc2hvbGQodGhyZXNob2xkcywgbGlzdF9vZl90ZXh0Q29sb3JzX2Jhc2VkX29uX3RocmVzaG9sZHMsIHZhbHVlLCB0ZXh0Q29sb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocGF0dGVybi5lbmFibGVfdGV4dENvbG9yX292ZXJyaWRlcyAmJiBwYXR0ZXJuLnRleHRDb2xvcnNfb3ZlcnJpZGVzICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIGxldCBfdGV4dENvbG9yc19vdmVycmlkZXMgPSB0eHRDb2xvck92ZXJyaWRlcy5maWx0ZXIoY29uID0+IGNvbi5pbmRleE9mKFwiLT5cIikpLm1hcChjb24gPT4gY29uLnNwbGl0KFwiLT5cIikpLmZpbHRlcihjb24gPT4gKyhjb25bMF0pID09PSB2YWx1ZSkubWFwKGNvbiA9PiBjb25bMV0pO1xyXG4gICAgICAgICAgICBpZiAoX3RleHRDb2xvcnNfb3ZlcnJpZGVzLmxlbmd0aCA+IDAgJiYgX3RleHRDb2xvcnNfb3ZlcnJpZGVzWzBdICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICB0ZXh0Q29sb3IgPSAoXCJcIiArIF90ZXh0Q29sb3JzX292ZXJyaWRlc1swXSkudHJpbSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5vcm1hbGl6ZUNvbG9yKHRleHRDb2xvcik7XHJcbn07XHJcbmV4cG9ydCBsZXQgZ2V0VGhyZXNob2xkcyA9IGZ1bmN0aW9uICh0aHJlc2hvbGRzQXJyYXk6IGFueVtdLCBlbmFibGVfdGltZV9iYXNlZF90aHJlc2hvbGRzOiBib29sZWFuLCB0aW1lX2Jhc2VkX3RocmVzaG9sZHM6IGFueVtdLCBjdXJyZW50VGltZVN0YW1wOiBEYXRlKSB7XHJcbiAgICBpZiAoZW5hYmxlX3RpbWVfYmFzZWRfdGhyZXNob2xkcykge1xyXG4gICAgICAgIGxldCBtZXRyaWNyZWNpdmVkVGltZVN0YW1wID0gY3VycmVudFRpbWVTdGFtcCB8fCBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIGxldCBtZXRyaWNyZWNpdmVkVGltZVN0YW1wX2lubnVtYmVyID0gbWV0cmljcmVjaXZlZFRpbWVTdGFtcC5nZXRIb3VycygpICogMTAwICsgbWV0cmljcmVjaXZlZFRpbWVTdGFtcC5nZXRNaW51dGVzKCk7XHJcbiAgICAgICAgbGV0IHdlZWtkYXlzID0gW1wic3VuXCIsIFwibW9uXCIsIFwidHVlXCIsIFwid2VkXCIsIFwidGh1XCIsIFwiZnJpXCIsIFwic2F0XCJdO1xyXG4gICAgICAgIF8uZWFjaCh0aW1lX2Jhc2VkX3RocmVzaG9sZHMsICh0YnR4KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0YnR4ICYmIHRidHguZnJvbSAmJiB0YnR4LnRvICYmIHRidHguZW5hYmxlZERheXMgJiZcclxuICAgICAgICAgICAgICAgIChtZXRyaWNyZWNpdmVkVGltZVN0YW1wX2lubnVtYmVyID49ICsodGJ0eC5mcm9tKSkgJiZcclxuICAgICAgICAgICAgICAgIChtZXRyaWNyZWNpdmVkVGltZVN0YW1wX2lubnVtYmVyIDw9ICsodGJ0eC50bykpICYmXHJcbiAgICAgICAgICAgICAgICAodGJ0eC5lbmFibGVkRGF5cy50b0xvd2VyQ2FzZSgpLmluZGV4T2Yod2Vla2RheXNbbWV0cmljcmVjaXZlZFRpbWVTdGFtcC5nZXREYXkoKV0pID4gLTEpICYmXHJcbiAgICAgICAgICAgICAgICB0YnR4LnRocmVzaG9sZFxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIHRocmVzaG9sZHNBcnJheSA9ICh0YnR4LnRocmVzaG9sZCArIFwiXCIpLnNwbGl0KFwiLFwiKS5tYXAoZCA9PiArZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aHJlc2hvbGRzQXJyYXkgfHwgW107XHJcbn07XHJcbmV4cG9ydCBsZXQgZ2V0U2VyaWVzVmFsdWUgPSBmdW5jdGlvbiAoc2VyaWVzOiBhbnksIHN0YXRUeXBlOiBzdHJpbmcpOiBudW1iZXIge1xyXG4gICAgbGV0IHZhbHVlID0gTmFOO1xyXG4gICAgaWYgKHN0YXRUeXBlID09PSBcImxhc3RfdGltZVwiKSB7XHJcbiAgICAgICAgaWYgKF8ubGFzdChzZXJpZXMuZGF0YXBvaW50cykpIHtcclxuICAgICAgICAgICAgdmFsdWUgPSBfLmxhc3Qoc2VyaWVzLmRhdGFwb2ludHMpWzFdO1xyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAoc3RhdFR5cGUgPT09IFwibGFzdF90aW1lX25vbm51bGxcIikge1xyXG4gICAgICAgIGxldCBub25fbnVsbF9kYXRhID0gc2VyaWVzLmRhdGFwb2ludHMuZmlsdGVyKHMgPT4gc1swXSk7XHJcbiAgICAgICAgaWYgKF8ubGFzdChub25fbnVsbF9kYXRhKSAmJiBfLmxhc3Qobm9uX251bGxfZGF0YSlbMV0pIHtcclxuICAgICAgICAgICAgdmFsdWUgPSBfLmxhc3Qobm9uX251bGxfZGF0YSlbMV07XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChzZXJpZXMuc3RhdHMpIHtcclxuICAgICAgICB2YWx1ZSA9IHNlcmllcy5zdGF0c1tzdGF0VHlwZV0gfHwgbnVsbDtcclxuICAgIH1cclxuICAgIHJldHVybiB2YWx1ZTtcclxufTtcclxuZXhwb3J0IGxldCBnZXRMaW5rID0gZnVuY3Rpb24gKGVuYWJsZV9jbGlja2FibGVfY2VsbHM6IGJvb2xlYW4sIGNsaWNrYWJsZV9jZWxsc19saW5rOiBzdHJpbmcsIHJhbmdlOiBhbnkpOiBzdHJpbmcge1xyXG4gICAgbGV0IGxpbmsgPSBlbmFibGVfY2xpY2thYmxlX2NlbGxzID8gY2xpY2thYmxlX2NlbGxzX2xpbmsgfHwgXCIjXCIgOiBcIiNcIjtcclxuICAgIGlmIChsaW5rICYmIGxpbmsgIT09IFwiI1wiKSB7XHJcbiAgICAgICAgbGluayArPSAobGluay5pbmRleE9mKFwiP1wiKSA+IC0xID8gYCZmcm9tPSR7cmFuZ2UuZnJvbX1gIDogYD9mcm9tPSR7cmFuZ2UuZnJvbX1gKTtcclxuICAgICAgICBsaW5rICs9IGAmdG89JHtyYW5nZS50b31gO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGxpbms7XHJcbn07XHJcbmV4cG9ydCBsZXQgZ2V0Q3VycmVudFRpbWVTdGFtcCA9IGZ1bmN0aW9uIChkYXRhUG9pbnRzOiBhbnlbXSk6IERhdGUge1xyXG4gICAgbGV0IGN1cnJlbnRUaW1lU3RhbXAgPSBuZXcgRGF0ZSgpO1xyXG4gICAgaWYgKGRhdGFQb2ludHMgJiYgZGF0YVBvaW50cy5sZW5ndGggPiAwICYmIF8ubGFzdChkYXRhUG9pbnRzKS5sZW5ndGggPT09IDIpIHtcclxuICAgICAgICBjdXJyZW50VGltZVN0YW1wID0gbmV3IERhdGUoXy5sYXN0KGRhdGFQb2ludHMpWzFdKTtcclxuICAgIH1cclxuICAgIHJldHVybiBjdXJyZW50VGltZVN0YW1wO1xyXG59O1xyXG5leHBvcnQgbGV0IGRvZXNWYWx1ZU5lZWRzVG9IaWRlID0gZnVuY3Rpb24gKHZhbHVlOiBudW1iZXIsIGZpbHRlcjogYW55KTogYm9vbGVhbiB7XHJcbiAgICBsZXQgaGlkZGVuID0gZmFsc2U7XHJcbiAgICBpZiAodmFsdWUgJiYgZmlsdGVyICYmIChmaWx0ZXIudmFsdWVfYmVsb3cgIT09IFwiXCIgfHwgZmlsdGVyLnZhbHVlX2Fib3ZlICE9PSBcIlwiKSkge1xyXG4gICAgICAgIGlmIChmaWx0ZXIudmFsdWVfYmVsb3cgIT09IFwiXCIgJiYgdmFsdWUgPCArKGZpbHRlci52YWx1ZV9iZWxvdykpIHtcclxuICAgICAgICAgICAgaGlkZGVuID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGZpbHRlci52YWx1ZV9hYm92ZSAhPT0gXCJcIiAmJiB2YWx1ZSA+ICsoZmlsdGVyLnZhbHVlX2Fib3ZlKSkge1xyXG4gICAgICAgICAgICBoaWRkZW4gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBoaWRkZW47XHJcbn07XHJcbmV4cG9ydCBsZXQgcmVwbGFjZURlbGltaXRlZENvbHVtbnMgPSBmdW5jdGlvbiAoaW5wdXRzdHJpbmc6IHN0cmluZywgc2VyaWVzTmFtZTogc3RyaW5nLCBkZWxpbWl0ZXI6IHN0cmluZywgcm93X2NvbF93cmFwcGVyOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgbGV0IG91dHB1dFN0cmluZyA9IHNlcmllc05hbWVcclxuICAgICAgICAuc3BsaXQoZGVsaW1pdGVyIHx8IFwiLlwiKVxyXG4gICAgICAgIC5yZWR1Y2UoKHIsIGl0LCBpKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiByLnJlcGxhY2UobmV3IFJlZ0V4cChyb3dfY29sX3dyYXBwZXIgKyBpICsgcm93X2NvbF93cmFwcGVyLCBcImdcIiksIGl0KTtcclxuICAgICAgICB9LCBpbnB1dHN0cmluZyk7XHJcbiAgICByZXR1cm4gb3V0cHV0U3RyaW5nO1xyXG59O1xyXG5leHBvcnQgbGV0IGdldFJvd05hbWUgPSBmdW5jdGlvbiAocm93X25hbWU6IHN0cmluZywgZGVsaW1pdGVyOiBzdHJpbmcsIHJvd19jb2xfd3JhcHBlcjogc3RyaW5nLCBzZXJpZXNOYW1lOiBzdHJpbmcsIF9tZXRyaWNuYW1lOiBzdHJpbmcsIF90YWdzOiBhbnlbXSk6IHN0cmluZyB7XHJcbiAgICBpZiAoZGVsaW1pdGVyLnRvTG93ZXJDYXNlKCkgPT09IFwidGFnXCIpIHtcclxuICAgICAgICByb3dfbmFtZSA9IHJvd19uYW1lLnJlcGxhY2UobmV3IFJlZ0V4cChcInt7bWV0cmljX25hbWV9fVwiLCBcImdcIiksIF9tZXRyaWNuYW1lKTtcclxuICAgICAgICByb3dfbmFtZSA9IHJlcGxhY2VfdGFnc19mcm9tX2ZpZWxkKHJvd19uYW1lLCBfdGFncyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJvd19uYW1lID0gcmVwbGFjZURlbGltaXRlZENvbHVtbnMocm93X25hbWUsIHNlcmllc05hbWUsIGRlbGltaXRlciwgcm93X2NvbF93cmFwcGVyKTtcclxuICAgICAgICBpZiAoc2VyaWVzTmFtZS5zcGxpdChkZWxpbWl0ZXIgfHwgXCIuXCIpLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICByb3dfbmFtZSA9IHNlcmllc05hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJvd19uYW1lLnJlcGxhY2UobmV3IFJlZ0V4cChcIl9zZXJpZXNfXCIsIFwiZ1wiKSwgc2VyaWVzTmFtZS50b1N0cmluZygpKTtcclxufTtcclxuZXhwb3J0IGxldCBnZXRDb2xOYW1lID0gZnVuY3Rpb24gKGNvbF9uYW1lOiBzdHJpbmcsIGRlbGltaXRlcjogc3RyaW5nLCByb3dfY29sX3dyYXBwZXI6IHN0cmluZywgc2VyaWVzTmFtZTogc3RyaW5nLCByb3dfbmFtZTogc3RyaW5nLCBfbWV0cmljbmFtZTogc3RyaW5nLCBfdGFnczogYW55W10pOiBzdHJpbmcge1xyXG4gICAgaWYgKGRlbGltaXRlci50b0xvd2VyQ2FzZSgpID09PSBcInRhZ1wiKSB7XHJcbiAgICAgICAgY29sX25hbWUgPSBjb2xfbmFtZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJ7e21ldHJpY19uYW1lfX1cIiwgXCJnXCIpLCBfbWV0cmljbmFtZSk7XHJcbiAgICAgICAgcm93X25hbWUgPSByZXBsYWNlX3RhZ3NfZnJvbV9maWVsZChjb2xfbmFtZSwgX3RhZ3MpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb2xfbmFtZSA9IHJlcGxhY2VEZWxpbWl0ZWRDb2x1bW5zKGNvbF9uYW1lLCBzZXJpZXNOYW1lLCBkZWxpbWl0ZXIsIHJvd19jb2xfd3JhcHBlcik7XHJcbiAgICAgICAgaWYgKHNlcmllc05hbWUuc3BsaXQoZGVsaW1pdGVyIHx8IFwiLlwiKS5sZW5ndGggPT09IDEgfHwgcm93X25hbWUgPT09IHNlcmllc05hbWUpIHtcclxuICAgICAgICAgICAgY29sX25hbWUgPSBjb2xfbmFtZSB8fCBcIlZhbHVlXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvbF9uYW1lLnJlcGxhY2UobmV3IFJlZ0V4cChcIl9zZXJpZXNfXCIsIFwiZ1wiKSwgc2VyaWVzTmFtZS50b1N0cmluZygpKTtcclxufTtcclxuZXhwb3J0IGxldCBHZXRWYWx1ZXNSZXBsYWNlZCA9IGZ1bmN0aW9uIChzdHJUb1JlcGxhY2U6IHN0cmluZywgdmFsdWUsIHZhbHVlZm9ybWF0dGVkLCBzdGF0czogYW55LCBkZWNpbWFsczogTnVtYmVyLCBmb3JtYXQ6IHN0cmluZywgX21ldHJpY25hbWU6IHN0cmluZywgX3RhZ3M6IGFueVtdLCBkZWxpbWl0ZXI6IHN0cmluZyk6IHN0cmluZyB7XHJcblxyXG4gICAgbGV0IHZhbHVlX3JhdyA9IF8uaXNOYU4odmFsdWUpIHx8IHZhbHVlID09PSBudWxsID8gXCJudWxsXCIgOiB2YWx1ZS50b1N0cmluZygpLnRyaW0oKTtcclxuICAgIGxldCB2YWx1ZV9mb3JtYXR0ZWQgPSBfLmlzTmFOKHZhbHVlKSB8fCB2YWx1ZSA9PT0gbnVsbCA/IFwibnVsbFwiIDogdmFsdWVmb3JtYXR0ZWQudG9TdHJpbmcoKS50cmltKCk7XHJcblxyXG4gICAgc3RyVG9SZXBsYWNlID0gc3RyVG9SZXBsYWNlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV9taW5fcmF3X1wiLCBcImdcIiksIHN0YXRzLm1pbik7XHJcbiAgICBzdHJUb1JlcGxhY2UgPSBzdHJUb1JlcGxhY2UucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX21heF9yYXdfXCIsIFwiZ1wiKSwgc3RhdHMubWF4KTtcclxuICAgIHN0clRvUmVwbGFjZSA9IHN0clRvUmVwbGFjZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfdmFsdWVfYXZnX3Jhd19cIiwgXCJnXCIpLCBzdGF0cy5hdmcpO1xyXG4gICAgc3RyVG9SZXBsYWNlID0gc3RyVG9SZXBsYWNlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV9jdXJyZW50X3Jhd19cIiwgXCJnXCIpLCBzdGF0cy5jdXJyZW50KTtcclxuICAgIHN0clRvUmVwbGFjZSA9IHN0clRvUmVwbGFjZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfdmFsdWVfdG90YWxfcmF3X1wiLCBcImdcIiksIHN0YXRzLnRvdGFsKTtcclxuICAgIHN0clRvUmVwbGFjZSA9IHN0clRvUmVwbGFjZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfdmFsdWVfcmF3X1wiLCBcImdcIiksIHZhbHVlX3Jhdyk7XHJcblxyXG4gICAgc3RyVG9SZXBsYWNlID0gc3RyVG9SZXBsYWNlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV9taW5fXCIsIFwiZ1wiKSwgZ2V0X2Zvcm1hdHRlZF92YWx1ZShzdGF0cy5taW4sIGRlY2ltYWxzLCBmb3JtYXQpKTtcclxuICAgIHN0clRvUmVwbGFjZSA9IHN0clRvUmVwbGFjZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfdmFsdWVfbWF4X1wiLCBcImdcIiksIGdldF9mb3JtYXR0ZWRfdmFsdWUoc3RhdHMubWF4LCBkZWNpbWFscywgZm9ybWF0KSk7XHJcbiAgICBzdHJUb1JlcGxhY2UgPSBzdHJUb1JlcGxhY2UucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX2F2Z19cIiwgXCJnXCIpLCBnZXRfZm9ybWF0dGVkX3ZhbHVlKHN0YXRzLmF2ZywgZGVjaW1hbHMsIGZvcm1hdCkpO1xyXG4gICAgc3RyVG9SZXBsYWNlID0gc3RyVG9SZXBsYWNlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV9jdXJyZW50X1wiLCBcImdcIiksIGdldF9mb3JtYXR0ZWRfdmFsdWUoc3RhdHMuY3VycmVudCwgZGVjaW1hbHMsIGZvcm1hdCkpO1xyXG4gICAgc3RyVG9SZXBsYWNlID0gc3RyVG9SZXBsYWNlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV90b3RhbF9cIiwgXCJnXCIpLCBnZXRfZm9ybWF0dGVkX3ZhbHVlKHN0YXRzLnRvdGFsLCBkZWNpbWFscywgZm9ybWF0KSk7XHJcbiAgICBzdHJUb1JlcGxhY2UgPSBzdHJUb1JlcGxhY2UucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX1wiLCBcImdcIiksIHZhbHVlX2Zvcm1hdHRlZCk7XHJcblxyXG4gICAgaWYgKGRlbGltaXRlci50b0xvd2VyQ2FzZSgpID09PSBcInRhZ1wiKSB7XHJcbiAgICAgICAgc3RyVG9SZXBsYWNlID0gc3RyVG9SZXBsYWNlLnJlcGxhY2UobmV3IFJlZ0V4cChcInt7bWV0cmljX25hbWV9fVwiLCBcImdcIiksIF9tZXRyaWNuYW1lKTtcclxuICAgICAgICBzdHJUb1JlcGxhY2UgPSByZXBsYWNlX3RhZ3NfZnJvbV9maWVsZChzdHJUb1JlcGxhY2UsIF90YWdzKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gc3RyVG9SZXBsYWNlO1xyXG59O1xyXG4iXX0=